
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reading and Visualizing Structural MRI Data &#8212; Data Science for Psychology and Neuroscience — in Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="http://neuraldatascience.io/mri/read_viz.html" />
    <link rel="shortcut icon" href="../_static/NESC3505_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with NIfTI images" href="nifti.html" />
    <link rel="prev" title="Learning Objectives" href="learning_objectives.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-171426664-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/NESC3505_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Psychology and Neuroscience — in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/why.html">
   Start with why
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_objectives.html">
   Learning Objectives for this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Pedagogy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teaching_approach.html">
   Teaching Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/online_learning.html">
   Hybrid Online Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/assessment_evaluation.html">
   Assessment and Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/constructivism.html">
   Constructivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/connectivism.html">
   Connectivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/authenticity.html">
   Authenticity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/21st_cen_skills.html">
   21st Century Skills
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Open Software, Science, &amp; Education
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open.html">
   Open Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/software.html">
   Free Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/free_licenses.html">
   Free and Open-Source Software Licenses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/peer_review.html">
   Peer Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/for_profit.html">
   For-Profit Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/impact_factors.html">
   Impact Factors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/novelty.html">
   Novelty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_publishing.html">
   Open Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/preregistration.html">
   Preregistration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_methods.html">
   Open Methods and Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer.html">
   Open Educational Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer_this_course.html">
   OERs in the Context of this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/licenses.html">
   Licenses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  How to Rock This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_approach.html">
   Learning Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/mindset.html">
   Mindset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/errors_debugging.html">
   Errors and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teamwork.html">
   Collaboration and Teamwork
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../2/introduction.html">
   Getting Started with the Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/what_is_nds.html">
   What is Data Science?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/data.html">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/tools_for_nds.html">
   Tools for Neural Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets.html">
     Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets_limits.html">
     Limitations of Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/reproducibility.html">
     Reproducibility
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/sci_prog_lang.html">
     Scientific Programming Languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/which_lang.html">
     Which language to use?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/libs.html">
     Libraries and packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/why_python.html">
     Why Python for this Course?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/class_tech.html">
   Technologies Used in this Class
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/lms.html">
     Learning Management System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/teams.html">
     MS Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/communication.html">
     Communication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/videos.html">
     Course Videos
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/coding.html">
   Coding Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/datacamp.html">
     DataCamp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/py4e.html">
     Python for Everybody (PY4E)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/terminal.html">
     The Terminal and Command Line
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/jupyter.html">
     Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/markdown.html">
     Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/cocalc.html">
     CoCalc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/github.html">
     GitHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/alltogether.html">
   Putting It All Together
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/get_going.html">
   Get Going!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introducing Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3/introduction.html">
   Introducing Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/getting_help.html">
   Getting Help with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/variables-and-assignment.html">
   Variables and Assignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/types-conversion.html">
   Data Types and Conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/built-in.html">
   Python Built-Ins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/lists.html">
   Lists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/dictionaries.html">
   Dictionaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/for-loops.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/conditionals.html">
   Conditionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/pandas-dataframes.html">
   pandas DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/looping-data-files.html">
   Looping Over Data Files
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualizing Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/introduction.html">
   Introduction to Data Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/plotting.html">
   Introduction to Plotting with Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/proc_vs_oo.html">
   Procedural versus Object-Oriented Plotting in Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/subplots.html">
   Subplots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/plotting_types.html">
   Thinking About Data for Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/seaborn.html">
   Introduction to Plotting with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/human_factors.html">
   Accessibility and Human Factors in Plotting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exploratory Data Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/introduction.html">
   Introduction to EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/repeated_measures.html">
   Working with Repeated Measures Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/data_cleaning.html">
   Data Cleaning - Dealing with Outliers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/ttests.html">
   Basic Statistics in Python:
   <em>
    t
   </em>
   tests with SciPy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Single Unit Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/introduction.html">
   Introduction to Single Unit Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/single_unit_intro.html">
   Single Unit Data and Spike Trains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/intro_spike_trains.html">
   Introduction to Spike Train Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/ten_intensities.html">
   Effects of Light Intensity on Spike Rate
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/heat_maps.html">
   Heat Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/intro_multielec_data.html">
   Introducing Multielectrode Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/pandas_multielec.html">
   Working with Multielectrode Data in pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/corr_spike_trains.html">
   Correlating spike trains
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  EEG Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/introduction.html">
   Introduction to EEG/ERP Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/time_freq.html">
   Time and Frequency Domains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/erps.html">
   Event-Related Potentials (ERPs)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/components.html">
   ERP Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/mne_python.html">
   MNE-Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/mne_data.html">
   Exploring MNE’s data structure
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eeg/erp_preprocessing.html">
   EEG-ERP Preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/erp_filtering.html">
     Filtering EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/erp_artifacts.html">
     Artifacts in EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/erp_segmentation.html">
     Segmentation into ERP epochs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/erp_rereferencing.html">
     Re-referencing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/erp_averaging.html">
     Averaging ERPs: Creating MNE Evoked objects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MRI Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction to MRI Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Reading and Visualizing Structural MRI Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nifti.html">
   Working with NIfTI images
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../zrefs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/mri/read_viz.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook/issues/new?title=Issue%20on%20page%20%2Fmri/read_viz.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DalPsychNeuro/NESC_3505_textbook/master?urlpath=tree/mri/read_viz.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-in-required-packages">
   Load in required packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-a-dicom-image">
   Read a DICOM image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#view-metadata">
   View metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#view-image-dimensions">
   View image dimensions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#view-contents-of-image">
   View contents of image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-the-image">
   Visualize the image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-a-brain-volume">
   Load a brain volume
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-one-slice-of-the-volume">
   Visualize one slice of the volume
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-a-slice-through-different-planes">
   Visualize a slice through different planes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rotate-the-image">
     Rotate the image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coronal-plane">
     Coronal plane
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-a-series-of-slices-through-a-volume">
   Plotting a series of slices through a volume
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#slice-through-a-different-axis">
   Slice through a different axis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Coronal plane
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-an-image-histogram">
   Plotting an image histogram
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mask-an-image">
   Mask an image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#image-smoothing">
   Image smoothing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#segmenting-smoothed-images">
   Segmenting smoothed images
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="reading-and-visualizing-structural-mri-data">
<h1>Reading and Visualizing Structural MRI Data<a class="headerlink" href="#reading-and-visualizing-structural-mri-data" title="Permalink to this headline">¶</a></h1>
<p>In this lesson we will learn how to read structural MRI images of a brain into Python, visualize them as slices, and perform a couple of simple image processing operations on images.</p>
<p>Structural MRI is a generic term for any MRI scan intended to image the structure of the body. These are sometimes called anatomical scans. This is in contrast to functional MRI, which are scans designed to measure some aspect of physiological function (typically neural activation). We will work with functional MRI data later in this chapter.</p>
<div class="section" id="load-in-required-packages">
<h2>Load in required packages<a class="headerlink" href="#load-in-required-packages" title="Permalink to this headline">¶</a></h2>
<p>New to us are two packages for working with images:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/imageio/">imageio</a> is a Python library that provides an easy interface to read and write a wide range of image data, including animated images, volumetric data, and scientific formats</p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/ndimage.html">ndimage</a> is part of the SciPy pacakge, which contains functions for multidimensional image processing</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imageio</span> <span class="k">as</span> <span class="nn">iio</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">ndi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-a-dicom-image">
<h2>Read a DICOM image<a class="headerlink" href="#read-a-dicom-image" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.dicomstandard.org/">DICOM</a> is the international standard for medical images and related information. It defines the formats for medical images that can be exchanged with the data and quality necessary for clinical use. DICOM stands for <em>Digital Imaging and Communications in Medicine</em> and is recognized by the International Organization for Standardization as the ISO 12052 standard. DICOM is the standard format for most medical imaging devices used in hospitals and clinical care settings, including MRI, PET, CT, Xray, and ultrasound. For this reason, it is common that raw MRI data comes off the scanner in DICOM format.</p>
<p>The imageio package provides an <code class="docutils literal notranslate"><span class="pre">imread()</span></code> function that is capable of reading DICOM images. The first argument is the file name, and the second is the format. Below we read in a single slice from a structural MRI scan of a head, and show they type of the resulting object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span> <span class="o">=</span> <span class="n">iio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;data/DICOM/IM-0004-0096.dcm&#39;</span><span class="p">,</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">)</span>

<span class="nb">type</span><span class="p">(</span><span class="n">brain_slice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>imageio.core.util.Array
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="view-metadata">
<h2>View metadata<a class="headerlink" href="#view-metadata" title="Permalink to this headline">¶</a></h2>
<p>We can view the image meta-data which is stored in the <code class="docutils literal notranslate"><span class="pre">.meta</span></code> property of the imageio object. This contains lots of information, such as the date and location of the scan, the manufacturer of the scanner, the type of scanner (modality; i.e., that it is an MRI scan), and details of the person who was scanned. Since this scan was acquired for research purposes, the “patient” information does not contain personally-identifying information like the name or birth. date of the person who was scanned.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span><span class="o">.</span><span class="n">meta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dict([(&#39;TransferSyntaxUID&#39;, &#39;1.2.840.10008.1.2.1&#39;),
      (&#39;SOPClassUID&#39;, &#39;1.2.840.10008.5.1.4.1.1.4&#39;),
      (&#39;SOPInstanceUID&#39;,
       &#39;1.2.840.113619.2.176.3596.7771172.7255.1265293350.477&#39;),
      (&#39;StudyDate&#39;, &#39;20100204&#39;),
      (&#39;SeriesDate&#39;, &#39;20100204&#39;),
      (&#39;AcquisitionDate&#39;, &#39;20100204&#39;),
      (&#39;ContentDate&#39;, &#39;20100204&#39;),
      (&#39;StudyTime&#39;, &#39;201859&#39;),
      (&#39;SeriesTime&#39;, &#39;202511&#39;),
      (&#39;AcquisitionTime&#39;, &#39;202511&#39;),
      (&#39;ContentTime&#39;, &#39;202511&#39;),
      (&#39;Modality&#39;, &#39;MR&#39;),
      (&#39;Manufacturer&#39;, &#39;GE MEDICAL SYSTEMS&#39;),
      (&#39;InstitutionName&#39;, &#39;IWK Health Centre&#39;),
      (&#39;SeriesDescription&#39;, &#39;SAG 3D T1 SPGR&#39;),
      (&#39;PatientName&#39;, &#39;AARONTEST&#39;),
      (&#39;PatientID&#39;, &#39;AARONTEST&#39;),
      (&#39;PatientBirthDate&#39;, &#39;&#39;),
      (&#39;PatientSex&#39;, &#39;M &#39;),
      (&#39;PatientAge&#39;, &#39;000Y&#39;),
      (&#39;PatientWeight&#39;, 70.307),
      (&#39;SliceSpacing&#39;, 1.0),
      (&#39;StudyInstanceUID&#39;,
       &#39;1.2.840.113619.2.176.3596.7771172.7628.1265291937.899&#39;),
      (&#39;SeriesInstanceUID&#39;,
       &#39;1.2.840.113619.2.176.3596.7771172.7628.1265291937.902&#39;),
      (&#39;SeriesNumber&#39;, 4),
      (&#39;AcquisitionNumber&#39;, 1),
      (&#39;InstanceNumber&#39;, 96),
      (&#39;ImagePositionPatient&#39;, (-1.60062, -178.036, 97.0647)),
      (&#39;ImageOrientationPatient&#39;, (-0.0, 1.0, 0.0, -0.0, -0.0, -1.0)),
      (&#39;SamplesPerPixel&#39;, 1),
      (&#39;Rows&#39;, 256),
      (&#39;Columns&#39;, 256),
      (&#39;PixelSpacing&#39;, (1.0, 1.0)),
      (&#39;BitsAllocated&#39;, 16),
      (&#39;BitsStored&#39;, 16),
      (&#39;HighBit&#39;, 15),
      (&#39;PixelRepresentation&#39;, 1),
      (&#39;PixelData&#39;,
       b&#39;Data converted to numpy array, raw data removed to preserve memory&#39;),
      (&#39;shape&#39;, (256, 256)),
      (&#39;sampling&#39;, (1.0, 1.0))])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="view-image-dimensions">
<h2>View image dimensions<a class="headerlink" href="#view-image-dimensions" title="Permalink to this headline">¶</a></h2>
<p>Because we loaded in a single image <em>slice</em>, our image is 2-dimensional, like a photograph. We can view its <em>x</em> and <em>y</em> dimensions with the <code class="docutils literal notranslate"><span class="pre">.shape</span></code> property. Although the image is stored as an object of type <code class="docutils literal notranslate"><span class="pre">imageio.core.util.Array</span></code>, the object is designed in a way that allows us to treat it in many ways like a simple NumPy array, so standard properties like <code class="docutils literal notranslate"><span class="pre">.shape</span></code> are available:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(256, 256)
</pre></div>
</div>
</div>
</div>
<p>The output above tells us that the image comprises 256 x 256 pixels. In medical imaging, the term <strong>voxels</strong> is typically used instead of pixels, because each element in the image actually represents a cube with a volume. In the metadata above, the <code class="docutils literal notranslate"><span class="pre">'SliceSpacing'</span></code> field tells us that the thickness of this slice is 1 mm, and the <code class="docutils literal notranslate"><span class="pre">'sampling'</span></code> field tells us that each voxel in the slice is 1 x 1 mm. Since these are pieces of information stored in the <code class="docutils literal notranslate"><span class="pre">.meta</span></code> prperty, we can access them individually using the following syntax:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;sampling&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.0, 1.0)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="view-contents-of-image">
<h2>View contents of image<a class="headerlink" href="#view-contents-of-image" title="Permalink to this headline">¶</a></h2>
<p>We can use NumPy indexing to view the data values of the first row of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  3,  2,  4,  1,  8, 10,
        6, 13,  4,  9,  9,  0, 23, 60, 57, 32, 24, 20, 12, 19,  7, 12,  2,
        7, 21, 16, 11, 19, 13,  8, 27, 17, 22, 33, 18, 13, 14,  0,  1, 22,
       21, 42, 46, 34, 37, 11, 23, 29, 27, 47, 49, 30,  7, 20, 50, 30, 10,
       25, 61, 41, 49, 57,  0,  2, 12, 16, 28, 24,  4, 21, 65, 51, 37, 32,
       27, 13, 10, 29, 34,  1,  7, 15, 21, 51, 24, 19, 34, 12, 21, 26, 21,
       28, 11,  4, 15, 20, 18, 24, 25,  9, 12, 33, 33,  5,  4, 11, 33, 54,
       15,  4, 14,  5,  0, 24, 51, 45, 19,  2,  7, 13, 18, 26, 18,  9, 25,
       11, 16, 41, 32, 13,  7, 14, 13, 16, 31, 27,  6, 22, 22,  8,  5,  8,
        3,  4,  8,  3, 17, 12,  0, 14,  4,  9, 22, 18,  7, 11,  9,  1,  3,
        9,  9, 14, 13,  5,  5,  7, 12, 15,  9,  1,  5, 10,  4,  4,  8,  5,
        2], dtype=int16)
</pre></div>
</div>
</div>
</div>
<p>Or the first column of the image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_slice</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([  0,   0,   0,   0,   0,   0,  13,  23,  19,  49,  35,  17,  82,
        34,  80,  24,  14,  63,  55,  84,  14,  32,   1,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0,   0,   0,   0,   0,   0,   0,  82, 129, 123, 136, 142,
       282, 130, 415, 168, 152,  59, 185, 168,  23, 606, 572, 368, 410,
       224,  98, 732, 169, 422, 681, 299, 436, 620, 839, 619, 964, 266,
       231, 290, 329, 512, 179,   0,   0,   0,   0], dtype=int16)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-the-image">
<h2>Visualize the image<a class="headerlink" href="#visualize-the-image" title="Permalink to this headline">¶</a></h2>
<p>Since the MRI data is a 2D NumPy array of integers, we can plot it using Matplotlib’s <code class="docutils literal notranslate"><span class="pre">plt.imshow()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_slice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x126e6fdf0&gt;
</pre></div>
</div>
<img alt="../_images/read_viz_16_1.png" src="../_images/read_viz_16_1.png" />
</div>
</div>
<p>We can see that this image was acquired in the <strong>sagittal</strong> plane, which is like looking at the person from the side.</p>
<p>We can clean the image up by using a greyscale colour map, and removing the numerical axis labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_slice</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_18_0.png" src="../_images/read_viz_18_0.png" />
</div>
</div>
</div>
<div class="section" id="load-a-brain-volume">
<h2>Load a brain volume<a class="headerlink" href="#load-a-brain-volume" title="Permalink to this headline">¶</a></h2>
<p>Above re loaded a single slice through the head, but in fact this was from a scan that covered the entire head. As noted, each slice was 1 mm thick, and it took 184 slices to cover the entire head in the sagittal plane. Each slice is saved in a separate DICOM file. All of the DICOM images (slices) from this scan are stored in the <code class="docutils literal notranslate"><span class="pre">data/DICOM</span></code> folder. Above we used <code class="docutils literal notranslate"><span class="pre">iio.imread()</span></code> and specified a specific filename as the first argument, to load a single 2D slice/image. To load the entire 3D brain volume, we use imageio’s <code class="docutils literal notranslate"><span class="pre">volread()</span></code> function, and pass as the first argument the name of the folder, rather than a list of files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_vol</span> <span class="o">=</span> <span class="n">iio</span><span class="o">.</span><span class="n">volread</span><span class="p">(</span><span class="s1">&#39;data/DICOM&#39;</span><span class="p">,</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading DICOM (examining files): 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/184 files (0.5%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>184/184 files (100.0%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Found 1 correct series.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading DICOM (loading data): 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>184/184  (100.0%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Now we can see from the <code class="docutils literal notranslate"><span class="pre">.shape</span></code> property that this is a 3D volume, with slices as the first dimension in the image array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(184, 256, 256)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-one-slice-of-the-volume">
<h2>Visualize one slice of the volume<a class="headerlink" href="#visualize-one-slice-of-the-volume" title="Permalink to this headline">¶</a></h2>
<p>We can plot a slice of the 3D volume using the same <code class="docutils literal notranslate"><span class="pre">plt.imshow()</span></code> command as before; the one difference is we need to specify which slice number to plot. Since slices are the first dimension of teh array, we only need to supply one index, even though it is a 3D array (the other dimensions are treated as if we specified <code class="docutils literal notranslate"><span class="pre">brain_vol[96,</span> <span class="pre">:,</span> <span class="pre">:]</span></code>). We pick a slice in the middle of the volume, because if we picked one near the edges (e.g., slice 0) we would likely see little or no interesting anatomy. THis time we use the <code class="docutils literal notranslate"><span class="pre">bone</span></code> colourmap, which is another monochrome palette but with a slight blueish hue:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[</span><span class="mi">96</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_24_0.png" src="../_images/read_viz_24_0.png" />
</div>
</div>
</div>
<div class="section" id="visualize-a-slice-through-different-planes">
<h2>Visualize a slice through different planes<a class="headerlink" href="#visualize-a-slice-through-different-planes" title="Permalink to this headline">¶</a></h2>
<p>Since the data are a 3D NumPy array, it is very easy to “reslice” the image and visualize the head from one of the other two orientations, axial and coronal. Below we pass <code class="docutils literal notranslate"><span class="pre">:</span></code> to select all sagittal slices, and <code class="docutils literal notranslate"><span class="pre">128</span></code> for the second dimension to get the slice midway through the volume, in the axial plane. Again, we omit the third dimension and so <code class="docutils literal notranslate"><span class="pre">:</span></code> is assumed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[:,</span> <span class="mi">128</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_26_0.png" src="../_images/read_viz_26_0.png" />
</div>
</div>
<div class="section" id="rotate-the-image">
<h3>Rotate the image<a class="headerlink" href="#rotate-the-image" title="Permalink to this headline">¶</a></h3>
<p>Typically in showing axial slices, we orient them so that the nose and eyes are at the top of the image. The <code class="docutils literal notranslate"><span class="pre">scipy.ndimage</span></code> package (which we imported with the alias <code class="docutils literal notranslate"><span class="pre">ndi</span></code> provides a tool to rotate images, and we can embed it inside our <code class="docutils literal notranslate"><span class="pre">.imshow()</span></code> command to apply a rotation. The first argument to <code class="docutils literal notranslate"><span class="pre">ndi.rotate()</span></code> is the image, and the second is the amount of rotation, in degrees. The rotation is counter-clockwise, so here we need to use 270 deg rotation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[:,</span> <span class="mi">128</span><span class="p">],</span> <span class="mi">270</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_28_0.png" src="../_images/read_viz_28_0.png" />
</div>
</div>
</div>
<div class="section" id="coronal-plane">
<h3>Coronal plane<a class="headerlink" href="#coronal-plane" title="Permalink to this headline">¶</a></h3>
<p>Finally, we can do this in the coronal place as well; again rotation is necessary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">128</span><span class="p">],</span> <span class="mi">270</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_30_0.png" src="../_images/read_viz_30_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="plotting-a-series-of-slices-through-a-volume">
<h2>Plotting a series of slices through a volume<a class="headerlink" href="#plotting-a-series-of-slices-through-a-volume" title="Permalink to this headline">¶</a></h2>
<p>We can use our skills with Matplotlib subplots to plot a series of slices through the brain, which is a more comprehensive way of visualizing the data. The biggest trick with this is deciding on the number of subplots (slices) we want, and then doing the necessary math to select the appropriate slices from the 3D volume such that the slices are evenly-spaced through the volume, and centered in the middle of the volume. For instance, below we will generate a 4 x 4 array of 16 subplots. Our number of slices — 184 — does not divide evenly by 16 (<code class="docutils literal notranslate"><span class="pre">184</span> <span class="pre">/</span> <span class="pre">16</span> <span class="pre">=</span> <span class="pre">11.5</span></code>). For this reason, we can’t simply run a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop over a range of slice numbers that starts at 0 and goes up to the number of slices, in steps of <code class="docutils literal notranslate"><span class="pre">n_slices</span> <span class="pre">/</span> <span class="pre">n_subplots</span></code>. Instead, we use floor division (<code class="docutils literal notranslate"><span class="pre">//</span></code>) to generate the integer result of dividing the number of slices by subplots (<code class="docutils literal notranslate"><span class="pre">11</span></code>) so that we get a step size that ensures we have 16 evenly-spaced slices through the volume. Then, we determine the number of slices that will be covered by 16 subplots, spaced 11 slices apart from each other (which will be &lt; 184). Finally, we compute a <code class="docutils literal notranslate"><span class="pre">start_stop</span></code> value which tells us which slice to start from (i.e., the first slice to plot), such that the set of slices we generate will be centered on the volume. This is determined by computing how many slices in the volume are <em>not</em> covered by our 16 subplots (i.e., the slices at either edge of the volume), and dividing this by 2, since half of those slices should be at one edge of the volume, at the other at the other end of the volume.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_rows</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fig_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_subplots</span> <span class="o">=</span> <span class="n">fig_rows</span> <span class="o">*</span> <span class="n">fig_cols</span>
<span class="n">n_slice</span> <span class="o">=</span> <span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="n">n_slice</span> <span class="o">//</span> <span class="n">n_subplots</span>
<span class="n">plot_range</span> <span class="o">=</span> <span class="n">n_subplots</span> <span class="o">*</span> <span class="n">step_size</span>
<span class="n">start_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_slice</span> <span class="o">-</span> <span class="n">plot_range</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Having done this math, we now loop through the slices and plot them, starting with the slice defined by <code class="docutils literal notranslate"><span class="pre">start_stop</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_stop</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[</span><span class="n">img</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_34_0.png" src="../_images/read_viz_34_0.png" />
</div>
</div>
</div>
<div class="section" id="slice-through-a-different-axis">
<h2>Slice through a different axis<a class="headerlink" href="#slice-through-a-different-axis" title="Permalink to this headline">¶</a></h2>
<p>We can use the same approach to plot the data through other image planes. The only things we need to change are:</p>
<ul class="simple">
<li><p>which dimension of the image to use to derive <code class="docutils literal notranslate"><span class="pre">n_slice</span></code></p></li>
<li><p>the dimension that we specify the slice number in, inside the <code class="docutils literal notranslate"><span class="pre">.imshow()</span></code> command</p></li>
<li><p>adding rotation for axial and coronal slices, as we did above when plotting a single slice</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_slice</span> <span class="o">=</span> <span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="n">n_slice</span> <span class="o">//</span> <span class="n">n_subplots</span>
<span class="n">plot_range</span> <span class="o">=</span> <span class="n">n_subplots</span> <span class="o">*</span> <span class="n">step_size</span>
<span class="n">start_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_slice</span> <span class="o">-</span> <span class="n">plot_range</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_stop</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[:,</span> <span class="n">img</span><span class="p">,</span> <span class="p">:],</span> <span class="mi">270</span><span class="p">),</span> 
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_36_0.png" src="../_images/read_viz_36_0.png" />
</div>
</div>
<div class="section" id="id1">
<h3>Coronal plane<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_rows</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fig_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_subplots</span> <span class="o">=</span> <span class="n">fig_rows</span> <span class="o">*</span> <span class="n">fig_cols</span>
<span class="n">n_slice</span> <span class="o">=</span> <span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="n">n_slice</span> <span class="o">//</span> <span class="n">n_subplots</span>
<span class="n">plot_range</span> <span class="o">=</span> <span class="n">n_subplots</span> <span class="o">*</span> <span class="n">step_size</span>

<span class="n">start_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_slice</span> <span class="o">-</span> <span class="n">plot_range</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_stop</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">img</span><span class="p">],</span> <span class="mi">270</span><span class="p">),</span> 
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_38_0.png" src="../_images/read_viz_38_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="plotting-an-image-histogram">
<h2>Plotting an image histogram<a class="headerlink" href="#plotting-an-image-histogram" title="Permalink to this headline">¶</a></h2>
<p>As we saw above, the image is stored as a NumPy array, in which each voxel in the image is represented as a number, which is mapped to an intensity value in the colourmap when plotting. Larger values appear as brighter (whiter), and lower values appear as darker.</p>
<p>Histograms of the anatomical images show the number of voxels of a given intensity value. These can be informative because the distribution of intensity values in an anatomical image is not uniform. Instead, as we can see above, there are many very dark voxels (outside of the head, and in some of the fluid-filled spaces inside the head), and then clusters of voxels that are darker grey (the grey matter, largely in the cerebral cortex that forms the outer layer of the brain), lighter grey (the white matter that comprises much of the inside of the brain), and also some very bright areas that are primarily due to areas of fat concentration.</p>
<p>We can use ndimage’s <code class="docutils literal notranslate"><span class="pre">.histogram()</span></code> function to plot a histogram of our brain volume. We use this rather than the NumPy <code class="docutils literal notranslate"><span class="pre">histogram</span></code> function, because ndimage’s function is designed to work with 3D images. This function requires several arguments, including the minimum and maximum intensity values that define the range of the <em>x</em> axis of the histogram, and the number of bins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_40_0.png" src="../_images/read_viz_40_0.png" />
</div>
</div>
<p>In the histogram above, there is a large peak close to zero which represents the fact that a large number of voxels in the image don’t contain the head at all, and therefore have values at or close to zero. We can see a peak just above 10 on the <em>x</em> axis (note that the numbers on the <em>x</em> axis are bin numbers, not intensity values), with a slight decrease and then a second small peak just before 20, followed by a flat area. The peaks just above 10 and just below 20 reflect the concentration of similar intensity values corresponding to grey and white matter respectively.</p>
</div>
<div class="section" id="mask-an-image">
<h2>Mask an image<a class="headerlink" href="#mask-an-image" title="Permalink to this headline">¶</a></h2>
<p>We can use an image histogram like this to create a <strong>mask</strong> that isolates a particular range of intensity values in the image, while setting all other intensity values to zero. This can be useful in certain types of analysis, such as if we want to isolate only grey matter, or only white matter, from the rest of the brain. This is often used in studies that measure the volume of grey and/or white matter separately, as well as in functional MRI analyses where the interest is often only in activation in the cerebral cortex (grey matter).</p>
<p>In the code below, we will attempt to isolate grey matter based on intensity values from the histogram above. Note that this is an overly-simplistic approach to separating grey and white matter in MRIs, compared to more sophisticated, automated, and accurate approaches that would be used in research or clinical care. However, it is an important step in those more sophisticated approaches.</p>
<p>First, we manually define the range of intensity values that we consider grey matter. Based on the histogram above, we will choose a range from bins 10 – 15. Since the <em>x</em> axis of the histogram is bin numbers, not intensity values, we need to determine what intensities those bin numbers correspond to. Since we know the histogram divided the range from 0 to the maximum intensity value in the image, into 50 bins, we can divide the max intensity value by 50 to get the width of each bin, then multiply by the values we observed on the <em>x</em> axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gm_min</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">))</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">gm_max</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">))</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">15</span>
</pre></div>
</div>
</div>
</div>
<p>Next we use <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> to create two <em>binary masks</em> of the image. A binary mask is an image (in this case, a NumPY array) in which each voxel’s value is either 1 or 0. For the first mask, any voxel whose intensity is greater than <code class="docutils literal notranslate"><span class="pre">gm_min</span></code> is set to 1, and the others (lower values) are set to 0. In the second mask, any voxel less than <code class="docutils literal notranslate"><span class="pre">gm_max</span></code> is set to 1, and larger values are set to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_mask1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">brain_vol</span> <span class="o">&gt;</span> <span class="n">gm_min</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">brain_mask2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">brain_vol</span> <span class="o">&lt;</span> <span class="n">gm_max</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Having done this, we combine the two masks by adding them. Now, any voxel that is in the range between <code class="docutils literal notranslate"><span class="pre">gm_min</span></code> and <code class="docutils literal notranslate"><span class="pre">gm_max</span></code> will have a value of 2. Finally, we use <code class="docutils literal notranslate"><span class="pre">np.where()</span></code> again to create a final mask in which any voxel from the combined mask with a value of 2 (grey matter) is set to 1, and all other voxels (those both above and below our grey matter range) are set to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_mask</span> <span class="o">=</span> <span class="n">brain_mask1</span> <span class="o">+</span> <span class="n">brain_mask2</span>
<span class="n">brain_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">brain_mask</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we plot this final mask, we can see that it does a pretty good job of isolating the grey matter of the cortex. There is also grey matter around the ventricles (those dark areas in the centre of the brain in the images we plotted above) which shows up here. Unfortunately, a lot of the tissue in the scalp is also in the same intensity range as grey matter, so we are not able to separate these based on intensity values. Often prior to performing this type of image segmentation, a preprocessing step called <em>skull stripping</em> is applied, which (as it sounds) isolates and removes the skull and other non-brain tissues from the image. Skull stripping is more advanced than we will cover here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_mask</span><span class="p">[:,</span> <span class="mi">96</span><span class="p">,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_49_0.png" src="../_images/read_viz_49_0.png" />
</div>
</div>
</div>
<div class="section" id="image-smoothing">
<h2>Image smoothing<a class="headerlink" href="#image-smoothing" title="Permalink to this headline">¶</a></h2>
<p>One preprocessing operation that can be useful in working with images <strong>smoothing</strong>. Smoothing is really spatial filtering, and it is commonly applied by averaging together the intensity values of nearby voxels. This averaging is done in a weighted fashion, based on distance between voxels. For example, for each voxel we could average together the intensity of that voxel, with half the intensity of the voxels adjacent to it on all sides, and perhaps 10% of intensities that were 2 voxels away from it. In fact, the most common <strong>smoothing kernel</strong> (the mathematical function used to perform this weighted averaging) is called a <em>Gaussian</em> kernel, which is shaped like a normal (bell) curve. In 2 dimensions, it looks like this:</p>
<p><img alt="" src="../_images/gaussian_kernel_2D.jpg" /></p>
<p>When applied to an image slice, a Gaussian smoothing kernel reduces noise, that is, the amount of voxel-to-voxel variation in intensities. So, adjacent voxels will have more similar intensity values after smoothing, making the image appear more blurred. The image below shows an example of the effects of smoothing. In this image, the intensity at each point in the image slice is shown by the height of the mesh at that location, as well as the colour.</p>
<p><img alt="" src="../_images/smoothed_vs_unsmoothed_mesh.jpg" /></p>
<p>Below we will apply Gaussian smoothing to our MRI volume using ndimage’s <code class="docutils literal notranslate"><span class="pre">gaussian_filter()</span></code> function. The one argument we need to supply is <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, which is the width of the smoothing kernel, expressed as units of standard deviation. A larger sigma value will result in a smoother (blurrier) image, because we average over a larger number of voxels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">smoothed</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To plot the image we just re-use the code we used above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_rows</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fig_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_subplots</span> <span class="o">=</span> <span class="n">fig_rows</span> <span class="o">*</span> <span class="n">fig_cols</span>
<span class="n">n_slice</span> <span class="o">=</span> <span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="n">n_slice</span> <span class="o">//</span> <span class="n">n_subplots</span>
<span class="n">plot_range</span> <span class="o">=</span> <span class="n">n_subplots</span> <span class="o">*</span> <span class="n">step_size</span>

<span class="n">start_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_slice</span> <span class="o">-</span> <span class="n">plot_range</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_stop</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed</span><span class="p">[</span><span class="n">img</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_53_0.png" src="../_images/read_viz_53_0.png" />
</div>
</div>
<p>Below we increase <code class="docutils literal notranslate"><span class="pre">sigma</span></code> to 4, resulting in a more smoothed image:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">smoothed</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">fig_rows</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fig_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_subplots</span> <span class="o">=</span> <span class="n">fig_rows</span> <span class="o">*</span> <span class="n">fig_cols</span>
<span class="n">n_slice</span> <span class="o">=</span> <span class="n">brain_vol</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="n">n_slice</span> <span class="o">//</span> <span class="n">n_subplots</span>
<span class="n">plot_range</span> <span class="o">=</span> <span class="n">n_subplots</span> <span class="o">*</span> <span class="n">step_size</span>

<span class="n">start_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_slice</span> <span class="o">-</span> <span class="n">plot_range</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">fig_rows</span><span class="p">,</span> <span class="n">fig_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_stop</span><span class="p">,</span> <span class="n">plot_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)):</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed</span><span class="p">[</span><span class="n">img</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_55_0.png" src="../_images/read_viz_55_0.png" />
</div>
</div>
</div>
<div class="section" id="segmenting-smoothed-images">
<h2>Segmenting smoothed images<a class="headerlink" href="#segmenting-smoothed-images" title="Permalink to this headline">¶</a></h2>
<p>One benefit of smoothing, and the corresponding reduction in noise in the image, is that it can make segmentation a bit cleaner, because adjacent voxels will have more similar values — so they are less extreme overall, and less variable from voxel to voxel. Below we plot the histogram of the smoothed image, and use it (as we did earlier) to determine cutoffs for grey matter and then segment the image. Note that the histogram is different, and more smoothing, due to the smoothing applied to the intensity values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filt</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">brain_vol</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ndi</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">filt</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_57_0.png" src="../_images/read_viz_57_0.png" />
</div>
</div>
<p>Based on the above histogram we select 16 – 25 as our range of bins for grey matter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gm_min</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">filt</span><span class="p">))</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span>
<span class="n">gm_max</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">filt</span><span class="p">))</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>

<span class="n">brain_mask1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">filt</span> <span class="o">&gt;</span> <span class="n">gm_min</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">brain_mask2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">filt</span> <span class="o">&lt;</span> <span class="n">gm_max</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">brain_mask</span> <span class="o">=</span> <span class="n">brain_mask1</span> <span class="o">+</span> <span class="n">brain_mask2</span>
<span class="n">brain_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">brain_mask</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">brain_mask</span><span class="p">[:,</span> <span class="mi">96</span><span class="p">,</span> <span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/read_viz_59_0.png" src="../_images/read_viz_59_0.png" />
</div>
</div>
<p>We can see that this results in a ‘cleaner’ depiction of the grey matter, and in general the grey matter is separated by black (0) voxels from the skull.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./mri"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="learning_objectives.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Learning Objectives</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="nifti.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Working with NIfTI images</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Aaron J Newman<br/>
        
            &copy; Copyright 2020-21. This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>