
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EEG-ERP Preprocessing &#8212; Data Science for Psychology and Neuroscience — in Python</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="http://neuraldatascience.io/eeg/_extra/erp_preprocessing_all.html" />
    <link rel="shortcut icon" href="../../_static/NESC3505_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-171426664-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/NESC3505_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Psychology and Neuroscience — in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/why.html">
   Start with why
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/learning_objectives.html">
   Learning Objectives for this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus.html">
   Syllabus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Pedagogy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/teaching_approach.html">
   Teaching Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/online_learning.html">
   Hybrid Online Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/assessment_evaluation.html">
   Assessment and Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/constructivism.html">
   Constructivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/connectivism.html">
   Connectivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/authenticity.html">
   Authenticity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/21st_cen_skills.html">
   21st Century Skills
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Open Software, Science, &amp; Education
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/open.html">
   Open Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/software.html">
   Free Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/free_licenses.html">
   Free and Open-Source Software Licenses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/peer_review.html">
   Peer Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/for_profit.html">
   For-Profit Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/impact_factors.html">
   Impact Factors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/novelty.html">
   Novelty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/open_publishing.html">
   Open Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/preregistration.html">
   Preregistration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/open_methods.html">
   Open Methods and Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/oer.html">
   Open Educational Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/oer_this_course.html">
   OERs in the Context of this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/licenses.html">
   Licenses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  How to Rock This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/learning_approach.html">
   Learning Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/mindset.html">
   Mindset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/errors_debugging.html">
   Errors and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1/teamwork.html">
   Collaboration and Teamwork
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../2/introduction.html">
   Getting Started with the Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../2/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../2/what_is_nds.html">
   What is Data Science?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/data.html">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../2/tools_for_nds.html">
   Tools for Neural Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/spreadsheets.html">
     Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/spreadsheets_limits.html">
     Limitations of Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/reproducibility.html">
     Reproducibility
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/sci_prog_lang.html">
     Scientific Programming Languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/which_lang.html">
     Which language to use?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/libs.html">
     Libraries and packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/why_python.html">
     Why Python for this Course?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../2/class_tech.html">
   Technologies Used in this Class
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/lms.html">
     Learning Management System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/teams.html">
     MS Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/communication.html">
     Communication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/videos.html">
     Course Videos
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../2/coding.html">
   Coding Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/datacamp.html">
     DataCamp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/py4e.html">
     Python for Everybody (PY4E)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/terminal.html">
     The Terminal and Command Line
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/jupyter.html">
     Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/markdown.html">
     Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/cocalc.html">
     CoCalc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../2/github.html">
     GitHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../2/alltogether.html">
   Putting It All Together
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../2/get_going.html">
   Get Going!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introducing Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/introduction.html">
   Introducing Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/getting_help.html">
   Getting Help with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/variables-and-assignment.html">
   Variables and Assignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/types-conversion.html">
   Data Types and Conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/built-in.html">
   Python Built-Ins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/lists.html">
   Lists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/dictionaries.html">
   Dictionaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/for-loops.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/conditionals.html">
   Conditionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/pandas-dataframes.html">
   pandas DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../3/looping-data-files.html">
   Looping Over Data Files
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualizing Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/introduction.html">
   Introduction to Data Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/plotting.html">
   Introduction to Plotting with Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/proc_vs_oo.html">
   Procedural versus Object-Oriented Plotting in Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/subplots.html">
   Subplots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/plotting_types.html">
   Thinking About Data for Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/seaborn.html">
   Introduction to Plotting with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/human_factors.html">
   Accessibility and Human Factors in Plotting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exploratory Data Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../eda/introduction.html">
   Introduction to EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../eda/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../eda/repeated_measures.html">
   Working with Repeated Measures Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../eda/data_cleaning.html">
   Data Cleaning - Dealing with Outliers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../eda/ttests.html">
   Basic Statistics in Python:
   <em>
    t
   </em>
   tests with SciPy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Single Unit Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/introduction.html">
   Introduction to Single Unit Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/single_unit_intro.html">
   Single Unit Data and Spike Trains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/intro_spike_trains.html">
   Introduction to Spike Train Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/ten_intensities.html">
   Effects of Light Intensity on Spike Rate
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/heat_maps.html">
   Heat Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/intro_multielec_data.html">
   Introducing Multielectrode Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/pandas_multielec.html">
   Working with Multielectrode Data in pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../single_unit/corr_spike_trains.html">
   Correlating spike trains
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  EEG Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Introduction to EEG/ERP Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../time_freq.html">
   Time and Frequency Domains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../erps.html">
   Event-Related Potentials (ERPs)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../components.html">
   ERP Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mne_python.html">
   MNE-Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mne_data.html">
   Exploring MNE’s data structure
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../erp_preprocessing.html">
   EEG-ERP Preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../erp_filtering.html">
     Filtering EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../erp_artifacts.html">
     Artifacts in EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../erp_segmentation.html">
     Segmentation into ERP epochs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../erp_rereferencing.html">
     Re-referencing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../erp_averaging.html">
     Averaging ERPs: Creating MNE Evoked objects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MRI Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../mri/introduction.html">
   Introduction to MRI Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mri/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine_learning/introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../zrefs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/eeg/_extra/erp_preprocessing_all.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook/issues/new?title=Issue%20on%20page%20%2Feeg/_extra/erp_preprocessing_all.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DalPsychNeuro/NESC_3505_textbook/master?urlpath=tree/eeg/_extra/erp_preprocessing_all.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-objectives">
   Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sources-of-noise-in-eeg">
     Sources of noise in EEG
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-packages">
   Load packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-experimental-and-preprocessing-parameters">
   Define experimental and preprocessing parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-raw-data">
   Import raw data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-electrode-positions">
   Set electrode positions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering">
   Filtering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aliasing">
     Aliasing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#offline-filtering">
     Offline filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#offline-filter-settings">
     Offline filter settings
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#always-filter-first">
     Always filter first
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-frequency-spectrum-of-the-raw-data">
     Plot the frequency spectrum of the raw data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter-the-raw-data">
     Filter the raw data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-frequency-spectrum-of-the-filtered-data">
     Plot the frequency spectrum of the filtered data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-effects-of-filtering-in-the-time-domain">
     Visualizing the effects of filtering in the time domain
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#unfiltered">
       Unfiltered
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#filtered">
       Filtered
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#artifacts-in-eeg-data">
   Artifacts in EEG Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eye-blink">
     Eye blink
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eye-movements">
     Eye movements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#muscle-contractions">
     Muscle contractions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#artifact-removal-with-independent-components-analysis-ica">
   Artifact removal with Independent Components Analysis (ICA)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter-data-for-ica">
     Filter data for ICA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-ica-to-data">
     Fit ICA to data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-ica-components">
     Visualize ICA components
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ic-properties">
     Plot IC properties
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identify-eog-artifacts-from-ica-components">
     Identify EOG artifacts from ICA components
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#segmentation-into-erp-epochs">
   Segmentation into ERP epochs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mne-s-events-structure">
     MNE’s events structure
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experimental-design">
     Experimental design
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#label-event-codes">
     Label Event Codes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segment-the-data-into-epochs">
     Segment the data into epochs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-average-erp-across-all-conditions-before-artifact-correction">
     Visualize average ERP across all conditions before artifact correction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalp-topography-maps">
     Scalp topography maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-ica-correction-to-epochs">
     Apply ICA correction to epochs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-average-erp-across-all-conditions-after-artifact-correction">
     Visualize average ERP across all conditions after artifact correction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Scalp topography maps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#re-referencing">
   Re-referencing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-reference-to-select-in-preprocessing">
     What reference to select in preprocessing?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-reference">
     Average reference
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-reference-was-used-in-our-data-set">
     What reference was used in our data set?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Average reference
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#re-reference-the-data-to-mastoids">
   Re-Reference the data to mastoids
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-erps-for-each-condition">
   Create ERPs for each condition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-average-erp-for-each-condition">
   Plot average ERP for each condition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-contrasts-between-conditions">
   Examine contrasts between conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-difference-waves">
   Create difference waves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="eeg-erp-preprocessing">
<h1>EEG-ERP Preprocessing<a class="headerlink" href="#eeg-erp-preprocessing" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Be able to describe the standard steps in preprocessing EEG data for ERP analysis, including filtering, visual inspection, automated artifact detection and removal using independent components analysis, bad channel removal and interpolation, re-referencing, and averaging</p></li>
<li><p>Be able to describe the motivation for each of these preprocessing steps</p></li>
<li><p>Be able to perform each preprocessing step using MNE</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><strong>Preprocessing</strong> is a series of signal processing steps that are performed on data prior to analysis (EDA and/or statistical analysis) and interpretation. In virtually all forms of neuroimaging data, including EEG and MEG, preprocessing is necessary in order to remove noise and obtain a clean signal of interest. In the case of EEG, the data recorded from the scalp are inevitably a mixture of signals generated from the brain (which we likely care about), and other signals generated by sources other than the brain (which we generally don’t wish to interpret).</p>
<p>When they first learn about preprocessing, some people think it sounds a lot like cheating — “doctoring” or “cooking” the data to engineer a specific pattern of desired results. This is <em>not</em> the case, however. Preprocessing steps are carefully designed and implemented based on our understanding of the source and nature of particular sources of noise, as well as our understanding about the nature of the electrical activity generated by the brain. Because the skull is such a poor conductor of electricity, the amplitude of EEG signals recorded from the scalp is very small. In contrast, the amplitude of signals from noise sources — especially from the muscles and eyes — are often an order of magnitude or more larger. Thus if we fail to remove these known sources of noise from the data, it would be unlikely that we would detect the brain activity at all, and at best our ability to do so and make valid interpretations would be greatly diminished. In other words, <em><strong>preprocessing is an essential step in EEG analysis</strong></em>.</p>
<p>In this lesson we will describe each standard step in preprocessing EEG data for ERP analysis, including why it is done, and how, using the MNE package. A script that runs a series of preprocessing steps on data is often called a <strong>piepline</strong>; often this term is used to also include the entire proces from transferring data from the EEG system to a server or other long-term storage, preprocessing, and statistical analysis. The present script is an example of a <strong>preprocessing pieline</strong>.</p>
<div class="section" id="sources-of-noise-in-eeg">
<h3>Sources of noise in EEG<a class="headerlink" href="#sources-of-noise-in-eeg" title="Permalink to this headline">¶</a></h3>
<p>In EEG, sources of noise can be physiological and non-physiological.</p>
<p><strong>Physiological</strong> sources of noise include muscles (especially face and neck muscles, which generate electrical potentials when contracting and relaxing), the eyes (which create distinctive signals both during blinks, and when the eyeballs move), and sometimes heartbeats (the heart produces strong, distinctive electrical signals as commonly measured with the electrocardiogram, or EKG) and breathing; the latter two sources typically are more of a problem for MEG than EEG data.</p>
<p><strong>Non-physiological</strong> sources include artifacts generated when electrodes move relative to the scalp, when the electrode wires move, and ambient electromagnetic noise. Electromagnetic noise is created by virtually any device that uses electricity (except some battery-powered devices). In North America and some other parts of the world, <strong>line voltage</strong> — the alternating current that is provided through wired electrical outlets — oscillates at 60 Hz; in Europe and other parts of the world, line voltage alternates at 50 Hz. Thus depending on where the EEG data were recorded, they will likely contain a fairly distinct peak in the frequency spectrum at 50 or 60 Hz. While line noise is the most common source of electromagnetic interference, noise at other frequencies can also be produced by other equipment near the neuroimaging system (though sometimes this may be in another room or another floor of the building, and difficult to identify), or even stronger, transient sources (such as the 2-way radio of a passing truck).</p>
<p>We commonly refer to particular types of noise from known sources as <strong>artifacts</strong> in EEG. Thus you may see reference to <em>eye blink artifact</em>, <em>line noise artifact</em>, etc..</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="load-packages">
<h2>Load packages<a class="headerlink" href="#load-packages" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mne</span>
<span class="n">mne</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>  <span class="c1"># reduce extraneous MNE output</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-experimental-and-preprocessing-parameters">
<h2>Define experimental and preprocessing parameters<a class="headerlink" href="#define-experimental-and-preprocessing-parameters" title="Permalink to this headline">¶</a></h2>
<p>In the single unit chapter, we started the practice of defining experimental parameters as variables at the top of a notebook. This is good practice because the values are then defined when you need them. As well, it’s good practice to define all of these parameters at the top of the file, rather than in the cell where you first need to use them. This is because, if later you want to change a parameter and re-run your notebook, it’s easy to find all of the parameters, rather than scrolling through the script to find them. As well, when you report your results (e.g., in the Methods section of a paper), many of these parameters are things that you should include in your report. Defining them all at the top of a script makes it easy to find these values when you’re writing up your study.</p>
<div class="alert alert-block alert-info">
<h3>Best practices in EEG/MEG reporting</h3>
<p>Especially for people who are new to any field of neuroimaging, there can be an overwhelming array of technical information relating to how the data were collected, preprocessed, and analyzed. This can make it challenging to know how, or what, to report. Fortunately, leaders in the field have reached a general consensus on this, and have published guidelines for reporting EEG and MEG study results. The most recent of these is from <a class="reference external" href="https://www.nature.com/articles/s41593-020-00709-0">Pernet and colleagues (2020)</a> and is endorsed by the Organization for Human Brain Mapping.</p>
</div> 
<p>Below we define all the parameters we’ll use in this preprocessing script. We’ll explain them in more detail as we reach each step in the preprocessing pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Participant ID code</span>
<span class="n">p_id</span> <span class="o">=</span> <span class="s1">&#39;N400_dataset_14&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="import-raw-data">
<h2>Import raw data<a class="headerlink" href="#import-raw-data" title="Permalink to this headline">¶</a></h2>
<p>This is just the same as in the previous lesson</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_file</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span> <span class="o">+</span> <span class="n">p_id</span> <span class="o">+</span> <span class="s1">&#39;.vhdr&#39;</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_brainvision</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">377293346.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">raw_file</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span> <span class="o">+</span> <span class="n">p_id</span> <span class="o">+</span> <span class="s1">&#39;.vhdr&#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_brainvision</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/io/brainvision/brainvision.py</span> in <span class="ni">read_raw_brainvision</span><span class="nt">(vhdr_fname, eog, misc, scale, preload, verbose)</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span>     <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">Raw</span> <span class="p">:</span> <span class="n">Documentation</span> <span class="n">of</span> <span class="n">attribute</span> <span class="ow">and</span> <span class="n">methods</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">856</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">857</span><span class="sd">     return RawBrainVision(vhdr_fname=vhdr_fname, eog=eog,</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span><span class="sd">                           misc=misc, scale=scale, preload=preload,</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span><span class="sd">                           verbose=verbose)</span>

<span class="nn">&lt;decorator-gen-211&gt;</span> in <span class="ni">__init__</span><span class="nt">(self, vhdr_fname, eog, misc, scale, preload, verbose)</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/io/brainvision/brainvision.py</span> in <span class="ni">__init__</span><span class="nt">(self, vhdr_fname, eog, misc, scale, preload, verbose)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd">         vhdr_fname = op.abspath(vhdr_fname)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd">         (info, data_fname, fmt, order, n_samples, mrk_fname, montage,</span>
<span class="ne">---&gt; </span><span class="mi">73</span><span class="sd">          orig_units) = _get_vhdr_info(vhdr_fname, eog, misc, scale)</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">75</span><span class="sd">         with open(data_fname, &#39;rb&#39;) as f:</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/io/brainvision/brainvision.py</span> in <span class="ni">_get_vhdr_info</span><span class="nt">(vhdr_fname, eog, misc, scale)</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span><span class="sd">                       &quot;not a file with extension &#39;%s&#39;.&quot; % ext)</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">457</span><span class="sd">     settings, cfg, cinfostr, info = _aux_vhdr_info(vhdr_fname)</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span><span class="sd">     info._unlocked = True</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span><span class="sd"> </span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/io/brainvision/brainvision.py</span> in <span class="ni">_aux_vhdr_info</span><span class="nt">(vhdr_fname)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span><span class="sd"> def _aux_vhdr_info(vhdr_fname):</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span><span class="sd">     &quot;&quot;&quot;</span><span class="n">Aux</span> <span class="n">function</span> <span class="k">for</span> <span class="n">_get_vhdr_info</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">359</span><span class="s2">     with open(vhdr_fname, &#39;rb&#39;) as f:</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span><span class="s2">         # extract the first section to resemble a cfg</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span><span class="s2">         header = f.readline()</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/Users/aaron/3505/NESC_3505_textbook/eeg/_extra/data/N400_dataset_14.vhdr&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="set-electrode-positions">
<h2>Set electrode positions<a class="headerlink" href="#set-electrode-positions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Electrode position file</span>
<span class="n">montage</span> <span class="o">=</span> <span class="s1">&#39;standard_1005&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">set_montage</span><span class="p">(</span><span class="n">montage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">546628248.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw</span><span class="o">.</span><span class="n">set_montage</span><span class="p">(</span><span class="n">montage</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h2>
<p>As described in the previous section on <span class="xref myst">Time and Frequency Domains</span>, a complex time-varying signal like EEG can be represented as a combination of sine waves of many different frequencies. Human EEG largely comprises signal power in a range of frequencies from 1–30 Hz; there is some evidence that higher frequencies may also carry important neurophysiological information, however in most EEG studies — and certainly in ERP studies — the vast majority of research questions concerns EEG signals in the 1–30 Hz frequency range.</p>
<p>Sources of noise also manifest as oscillating frequencies that are picked up by EEG. In particular, <em>low frequency noise</em> comes from sources such as movement of the head and electrode wires, and perspiration on the scalp, while <em>high frequency noise</em> comes from sources including electromagnetic interference, and muscle contractions (especially facial and neck muscles). The frequency of these sources of noise may overlap with the 1-30 Hz EEG nad of interest, but in general they tend to be lower and higher, respectively, than human EEG. This means that by reducing the power of the signal at the frequencies above and below the range of experimental interest, we can reduce noise with minimal impact on the signals of interest. This process is called <strong>filtering</strong>.</p>
<p>Filtering typically occurs at two points in the EEG pipeline: first at the time the data are recorded, and secondly during preprocessing. When EEG data are collected, the EEG amplifier will at the very least have a filter that cuts off frequencies that are higher than a certain threshold. This is called the <strong>low pass filter cutoff</strong>, because the filter “passes” lower frequencies through, but attenuates (reduces) higher frequencies. A low pass filter is absolutely <em>necessary</em> during digital recording of EEG (or any signal), because of a phenomenon known as <strong>aliasing</strong>. This occurs when a high-frequency signal is sampled at a rate lower than the frequency of the signal, and the result is an artifact (an artificial signal that distorts our true signal) at a much lower frequency than the actual high-frequency source.</p>
<div class="section" id="aliasing">
<h3>Aliasing<a class="headerlink" href="#aliasing" title="Permalink to this headline">¶</a></h3>
<p>Simply knowing that aliasing causes high-frequency noise to be represented in the data as low-frequency artifacts — and that for this reason it’s e to use a low-pass filter — is the most critical thing for someone doing EEG research. However, it’s good to understand this phenomenon a little deeper.</p>
<p>For example, in the current data set the EEG was recorded with a sampling rate of 500 Hz, meaning we obtained a measurement from each electrode every 2 ms. This is a sufficient sampling rate to detect an EEG signal at 30 Hz, because over the course of each cycle of the 30 Hz oscillation (e.g., from one peak to the next), which would last 1/30th of a second, we would have 500 / 30  <span class="math notranslate nohighlight">\(\approx\)</span> 17 measurements of the waveform — so we should have enough samples to accurately reflect the shape of the oscillating sine wave.</p>
<p>In contrast, imagine that during the recording, there was an electromagnetic (noise) signal present in the environment that oscillated at 1700 Hz. Thus in 1 second, the noise signal would have 1700 oscillations, but our EEG amplifier could not detect this, since it is only sampling 500 times per second. In fact, 3.4 oscillations of the noise waveform would occur between every sample acquired by the EEG amplifier. Since 1700 is not an even multiple of 500, each sample acquired by our EEG amplifier would also capture a different phase of the 17000 Hz oscillation — sometimes its peak, sometimes its trough, and sometimes somewhere in between. When we “connect the dots” between these samples to draw our measured EEG signal, these measurements at different points in the oscillation will end up looking like a much lower-frequency oscillation. <strong>This is shown in the figure below.</strong></p>
<p><img alt="aliasing figure" src="../../_images/_extra" /></p>
<p>The highest frequency that one can accurately record at a given sampling rate is called the <strong>Nyquist frequency</strong>. This can be defined as either 1/2 or 1/3 of the sampling rate. In general, you should use 1/3 because it is safest. Using 1/2 is acceptable only if you can guarantee that your noise sources and your signal are <em>phase locked</em>, meaning (in a simplified way) that their peaks and troughs are synchronized with each other. Since we can’t guarantee this in real-world situations where noise is unpredictable, the 1/3 rule should be used.</p>
</div>
<div class="section" id="offline-filtering">
<h3>Offline filtering<a class="headerlink" href="#offline-filtering" title="Permalink to this headline">¶</a></h3>
<p><strong>Offline</strong> is a term that is generally used in EEG to refer to processing steps that are applied after the data are collected, in contrast to <strong>online</strong> processing that is applied when data are collected. So, the low-pass filter used during recording to prevent aliasing is an example of an online filter, while filtering that we apply in a script like this is offline filtering.</p>
<p>Offline filtering serves to remove more noise from the data than online filtering. In general, EEG researchers prefer to record with a wider range of filter settings, in part because filters can cause distortions to the data, particularly if the cutoffs are too close to the range of frequencies of interest. Any online filter that is applied to the data is permanent, since the data are originally recorded that way — there is no “undo” option. In contrast, with offline filtering one can apply different filters and observe the results on the data, and re-load the original data and use different filter settings if necessary.</p>
</div>
<div class="section" id="offline-filter-settings">
<h3>Offline filter settings<a class="headerlink" href="#offline-filter-settings" title="Permalink to this headline">¶</a></h3>
<p>We defined our filter cutoffs in the parameters section above, and the settings used are pretty standard in the world of ERP analysis: a high-pass (low frequency) cutoff of 0.1 Hz, and a low-pass (high frequency) cutoff of 30 Hz (some researchers use 40 Hz instead). Together, this is called a <strong>band pass filter</strong>, because we preseve a “band” of frequencies between e high-pass and low-pass cutoffs.</p>
<p>tse settings strike an optimal balance between attenuating artifacts outside the range of human EEG signals of interest, without inducing artifacts of their own. These artifacts typically occur if the filter cutoffs are too close to the range of frequencies of scientific interest. It turns ou that the high-pass cutoff needs to be much lower (by a factor of about 10) than the lowest frequency of interest (hence 0.1 when our lowest frequency of interest is 1 Hz), while the low-pass cutoff can be much closer to the highest frequency of interest (in most ERP research, components of interest are rarely higher than about 10 Hz).</p>
</div>
<div class="section" id="always-filter-first">
<h3>Always filter first<a class="headerlink" href="#always-filter-first" title="Permalink to this headline">¶</a></h3>
<p>Filtering should always be one of the first preprocessing steps you apply to your data. Most importantly, filtering should be applied to the continuous, raw EEG data before it is chopped into short segments time-locked to the event codes of interest. This is because we need long segments of data in order to accurately estimate and remove low frequencies. For example, our low frequency cutoff of 0.1 Hz corresponds to one sine wave oscillation every 10 sec, and we would need 20-30 s of data to estimate this accurately. A typical segment of data for ERP analysis is only about 1-2 s long at most, and so once your data are segmented, you can’t remove low frequencies. Even for high frequencies, filtering results in removing the first and last few data points from the data (for technical reasons we won’t cover here), and so again it’s better to filter at the start and not worry about it later.</p>
<p>MNE provides a <code class="docutils literal notranslate"><span class="pre">.filter()</span></code> method for <code class="docutils literal notranslate"><span class="pre">Raw</span></code> data that is simple to apply, but is actually very powerful because of the many options provided. If you’re interested in more detailed discussion of how filtering works, both in general and in MNE, their website has a very detailed <a class="reference external" href="https://mne.tools/stable/auto_tutorials/preprocessing/25_background_filtering.html">discussion of filtering</a>.</p>
</div>
<div class="section" id="plot-the-frequency-spectrum-of-the-raw-data">
<h3>Plot the frequency spectrum of the raw data<a class="headerlink" href="#plot-the-frequency-spectrum-of-the-raw-data" title="Permalink to this headline">¶</a></h3>
<p>MNE’s <code class="docutils literal notranslate"><span class="pre">.plot_psd()</span></code> method plots the <strong>power spectral density</strong> (PSD) of a data set. <em>Power</em> refers to the amplitude of sine waves when we are working in the frequency domain, <em>spectrum</em> means a range of frequencies, and <em>density</em> basically means we’re quantifying the power over a range of frequencies. In a sense, you can think of a PSD as a histogram of frequency information — frequency is a continuous variable that is divided into bins (bin size is determined automatically), and the amount of power is plotted for each frequency bin. We set the <code class="docutils literal notranslate"><span class="pre">fmax</span></code> kwarg to 100 because we aren’t interested in frequencies above this.</p>
<p>MNE automatically colour-codes electrodes based on their position on the scalp, as shown in the inset to the figure, and the lines in the PSD represent the data from each corresponding electrode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3646423974.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The PSD shows a clear spike at 60 Hz, which is the frequency of AC electrical service in Canada, where the data was recorded. This is the electromagnetic interference mentioned above.</p>
<p>The PSD also shows a typical property of human EEG (and many other kinds frequency spectra), known as the <strong>1 / <em>f</em></strong> property. That is, power is highest at the lowest frequencies, and drops off with increasing frequency. The dropoff is not linear (a diagonal line), but rather decreases at approximately 1 divided by the frequency.</p>
<p>The vertical dashed line shows the low-pass cutoff that was used during data acquisition. This information was stored in the EEG header file, and read by MNE when the data was imported.</p>
</div>
<div class="section" id="filter-the-raw-data">
<h3>Filter the raw data<a class="headerlink" href="#filter-the-raw-data" title="Permalink to this headline">¶</a></h3>
<p>We need to chain the <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> and <code class="docutils literal notranslate"><span class="pre">.filter()</span></code> methods because by default, the <code class="docutils literal notranslate"><span class="pre">.filter()</span></code> method modifies the raw data in-place, rather than creating a new, filtered copy of the data. This is sensible for managing the memory used, but can create problems if we want to change the filter settings and redo the filtering step.</p>
<p>All of the parameters used for filtering were defined at the top of this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter settings</span>
<span class="n">low_cut</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">hi_cut</span>  <span class="o">=</span> <span class="mi">30</span>
<span class="n">l_trans_bandwidth</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="n">h_trans_bandwidth</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="n">filter_length</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>
<span class="n">filter_method</span> <span class="o">=</span> <span class="s1">&#39;fir&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_filt</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">low_cut</span><span class="p">,</span> <span class="n">hi_cut</span><span class="p">,</span>
                             <span class="n">l_trans_bandwidth</span> <span class="o">=</span> <span class="n">l_trans_bandwidth</span><span class="p">,</span>
                             <span class="n">h_trans_bandwidth</span> <span class="o">=</span> <span class="n">h_trans_bandwidth</span><span class="p">,</span>
                             <span class="n">filter_length</span><span class="o">=</span><span class="n">filter_length</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">filter_method</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2600402066.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw_filt</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">low_cut</span><span class="p">,</span> <span class="n">hi_cut</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                              <span class="n">l_trans_bandwidth</span> <span class="o">=</span> <span class="n">l_trans_bandwidth</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                              <span class="n">h_trans_bandwidth</span> <span class="o">=</span> <span class="n">h_trans_bandwidth</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                              <span class="n">filter_length</span><span class="o">=</span><span class="n">filter_length</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                              <span class="n">method</span><span class="o">=</span><span class="n">filter_method</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-frequency-spectrum-of-the-filtered-data">
<h3>Plot the frequency spectrum of the filtered data<a class="headerlink" href="#plot-the-frequency-spectrum-of-the-filtered-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_filt</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3639478233.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw_filt</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;raw_filt&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The effects of our low-pass filter are quite evident — in comparison to the pre-filtering PSD, there is a dramatic drop in power above our 30 Hz cutoff (note that the dashed line has moved to reflect our new low-pass cutoff). The spike at 60 Hz is gone (actually it’s still there, but very small), because the filtering virtually eliminated this noise from the data.</p>
<p>The effects of the high-pass filtering are much harder to see, since the scale is linear from 0–100 Hz, but our cutoff of 0.1 Hz was very close to zero. If we set <code class="docutils literal notranslate"><span class="pre">fmax</span></code> to 10 we can see the effects of the high-pass cutoff more clearly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_filt</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2367464127.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw_filt</span><span class="o">.</span><span class="n">plot_psd</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;raw_filt&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Note that for both the high- and low-pass filters, the power does not drop of sharply right at the cutoff frequency we specified. Rather, there is a <strong>roll-off</strong> — a range of frequencies over which the power gradually decreases. The shape of the roll-off is a property of the filter that is determined by its parameters, and some roll-off is a necessary feature of any filter if aftifacts are to be avoided. Again, this is a deep topic that we won’t delve into here, but in general it is useful to remember the adage that <em>precision in the frequency domain is inversely related to precision in the time domain</em>. In other words, if we use a sharper frequency cutoff, we are likely to induce larger artifacts in the data, when we view the filtered data in the time domain.</p>
</div>
<div class="section" id="visualizing-the-effects-of-filtering-in-the-time-domain">
<h3>Visualizing the effects of filtering in the time domain<a class="headerlink" href="#visualizing-the-effects-of-filtering-in-the-time-domain" title="Permalink to this headline">¶</a></h3>
<p>Below we plot 5 s of data, comparing the raw and filtered versions.</p>
<div class="section" id="unfiltered">
<h4>Unfiltered<a class="headerlink" href="#unfiltered" title="Permalink to this headline">¶</a></h4>
<p>Note the high frequency noise in virtually all channels — the oscillations that occur very rapidly. This is particularly large in channel F8. This is primarily 60 Hz line noise.</p>
<p>Channels F8 and Fp2 show low frequency noise as well — these are the slow drifts up and down seen in these channels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>  <span class="c1"># times are in seconds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3601412991.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>  <span class="c1"># times are in seconds</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filtered">
<h4>Filtered<a class="headerlink" href="#filtered" title="Permalink to this headline">¶</a></h4>
<p>The plot below shows the same sample of data after filtering. The high frequency noise is gone. The low-frequency noise is perhaps a bit reduced, but not eliminated. This is because our high-pass filter setting was 0.1 Hz, which means that only frequencies below 1 cycle per 10 sec would be reduced. These are so slow that we would not even see much evidence of them in 5 sec of data. Although we could filter the data with a higher high-pass cutoff (e.g., 1 Hz instead of 0.1 Hz), this risks inducing artifacts into the data (<a class="reference external" href="https://doi.org/10.1111/psyp.12437">Tanner, Morgan-Short, &amp; Luck, 2015</a>), so we don’t.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_filt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2167907457.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw_filt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;raw_filt&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="artifacts-in-eeg-data">
<h2>Artifacts in EEG Data<a class="headerlink" href="#artifacts-in-eeg-data" title="Permalink to this headline">¶</a></h2>
<p>Recall that the term <strong>artifact</strong> in EEG refers to any noise in the data that can be attributed to a specific source. So eye blinks, eye movements, and muscle contractions are all types of artifacts. It is important to remove these from the data, to increase our confidence that the results we ultimately interpret are actually due to brain activity, and not these other sources.</p>
<p>Common physiological artifacts, including eye blinks, eye movements, and muscle contractions, have highly characteristic properties in time and frequency. Examples of each are shown below:</p>
<div class="section" id="eye-blink">
<h3>Eye blink<a class="headerlink" href="#eye-blink" title="Permalink to this headline">¶</a></h3>
<p>There are a series of several eye blinks in the data below, the first at 242 s. You can see that the size of eye blink artifacts are typically on the order of 10x as large as ongoing EEG, which is why they are such a problem. Note that we have scaled the amplitude scale (<em>y</em> axis) of the EEG data differently than in the plots above, so that the ongoing EEG is quite flat, and the blinks stand out more clearly.</p>
<img src='images/eog_blink.png' width=400>
<p>Because the artifact originates at the eyes, is is picked up most strongly by the electrodes on the forehead, Fp1 and Fp2, as well as other frontal electrodes (the ones whose labels start with <em>F</em>, though much smaller). The electrical potential sharply increases, then decreases, over a period of about 250-300 ms for a typical blink. The artifact actually <em>inverts</em> at more posterior electrodes, for example at TP9 and TP10 in the figure above. These are the characteristic properties of an eye blink artifact, which can be used to identify them.</p>
</div>
<div class="section" id="eye-movements">
<h3>Eye movements<a class="headerlink" href="#eye-movements" title="Permalink to this headline">¶</a></h3>
<p>The neurons in the retina are organized in a highly oriented fashion, such that they form an electrical <strong>dipole</strong> — a source with positive and negative poles. This is exactly the kind of electrical source that EEG is good at detecting. As long as the eye’s position doesn’t change, the diploe created by the retina doesn’t affect EEG recordings, because it is constant (not changing). However, as the eye moves to look at different locations in space, the dipole moves, and this is detected by the electrodes on the scalp. When they eyes move to the left or right, the effect on EEG electrodes is that the electrical potential will increase at frontal electrodes on one side of the head, and decrease on the other side. Which side becomes more positive or negative depends on the direction of the movement.</p>
<p>An example of a horizontal eye movement is shown in the figure below, overlapping the time where the vertical green line is shown (this line is an event marker, but this is irrelevant for our present purposes). At electrodes Fp1 and Fp2, the artifact looks very similar to a blink. However, note how there is a roughly “square wave” effect at electrodes F7 and F8 (and to a lesser extent, at F3 and F4), and that this goes positive at F7/F3, and negative at F8/F4. This is the hallmark of a horizontal eye movement artifact. In the example below, the horizontal eye movement is followed by two blinks. We can tell these are blinks because the polarity (direction of change) at both F7 and F8 is the same (positive/upward).</p>
<img src='images/eog_horiz.png' width=200px></div>
<div class="section" id="muscle-contractions">
<h3>Muscle contractions<a class="headerlink" href="#muscle-contractions" title="Permalink to this headline">¶</a></h3>
<p>In the figure below, note the increase in high frequency activity starting just after 872 s, especially at channels F3, F7, and TP9. This is typical of a muscle contraction, likely of the face and/or neck. Brief contractions like this are usually not a problem, but if the participant is tense throughout the experiment, or at least for extended periods, then this high frequency noise can make it more challenging to detect ERPs. Muscle contractions typically have a fairly broad frequency range, from about 20-40 Hz, which means that this artifact will be present even after the data is band-pass filtered.</p>
<img src='images/eeg_muscle.png' width=400px></div>
</div>
<div class="section" id="artifact-removal-with-independent-components-analysis-ica">
<h2>Artifact removal with Independent Components Analysis (ICA)<a class="headerlink" href="#artifact-removal-with-independent-components-analysis-ica" title="Permalink to this headline">¶</a></h2>
<p>ICA is a <em>blind source separation</em> algorithm. In other words, it can take a complex signal and separate it into mathematically independent <em>components</em>. Note that the term “components” here is not used in the sense of ERP components (like the N170 or N400) that were discussed earlier. Rather, in ICA <em>components</em> are the individual underlying signals that were mixed together during recording. So for example, in EEG each electrode will record a mixture of brain activity (which itself may comprise multiple sources within the brain, such as the activity of different brain areas) and noise (including physiological and non-physiological artifacts). ICA is capable of separating EEG from artifacts (and separating different types of artifacts) because, over time and across all of hte recording electrodes, each signal with a different source will have different spatio-temporal properties.</p>
<p>A nice example of using ICA, that may seem a. bit less abstract than EEG data, is audio recording. Imagine that we have two people in a room having a conversation, and there is background noise in the room such as from the ventilation system. If we have a single microphone in the room, all three signals (person A, person B, and the ventilation) will be mixed in the recording and it will be hard to separate them. However, if we have three microphones at different locations in the room, then each will pick up all three sound sources, but to different degrees depending on the location of each microphone. ICA can use the audio from all three microphones to find independent sources in the data (i.e., person A, person B, and the ventilation), based on how the sounds from each person, and the ventilation, differ systematically across the three microphones. But this only works because we have multiple independent sources (the microphones) sampling the data from different locations.</p>
<p>Likewise with EEG, it is necessary to have multiple electrodes (the sources) to run ICA. The maximum number of ICA components  that can be derived from a data set is equal to the number of electrodes (channels) we have. However, in practice the number of independent sources in the data is lower than the number of electrodes, and we can limit the number of ICA components accordingly, as we’ll see below.</p>
<p>In EEG, ICA has become widely used for artifact identification and removal. This is because it does a very good job of identifying ocular artifacts (blinks and eye movements), and also usually muscle artifact as well. Moreover, because the different ICA components are mathematically independent of each other, having identified which components are “noise” (such as blinks), we can remove these components from the data without affecting the other components. This means we can effectively remove the effects of ocular artifacts from the data, while preserving the EEG signals. This is usually preferable to older approaches, such as removing any trial containing an artifact from the data set completely. ICA allows us to remove artifacts while keeping all of the trials.</p>
<div class="section" id="filter-data-for-ica">
<h3>Filter data for ICA<a class="headerlink" href="#filter-data-for-ica" title="Permalink to this headline">¶</a></h3>
<p>ICA is very good at capturing features of the data that explain the most <em>variance</em>. Recall that variance, statistically speaking, is any deviation from the mean. Blinks and eye movements are well-captured by ICA because they are so much larger than EEG, and so they contain a lot of the variance in the EEG recordings. Likewise, low-frequency drift in the data explains large amounts of variance, because of the 1/f property of EEG data discussed earlier — the lowest frequencies contain the most power. For this reason, ICA works best on data that has more low-frequency power removed than the data that we ultimately want to analyze. So we will filter the data for ICA with a 1 Hz high-pass cutoff, rather than a 0.1 Hz cutoff as we used above. A useful property of ICA is that we can compute ICA based on a more-filtered version of the data, identify the artifacts based on this, and then apply the same ICA decomposition (i.e., how ICA breaks the data down into components) to the data that were filtered as we wanted for ERP analysis. Below we do this, running the same filtering command as we did earlier, except with a different high-pass (low frequency) cut-off:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ica_low_cut</span> <span class="o">=</span> <span class="mf">1.0</span>       <span class="c1"># For ICA, we filter out more low-frequency power</span>

<span class="n">raw_ica</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ica_low_cut</span><span class="p">,</span> <span class="n">hi_cut</span><span class="p">,</span>
                             <span class="n">l_trans_bandwidth</span> <span class="o">=</span> <span class="n">l_trans_bandwidth</span><span class="p">,</span>
                             <span class="n">h_trans_bandwidth</span> <span class="o">=</span> <span class="n">h_trans_bandwidth</span><span class="p">,</span>
                             <span class="n">filter_length</span><span class="o">=</span><span class="n">filter_length</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">filter_method</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2680774099.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">ica_low_cut</span> <span class="o">=</span> <span class="mf">1.0</span>       <span class="c1"># For ICA, we filter out more low-frequency power</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">raw_ica</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ica_low_cut</span><span class="p">,</span> <span class="n">hi_cut</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                              <span class="n">l_trans_bandwidth</span> <span class="o">=</span> <span class="n">l_trans_bandwidth</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                              <span class="n">h_trans_bandwidth</span> <span class="o">=</span> <span class="n">h_trans_bandwidth</span><span class="p">,</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>ICA likes to work with segments of data, rather than the continuous raw data. We call segments of EEG data <strong>epochs</strong>, a word which means “a period of time”. Typically when talking about ERPs, <em>epochs</em> refers to the segments of data that are time-locked to experimental events of interest. Here, however, we use the term more generically to refer to any segment of EEG data. So here we will segment the entire raw data recording into a series of 1 s segments, and save these as <code class="docutils literal notranslate"><span class="pre">epochs_ica</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Break raw data into 1 s epochs</span>
<span class="n">tstep</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">events_ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">make_fixed_length_events</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">tstep</span><span class="p">)</span>
<span class="n">epochs_ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> <span class="n">events_ica</span><span class="p">,</span>
                        <span class="n">tmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tstep</span><span class="p">,</span>
                        <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">240640595.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Break raw data into 1 s epochs</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">tstep</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">events_ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">make_fixed_length_events</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">tstep</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">epochs_ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> <span class="n">events_ica</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                         <span class="n">tmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tstep</span><span class="p">,</span>

<span class="ne">NameError</span>: name &#39;raw_ica&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Next we run a function from the autoreject package that will look at the data and automatically determine a threshold to use to find sections of the data that are excessively noisy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autoreject</span> <span class="kn">import</span> <span class="n">get_rejection_threshold</span>

<span class="c1">### Find appropriate rejection threshold to eliminate noisy trials from ICA fitting</span>
<span class="n">reject</span> <span class="o">=</span> <span class="n">get_rejection_threshold</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">);</span>
<span class="n">reject</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">1241567046.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">### Find appropriate rejection threshold to eliminate noisy trials from ICA fitting</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">reject</span> <span class="o">=</span> <span class="n">get_rejection_threshold</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">);</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">reject</span>

<span class="ne">NameError</span>: name &#39;epochs_ica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fit-ica-to-data">
<h3>Fit ICA to data<a class="headerlink" href="#fit-ica-to-data" title="Permalink to this headline">¶</a></h3>
<p>Running ICA on our data involves two steps:</p>
<ol class="simple">
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">ICA</span></code> object with the parameters (kwargs) that we want to use</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code> this object to the data — which effectively runs the algorithm on the data, using the parameters set in step 1</p></li>
</ol>
<p>This may seem overly complex — why define and object and then apply a <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> method, rather than having a method that we just apply to the data in a single step/line of code?</p>
<p>The reason relates to the nature of object-oriented languages. By creating an <code class="docutils literal notranslate"><span class="pre">ICA</span></code> object, we have a data structure — separate from the EEG data itself — that stores important information about this preprocessing step. After we fit the <code class="docutils literal notranslate"><span class="pre">ICA</span></code> object to the data, the object contains the values that were estimated from the data. In other words, running <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> on the data <em>doesn’t change the data itself</em>, only the <code class="docutils literal notranslate"><span class="pre">ICA</span></code> object. That way, this step is “non-destructive” in the sense that if we aren’t happy with the results, we don’t need to worry about re-loading our data — we can simply modify parameters of the <code class="docutils literal notranslate"><span class="pre">ICA</span></code> object and re-fit it. We’ll do this for ICA as well; later in the course we’ll see that this is actually the primary way in which machine learning and statistical models are fit to data sets in Python.</p>
<p>The first parameter that we want to specify is the number of independent components we want. Recall that by default, ICA will compute as many components as there are channels in the data, but this is typically more than is necessary or useful. The <code class="docutils literal notranslate"><span class="pre">n_components</span></code> parameter of ICA can be specified in one of two ways. One is to provide an integer specifying the actual number of components desired. An optimal number for this, however, is hard to know in advance. The other way is to specify a floating point number ≤ 1, which represents the percentage of data that the ICA components should, collectively, explain. Here we use <code class="docutils literal notranslate"><span class="pre">.99</span></code>, which means we want as many independent components as needed to explain 99% of the variance in the data. Typically this is a good value to use.</p>
<p>The other parameter is <code class="docutils literal notranslate"><span class="pre">random_state</span></code>. We use this because ICA is an <em>iterative</em> algorithm that starts with a set of random parameters, and then over a series of fitting steps computes the optimal values of these parameters. The set of random parameters it starts with determines the results to some extent. That is, if you fit ICA repeatedly to the data, you will generally get very similar, but not identical, results each time, because of the different random starting points. By specifying a <code class="docutils literal notranslate"><span class="pre">random_state</span></code>, we ensure that the same “random” parameters are used each time, meaning that our results will be replicable. The value 42 is used by convention, because it is the “Answer to the Ultimate Question of Life, the Universe, and Everything” in <em>The Hitchhiker’s Guide to the Galaxy</em> (Adams, 1979).</p>
<p>In fitting ICA to the data, we include a couple of other parameters, which were defined earlier. <code class="docutils literal notranslate"><span class="pre">reject</span></code> comes from <code class="docutils literal notranslate"><span class="pre">get_rejection_threshold</span></code>, and <code class="docutils literal notranslate"><span class="pre">tstep</span></code> is the 1 s intervals that we segmented our data in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ICA parameters</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>   <span class="c1"># ensures ICA is reproducable each time it&#39;s run</span>
<span class="n">ica_n_components</span> <span class="o">=</span> <span class="mf">.99</span>     <span class="c1"># Specify n_components as a decimal to set % explained variance</span>

<span class="c1"># Fit ICA</span>
<span class="n">ica</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">ICA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">ica_n_components</span><span class="p">,</span>
                            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                            <span class="p">)</span>
<span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">,</span>
        <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">,</span>
        <span class="n">tstep</span><span class="o">=</span><span class="n">tstep</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4288590099.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>                             <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>                             <span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>         <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>         <span class="n">tstep</span><span class="o">=</span><span class="n">tstep</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;epochs_ica&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> step produces the output you see above, showing some of the resulting parameters stored in <code class="docutils literal notranslate"><span class="pre">ica</span></code>.</p>
</div>
<div class="section" id="visualize-ica-components">
<h3>Visualize ICA components<a class="headerlink" href="#visualize-ica-components" title="Permalink to this headline">¶</a></h3>
<p>Every IC (an independent component identified by ICA) is a signal that varies over time, that has a “weighting” at each channel - reflecting how strongly present that IC is in that channel. In other words, the time course of an IC is the same at all electrodes, but it is bigger at some, and smaller at others.</p>
<p>We can visualize each component as a <strong>scalp topography map</strong>, showing where on the scalp the IC is largest. <em>Topo maps</em>, as they are often abbreviated, are a different way of visualizing EEG data than we’ve seen before. Whereas previously we’ve viewed EEG as electrical potential over time, topo maps show how the potential are distributed spatially, at a specific point in time (or averaged over a period of time). The maps use the red-blue colour map where red is positive, blue is negative, and white is zero. “Positive” and “negative” in ICA topo maps can reflect cases where a component has the same shape over time, but opposite (negative vs. positive) electrical polarity at different scalp locations. This can be seen, for example, in <code class="docutils literal notranslate"><span class="pre">ICA001</span></code> below, which reflects the opposite polarities induced by horizontal eye movements.</p>
<p>Indeed, in the figure below we can see that a few ICs are likely ocular artifacts, because they weight most heavily around the front of the head (the top of each subplot, where the nose is drawn). In particular, <code class="docutils literal notranslate"><span class="pre">ICA000</span></code> is likely blink artifact, and <code class="docutils literal notranslate"><span class="pre">ICA001</span></code> is likely horizontal eye movement. <code class="docutils literal notranslate"><span class="pre">ICA002</span></code> may be eye movement as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ica</span><span class="o">.</span><span class="n">plot_components</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3000553460.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ica</span><span class="o">.</span><span class="n">plot_components</span><span class="p">();</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/preprocessing/ica.py</span> in <span class="ni">plot_components</span><span class="nt">(self, picks, ch_type, res, vmin, vmax, cmap, sensors, colorbar, title, show, outlines, contours, image_interp, inst, plot_std, topomap_args, image_args, psd_args, reject, sphere, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">1926</span>                         <span class="n">image_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">psd_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1927</span>                         <span class="n">sphere</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1928</span>         <span class="k">return</span> <span class="n">plot_ica_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span> <span class="n">ch_type</span><span class="o">=</span><span class="n">ch_type</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1929</span>                                    <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1930</span>                                    <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">sensors</span><span class="o">=</span><span class="n">sensors</span><span class="p">,</span>

<span class="nn">&lt;decorator-gen-158&gt;</span> in <span class="ni">plot_ica_components</span><span class="nt">(ica, picks, ch_type, res, vmin, vmax, cmap, sensors, colorbar, title, show, outlines, contours, image_interp, inst, plot_std, topomap_args, image_args, psd_args, reject, sphere, verbose)</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/viz/topomap.py</span> in <span class="ni">plot_ica_components</span><span class="nt">(ica, picks, ch_type, res, vmin, vmax, cmap, sensors, colorbar, title, show, outlines, contours, image_interp, inst, plot_std, topomap_args, image_args, psd_args, reject, sphere, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">1181</span> 
<span class="g g-Whitespace">   </span><span class="mi">1182</span>     <span class="k">if</span> <span class="n">ica</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1183</span>         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The ICA</span><span class="se">\&#39;</span><span class="s1">s measurement info is missing. Please &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1184</span>                            <span class="s1">&#39;fit the ICA or add the corresponding info object.&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1185</span> 

<span class="ne">RuntimeError</span>: The ICA&#39;s measurement info is missing. Please fit the ICA or add the corresponding info object.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-ic-properties">
<h3>Plot IC properties<a class="headerlink" href="#plot-ic-properties" title="Permalink to this headline">¶</a></h3>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">.plot_properties()</span></code> method of the ICA class to view more details of each IC. Moving clockwise from top left, the four subplots for each IC are:</p>
<ul class="simple">
<li><p>topo map</p></li>
<li><p>raster plot of how the IC weights on each trial. Artifacts like blinks should appear as “streaks” lasting about 200-300 ms, on relatively few trials. Components reflecting brain activity are typically present across many epochs (although remember that these data are segmented into 1 s epochs across the entire raw data set, so we would not expect to see time-locked activity here)</p></li>
<li><p>Variance of the component, across channels and time. The <em>x</em> axis is epochs (effectively, time across the experiment), and the <em>y</em> axis is the variance of the IC across channels. Noise typically manifests as high variance on a low number of trials, and low variance on most trials, or lots of variability in the values on the <em>y</em> axis over epochs. True brain activity usually appears as consistently similar — and low — variance across epochs.</p></li>
<li><p>The PSD (phase spectral density) of the IC. EOG (eye) artifacts will typically have a peak at the low frequency end of the spectrum (the left side of the <em>x</em> axis), and muscle artifact will tend to show increasing power at the high end of the frequency spectrum (the right side of the <em>x</em> axis).</p></li>
</ul>
<p>With this in mind, <code class="docutils literal notranslate"><span class="pre">ICA000</span></code> is very characteristic of a blink artifact. The scalp topography is weighted most heavily at the electrodes right above the eyes (where blinks are most strongly detected) and the raster plot shows horizontal “streaks” on relatively few trials. The third plot shows high variance on a few trials, and the PSD is largest at the low end of the spectrum.</p>
<p><code class="docutils literal notranslate"><span class="pre">ICA001</span></code> shows similar properties, except that its scalp topography is maximal over the left and right anterior scalp locations, with opposite polarities (showing as blue vs. red). This is characteristic of horizontal eye movements.</p>
<p>Some of the other ICs may also be attributable to noise rather than EEG activity — for example ICs 4, 6, and 7. However, since these are not clearly well-defined ocular artifacts, we will not remove them. It is better to be conservative in terms of not removing too many ICs, than risking removing true brain activity.</p>
<p>Fortunately, as we’ll see below, we don’t necessarily need to make subjective judgment calls about which ICA components to reject (although some researchers do use visual inspection, based on extensive training and experience). There are automated algorithms that attempt to do this objectively. However, it’s worth knowing what artifacts look like, so that you can check the results of any automated approach to ICA component selection/rejection against your understanding of how they should work. Indeed, as we will see below, these automated algorithms are not always perfect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ica</span><span class="o">.</span><span class="n">plot_properties</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ica</span><span class="o">.</span><span class="n">n_components_</span><span class="p">),</span> <span class="n">psd_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fmax&#39;</span><span class="p">:</span> <span class="n">hi_cut</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3725562469.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ica</span><span class="o">.</span><span class="n">plot_properties</span><span class="p">(</span><span class="n">epochs_ica</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ica</span><span class="o">.</span><span class="n">n_components_</span><span class="p">),</span> <span class="n">psd_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fmax&#39;</span><span class="p">:</span> <span class="n">hi_cut</span><span class="p">});</span>

<span class="ne">NameError</span>: name &#39;epochs_ica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="identify-eog-artifacts-from-ica-components">
<h3>Identify EOG artifacts from ICA components<a class="headerlink" href="#identify-eog-artifacts-from-ica-components" title="Permalink to this headline">¶</a></h3>
<p>MNE has an algorithm that attempts to automatically identify ICA components. The <code class="docutils literal notranslate"><span class="pre">find_bads_eog()</span></code> function computes correlations between each IC and channels that the researcher has designated as <strong>EOG</strong> (electro-oculogram) channels. These are electrodes, the same as EEG electrodes, but intentionally placed close to the eyes specifically to monitor for blinks and eye movements. These are typically placed above and below one eye (to monitor blinks and vertical eye movements, as well as on the temples of the head laterally to the eyes (to monitor horizontal eye movements).</p>
<p>In the present data set, unfortunately EOG was not recorded. However, the Fp1 and Fp2 electrodes are above the eyes, and F7 and F8 are close enough to the sides of the eyes to detect horizontal movements. <code class="docutils literal notranslate"><span class="pre">find_bads_eog()</span></code> takes a <code class="docutils literal notranslate"><span class="pre">ch_name</span></code> kwarg to allow us to specify EEG channels that we want to use in place of EOG channels; below we use Fp1 and F8 (we only need one channel each for blinks and horizontal movements). We add another kward to override the default correlation threshold of <code class="docutils literal notranslate"><span class="pre">find_bads_eog()</span></code> which, in my experience, does not work well for EEG data (although it does for MEG data) and use instead <em>z</em> &gt; 1.96, which corresponds to a 5% chance of a correlation that large occurring due to chance.</p>
<p>MNE also provides a <code class="docutils literal notranslate"><span class="pre">.plot_scores()</span></code> method that will plot the correlation values for each IC, and mark any that were rejected in red.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ica_z_thresh</span> <span class="o">=</span> <span class="mf">1.96</span> 
<span class="n">eog_indices</span><span class="p">,</span> <span class="n">eog_scores</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">find_bads_eog</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> 
                                            <span class="n">ch_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Fp1&#39;</span><span class="p">,</span> <span class="s1">&#39;F8&#39;</span><span class="p">],</span> 
                                            <span class="n">threshold</span><span class="o">=</span><span class="n">ica_z_thresh</span><span class="p">)</span>
<span class="n">ica</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">eog_indices</span>

<span class="n">ica</span><span class="o">.</span><span class="n">plot_scores</span><span class="p">(</span><span class="n">eog_scores</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2203916850.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">ica_z_thresh</span> <span class="o">=</span> <span class="mf">1.96</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">eog_indices</span><span class="p">,</span> <span class="n">eog_scores</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">find_bads_eog</span><span class="p">(</span><span class="n">raw_ica</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span>                                             <span class="n">ch_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Fp1&#39;</span><span class="p">,</span> <span class="s1">&#39;F8&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                                             <span class="n">threshold</span><span class="o">=</span><span class="n">ica_z_thresh</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">ica</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">eog_indices</span>

<span class="ne">NameError</span>: name &#39;raw_ica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="segmentation-into-erp-epochs">
<h2>Segmentation into ERP epochs<a class="headerlink" href="#segmentation-into-erp-epochs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mne-s-events-structure">
<h3>MNE’s events structure<a class="headerlink" href="#mne-s-events-structure" title="Permalink to this headline">¶</a></h3>
<p><strong>Event codes</strong> indicate when events of experimental interest occurred during the EEG recording. They are typically generated by the stimulus computer, and sent to the EEG recording computer at the same time that the stimuli are presented to the participant. Event codes may also mark when a participant made a response (such as a button press, or the onset of a vocal response), or other information such as the start of a new bock of trials or condition, rather than a specific stimulus.</p>
<div class="alert alert-block alert-info">
<p>Event codes can also be generated by devices that detect when a stimulus occurs. For example, a light-sensitive <em>photodiode</em> can be used to detect when the brightness of a location on a computer screen changes. This setup can be useful in some situations, because sometimes there is an unpredictable delay between the time that the computer software initiates presentation of a stimulus, and when the hardware actually presents the stimulus. These delays are typically only on the order of a few, or possibly tens, of milliseconds, but that is enough to cause problems when averaging ERPs from multiple trials together — especially if the delay is inconsistent across trials. The result will be that the peaks and troughs of the waveforms do not align perfectly across trials, and the resulting averaged ERP will look more smoothed and less “peaky”. Event codes can also be generated by devices that detect when a stimulus occurs. For example, a light-sensitive <em>photodiode</em> can be used to detect when the brightness of a location on a computer screen changes. This setup can be useful in some situations, because sometimes there is an unpredictable delay between the time that the computer software initiates presentation of a stimulus, and when the hardware actually presents the stimulus. These delays are typically only on the order of a few, or possibly tens, of milliseconds, but that is enough to cause problems when averaging ERPs from multiple trials together — especially if the delay is inconsistent across trials. The result will be that the peaks and troughs of the waveforms do not align perfectly across trials, and the resulting averaged ERP will look more smoothed and less “peaky”.</p>
</div>
<p>Segmenting the data into ERPs depends on these event codes, since they are what we time-lock to. To use them for ERP segmentation, we need to first extract the timing and identity of each code from the raw data, and store it in a NumPy array. Because event codes are numeric (for reasons explained below), we also need to define a mapping between these numbers and meaningful labels (such as what type of stimulus or experimental condition the code denotes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span><span class="p">,</span> <span class="n">event_dict</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3250052289.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_dict</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can view the first 10 rows of the events array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">1656014619.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">events</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;events&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">events</span></code> is a NumPy array with 3 columns, and one row for each event code in the data.</p>
<p>The <strong>first column</strong> contains the index of the event code in terms of the data array. Recall that the data were sampled at a rate of 500 Hz, meaning we have one sample (i.e., measurement) every 2 ms. So the values in the first column of <code class="docutils literal notranslate"><span class="pre">events</span></code> are not time measured in milliseconds, but “time” in terms of samples or data points. This is important to remember later, although MNE generally makes it easy to go between samples and more intuitive measures of time like milliseconds or seconds.</p>
<p>The <strong>second column</strong> is usually zero, but is intended to mark the end time off an event, if the event code was send to the EEG system for a period of time. In practice it is rarely used.</p>
<p>The <strong>third column</strong> is the event code itself, as an integer. We’ll elaborate later on what each code means.</p>
<div class="alert alert-block alert-info">
<p>Most EEG systems receive event codes from the stimulus computer using an electronic communications protocol called <strong>TTL</strong>, or transistor-to-transistor logic. It’s very simple and low-level, and is done via the parallel port of a computer (which is so low-level, computers almost never have these build in anymore). The reason this arcane system is still routinely used in EEG is that its timing is very precise, which means it is the best option to get millisecond-level synchronization between when the stimulus computer presents a stimulus, and when the event code is received by the EEG system. This level of precision is vital in EEG research because the effects of interest occur on a millisecond time scale. The impact of this system for us is that the event codes stored in an EEG data file are usually restricted to integers in the range of 1–255, because that is the (8 bit) resolution of the TTL protocol (i.e., this kind of connection can inherently only send this range of values). Some EEG recording software allows the experimenter to specify text labels for each numerical event code, based on what the numbers mean in that particular experiment. However, in most cases mapping between the numerical event codes and meaningful labels is something we do in preprocessing, as shown below.</p>
</div><p>The second output, <code class="docutils literal notranslate"><span class="pre">event_dict</span></code>, is a dictionary mapping labels to the integer codes in the <code class="docutils literal notranslate"><span class="pre">events</span></code> array. The labels were created by the EEG recording software and stored in the raw file, but as you can see below they are mostly not very informative. We can see, however, that the first two codes in the <code class="docutils literal notranslate"><span class="pre">events</span></code> array above simply mark the start of the recording (<em>actiCAP</em> is the name of this EEG manufacturer’s electrode system).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3765325591.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">event_dict</span>

<span class="ne">NameError</span>: name &#39;event_dict&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We will need to create our own dictionary of mappings between the integer event codes and meaningful names based on the design of our experiment.</p>
</div>
<div class="section" id="experimental-design">
<h3>Experimental design<a class="headerlink" href="#experimental-design" title="Permalink to this headline">¶</a></h3>
<p>This data set was collected while the participant viewed a series of pictures of objects on a computer screen. One second after each picture was presented, a spoken word was played over a speaker. The word was either the name of the pictured object, or some other word. Based on prior research, we predicted an <strong>N400</strong> ERP component for the mismatch trials relative to those on which the picture and word matched.</p>
<p>The N400 is a component first discovered by <a class="reference external" href="https://dx.doi.org/10.1126/science.7350657">Kutas &amp; Hillyard (1980)</a>, in response to sentences that ended in a word whose meaning was not predicted given teh preceding words in the sentence. For example, the sentence <em>I take my coffee with milk and dog.</em> would elicit an N400 at the word <em>dog</em>. More than 40 years of subsequent research has shown that the N400 is a marker of brain processes involved in integrating new information into an ongoing context that people maintain of words and concepts — or in technical terms, <em>semantic integration</em>. Violations of expectations related to the meaning of stimuli evoke an N400 response. In the present experiment, we did not use sentences, however each picture created a context and the subsequent word either fit (matched) or did not fit (mismatched) that context.</p>
<p>Although there were really only two experimental conditions in this experiment (match and mismatch), as you  there are a lot more than two event codes in the <code class="docutils literal notranslate"><span class="pre">events</span></code> array and <code class="docutils literal notranslate"><span class="pre">events_dict</span></code> dictionary above! This is because in this study, the experimenters coded details of the stimuli in great detail. This is common in research, where we have one central research question, but perhaps other questions relating to more fine-grained details of the stimuli. As well, the stimuli may vary in ways that are not of experimental interest, but are properties that we would like to control for. For now we will label each event code</p>
</div>
<div class="section" id="label-event-codes">
<h3>Label Event Codes<a class="headerlink" href="#label-event-codes" title="Permalink to this headline">¶</a></h3>
<p>We can define a dictionary that maps labels onto each event code of interest. As you can see below, there are 4 event codes associated with Match trials, and 4 associated with Mismatch trials. Later we will merge them before examining the ERPs, but for now we will label each one separately. This preserves the more detailed information, in case later we decide we want to break the data down in a more fine-grained fashion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PicOnset&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;RespPrompt&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;CorResp&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;IncorResp&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;RespFeedback&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>             
                 <span class="s1">&#39;Match/A&#39;</span><span class="p">:</span><span class="mi">111</span><span class="p">,</span> <span class="s1">&#39;Match/B&#39;</span><span class="p">:</span><span class="mi">211</span><span class="p">,</span> <span class="s1">&#39;Match/C&#39;</span><span class="p">:</span><span class="mi">112</span><span class="p">,</span> <span class="s1">&#39;Match/D&#39;</span><span class="p">:</span><span class="mi">212</span><span class="p">,</span>
                 <span class="s1">&#39;Mismatch/A&#39;</span><span class="p">:</span><span class="mi">101</span><span class="p">,</span> <span class="s1">&#39;Mismatch/B&#39;</span><span class="p">:</span><span class="mi">201</span><span class="p">,</span> <span class="s1">&#39;Mismatch/C&#39;</span><span class="p">:</span><span class="mi">102</span><span class="p">,</span> <span class="s1">&#39;Mismatch/D&#39;</span><span class="p">:</span><span class="mi">202</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>MNE’s <code class="docutils literal notranslate"><span class="pre">viz.plot_events()</span></code> function will read an events array and plot the timing of event codes over the time, with different rows and colours for each event type. We have to pass the sampling rate (<code class="docutils literal notranslate"><span class="pre">raw.info['sfreq']</span></code>) as the second argument so that MNE knows how to convert the samples in the <code class="docutils literal notranslate"><span class="pre">events</span></code> array to units of time. We also pass <code class="docutils literal notranslate"><span class="pre">event_mapping</span></code> so that the plot has a meaningful legend.</p>
<p>This plot can be very useful to understand the timeline of an experiment, and also to confirm that the types and timing of event codes Control what was expected based on the design of the experiment. In the present experiment, all three sentence types were randomly intermixed, so the plot below is consistent with this.</p>
<p>Note that it’s not necessary to use <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code> before running any MNE plot routine. However, in some cases, such as this one, MNE’s default plot size is not optimal for what is being plotted, so <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code> allows us to specify the figure size. Note that when we run the MNE plot command, we don’t apply a Matplotlib axis method, but instead pass the <code class="docutils literal notranslate"><span class="pre">ax</span></code> pointer to the subplot to MNE’s plot command using the <code class="docutils literal notranslate"><span class="pre">axes=</span></code> kwarg. Many of MNE’s plotting commands support this kwarg, but not all (since some MNE plots actually create figures with multiple subplots).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">],</span>  
                    <span class="n">event_id</span><span class="o">=</span><span class="n">event_mapping</span><span class="p">,</span>                    
                    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">416257500.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">],</span>  
<span class="g g-Whitespace">      </span><span class="mi">4</span>                     <span class="n">event_id</span><span class="o">=</span><span class="n">event_mapping</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                     <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;events&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/erp_preprocessing_all_56_1.png" src="../../_images/erp_preprocessing_all_56_1.png" />
</div>
</div>
</div>
<div class="section" id="segment-the-data-into-epochs">
<h3>Segment the data into epochs<a class="headerlink" href="#segment-the-data-into-epochs" title="Permalink to this headline">¶</a></h3>
<p>Finally, we split the continuous, filtered raw EEG data into epochs time-locked to the event codes of interest, as defined in <code class="docutils literal notranslate"><span class="pre">event_mapping</span></code>. To do this we use <code class="docutils literal notranslate"><span class="pre">mne.Epochs()</span></code>, which creates an object of the class <code class="docutils literal notranslate"><span class="pre">Epochs</span></code>. A number of arguments are necessary; the first 5 of these are <em>positional</em> arguments, meaning that the first 5 argument positions must have specific contents:</p>
<ul class="simple">
<li><p>the first is the raw data. We pass the filtered data.</p></li>
<li><p>the next two arguments are the events array, and the mapping of events to labels</p></li>
<li><p>the fourth and fifth arguments are the start and end times of each epoch (<code class="docutils literal notranslate"><span class="pre">timn</span></code> and <code class="docutils literal notranslate"><span class="pre">tmax</span></code>), relative to the event code. Typically the minimum (start) tie is a negative number, because for reasons explained below we want a <em>baseline</em> period to compare to the activity after the event code (typically 50-200 ms, but sometimes longer). The stop time depends on the timing of the ERP components you expect to occur. Some types of stimuli and experiments (such as studies of attention, or face processing) may only be interested in ERPs that occur within the first 500 ms after stimulus presentation. In language studies, interesting effects often occur up to 1 s or even longer after a word is presented. An important thing to note is that these times need to be specified in <em>seconds</em> (which is a bit counter-intuitive because we commonly talk about the timing of ERPs in milliseconds).</p></li>
</ul>
<p>After these 5 required positional arguments, there are many kwargs we can specify. For our purposes, the defaults for most of these are fine. The one we will specify is <code class="docutils literal notranslate"><span class="pre">reject=</span></code>, which applies a threshold, in microVolts, for marking a trial as an artifact. This threshold was determined by the <code class="docutils literal notranslate"><span class="pre">get_rejection_threshold()</span></code> function earlier, and saved in the variable <code class="docutils literal notranslate"><span class="pre">reject</span></code>. This is used to remove excessive noise from the data set that can’t be corrected with ICA.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">baseline</span></code> kwarg specifies what time period to use as the baseline for each epoch. The baseline is the period before the stimulus onset, and it is used to define “zero” voltage for each trial. This is necessary because  the measured electrical potentials can drift quite a lot over the course of the experiment (even after we filter out the lowest-frequency drift). So the absolute microVolt values for any given epoch might be rather different from other ones, due to drift. By subtracting the mean amplitude over the baseline period from each trial (and for each channel), we “centre” the measurements for that trial such that the potentials after the onset of each event code reflect the deviations of our measurements from the baseline period. Put another way, the measurements of each epoch reflect any changes in electrical potential that occur after teh event code, relative to the baseline period before it. We use <code class="docutils literal notranslate"><span class="pre">(None,</span> <span class="pre">0)</span></code> for the baseline to specify the time period from the start of the epoch to the time of the event code.</p>
<p>We also include the <code class="docutils literal notranslate"><span class="pre">preload=True</span></code> kwarg. As with <code class="docutils literal notranslate"><span class="pre">raw</span></code> data, MNE tries to save memory by not keeping the epoched data in memory unless it is needed. However, below we will need it and so we force MNE to store this in the data here.</p>
<p>The <a class="reference external" href="https://mne.tools/stable/generated/mne.Epochs.html"><code class="docutils literal notranslate"><span class="pre">mne.Epochs</span></code> API</a> provides details on all the available kwargs (as well as all the methods that are defined for Epochs).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Epoching settings</span>
<span class="n">tmin</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">.200</span>  <span class="c1"># start of each epoch (in sec)</span>
<span class="n">tmax</span> <span class="o">=</span>  <span class="mf">1.000</span>  <span class="c1"># end of each epoch (in sec)</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create epochs</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw_filt</span><span class="p">,</span>
                    <span class="n">events</span><span class="p">,</span> <span class="n">event_mapping</span><span class="p">,</span>
                    <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span>
                    <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> 
                    <span class="n">preload</span><span class="o">=</span><span class="kc">True</span>
                   <span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">984825513.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> 
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># Create epochs</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw_filt</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>                     <span class="n">events</span><span class="p">,</span> <span class="n">event_mapping</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>                     <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span>

<span class="ne">NameError</span>: name &#39;raw_filt&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>If we ask for the value of <code class="docutils literal notranslate"><span class="pre">epochs</span></code> we get nice, tidy output with a summary of the contents of the data structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3164673439.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Epochs can be accessed in a variety of ways, all using square brackets.</p>
<p>If we use an integer, we get the epoch at that index position (epochs are numbered from zero to the total number of epochs, in the order the event codes occurred in the raw data):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">676643686.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3693726232.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>We can alternatively access all of the epochs associated with a particular event code, using the label we assigned to the code using <code class="docutils literal notranslate"><span class="pre">event_mapping</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4195956028.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>These two methods can be combined to select a specific event out of those in a condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2214191262.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>If we pass multiple condition labels, then we will get all epochs in each of the conditions specified:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">,</span> <span class="s1">&#39;Match/B&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2211021256.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match/A&#39;</span><span class="p">,</span> <span class="s1">&#39;Match/B&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Usefully, MNE also recognizes the <code class="docutils literal notranslate"><span class="pre">/</span></code> separator for condition labels: the string before the <code class="docutils literal notranslate"><span class="pre">/</span></code> is treated as a more general category, with the string after the <code class="docutils literal notranslate"><span class="pre">/</span></code> treated as subsets of that category. What this means is that we can use only the string before the <code class="docutils literal notranslate"><span class="pre">/</span></code> to get all epochs from that category (all that have that string before the <code class="docutils literal notranslate"><span class="pre">/</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3147277862.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-average-erp-across-all-conditions-before-artifact-correction">
<h3>Visualize average ERP across all conditions before artifact correction<a class="headerlink" href="#visualize-average-erp-across-all-conditions-before-artifact-correction" title="Permalink to this headline">¶</a></h3>
<p>We do this before removing ICs, so that we can compare with post-ICA below to see the effect of artifact removal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spatial_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3749686906.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spatial_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The above plot shows strong evidence of ocular artifacts in the data: the amplitude scale is on the order of 100 µV, whereas real EEG is rarely more than 10–20 µV, and the largest amplitude values are in channels around the eyes (you can tell this by matching the colours of the lines in the plot with those of the channel locations on the inset showing the electrode layout).</p>
</div>
<div class="section" id="scalp-topography-maps">
<h3>Scalp topography maps<a class="headerlink" href="#scalp-topography-maps" title="Permalink to this headline">¶</a></h3>
<p>As we did with ICA components, we can plot the EEG potentials over the scalp using the <code class="docutils literal notranslate"><span class="pre">.plot_topomap()</span></code> method. This will confirm that the artifacts are focused over the electrodes close to the eyes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify times to plot at, as [min],[max],[stepsize]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">3117893919.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="apply-ica-correction-to-epochs">
<h3>Apply ICA correction to epochs<a class="headerlink" href="#apply-ica-correction-to-epochs" title="Permalink to this headline">¶</a></h3>
<p>To recap, we have created two different <code class="docutils literal notranslate"><span class="pre">Epochs</span></code> objects:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epochs_ica</span></code>, with 1 s segments of the entire raw file, which we fit ICA on to identify artifacts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epochs</span></code>, with segments time-locked to each event code of experimental interest</p></li>
</ul>
<p>Although we fit ICA to the <code class="docutils literal notranslate"><span class="pre">epochs_ica</span></code> data, we can actually <em>apply</em> this set of independent components to the <code class="docutils literal notranslate"><span class="pre">epochs</span></code> data. This is because ICA was fitted to the entire raw data set, and <code class="docutils literal notranslate"><span class="pre">epochs</span></code> is just a subset of that original raw data — so the effects of any ICs we marked for exclusion above will be removed from <code class="docutils literal notranslate"><span class="pre">epochs</span></code> with the <code class="docutils literal notranslate"><span class="pre">ica.apply</span></code> method.</p>
<p>As with many MNE methods (such as filtering, as we saw earlier), the <code class="docutils literal notranslate"><span class="pre">ICA</span></code> <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> method operates on data in-place, meaning it alters the data that is passed to it. In general, my preference is to make copies of data when applying transofrmations to the data, so here we chain the <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_postica</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">epochs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">610069079.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs_postica</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">epochs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

<span class="ne">NameError</span>: name &#39;epochs&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-average-erp-across-all-conditions-after-artifact-correction">
<h3>Visualize average ERP across all conditions after artifact correction<a class="headerlink" href="#visualize-average-erp-across-all-conditions-after-artifact-correction" title="Permalink to this headline">¶</a></h3>
<p>Compared to the previous plot, we can see that artifacts have been successfully removed adn the data look more like typical ERP data:</p>
<ul class="simple">
<li><p>the large-amplitude deflections, largest at frontal channels, are no longer present</p></li>
<li><p>the amplitude scale (<em>y</em> axis) is in the range typical of ERPs</p></li>
<li><p>a series of early peaks typical of responses to visual stimuli are present (a first, small, peak around 75 ms, followed by a larger positive peak around 150 ms and a negative peak around 225 ms)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spatial_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">52066902.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spatial_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Scalp topography maps<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>We saw this plot above, but now the scalp distribution of the electrical potentials shouldn’t be concentrated over the eyes.</p>
<p>We can also provide a bit more information about how these plots are drawn. We plot topo maps at 100 ms steps from the onset of the code up to the end of the epoch. The <code class="docutils literal notranslate"><span class="pre">average</span></code> kwarg specifies that each plot will reflect the average over a 50 ms time window, centered on each time point for which a plot is drawn. In other words, the plot labeled <code class="docutils literal notranslate"><span class="pre">0.100</span> <span class="pre">s</span></code> reflects the average between 50–150 ms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify times to plot at, as [min],[max],[stepsize]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4186831804.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="re-referencing">
<h2>Re-referencing<a class="headerlink" href="#re-referencing" title="Permalink to this headline">¶</a></h2>
<p>One thing that can be hard to get your head around at first, when working with EEG data, is that the electrical potential values at each electrode are actually <em>relative</em> measurements. Specifically, The microVolt measurement at each electrode is the <em>difference</em> in electrical potential at that electrode, relative to a <strong>reference electrode</strong>. This is actually a fundamental property of electrical potential measurements — they are always a relative measure. To understand why, we need to understand electricity a bit more.</p>
<p>Typically, when people think about electricity they think about the <em>flow</em> of electrical current through a conductor or device. For example, when you turn on a light switch, electrical current flows through the circuit (from a source, through wiring, to the light bulb, and then back into the building’ wiring), creating illumination. However, when the light switch is off, the electrical circuit still has the <em>potential</em> for current to flow. A good analogy for this is to think about water, rather than electricity, because water is tangible and visible. If we place a bucket containing 10 L of water on a table, we have a <em>potential</em> for 10 L of water to move to some other location, such as the floor. If we connect a hose to an opening in the bucket, and run the hose down to the floor, we create a path through which the water can flow. Allowing the water to flow through the hose is equivalent to turning on the light switch in our earlier example — the flow of water is comparable to the electrical current flow. Note, however, that this example would not make sense if we held the bucket underwater in the ocean. If we did that, there would be no potential for water to flow out of the bucket, because it would be surrounded by water. In other words, when we say that a bucket on a table has potential for water to flow onto the floor, that’s only because, in relative terms, there is 10 L more water in the bucket than on the floor.</p>
<p>Coming back to electricity, a closer example is the case of a battery, such as a standard AA battery. This has an electrical potential of 1.5 V. If it is placed in, say, a flashlight, and the flashlight is turned on, then current flows through the bulb and creates light. However, even with the flashlight turned off, the battery has 1.5 V of electrical potential. The way we would measure this potential is by connecting a device called a Voltmeter to either end of the battery (the <em>terminals</em>, marked <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code>) — this would measure the difference in electrical potential between the two parts of the battery that would connect to an electrical circuit.</p>
<p>In all of these examples, we are measuring <em>potential</em> relative to some location/source that we treat as our reference. In the water example, there is 10 L more water on the table than on the floor. In the battery example, there is 1.5 V more electrical potential in the battery than in the device it’s in, or the Voltmeter.</p>
<p>Coming back to EEG, when we measure electrical activity from the scalp, we are measuring the electrical potential at the location of the electrode, but it is necessarily relative to some other reference point. Ideally, we would have a reference point that is electrically neutral — that is, it has no electrical potential itself. However, this is technically challenging. For one thing, we want our reference point to be on the body of the person we are recording from, because otherwise we would be recording the difference in electrical potential between some external location and the <em>entire</em> body of the person (since bodies are ~80% water, with high electrolyte content, and are thus great conductors of electricity) which would include a lot of noise. In order to record only electrical activity in the brain, we need a reference point that is ideally on the head.</p>
<p>It turns out that this reference location doesn’t actually need to be “neutral” in the sense of not detecting any neural activity. Since electrical potential is a relative measurement, any pair of reference and measurement electrodes on the head will generate a measurement of the electrical potential difference between those locations. So as long as the reference electrode is not too close to the recording electrode, then we will get an electrical potential value. This is <em>not</em> to say that our choice of reference location doesn’t matter, however. Indeed, the choice of reference location will determine the size and polarity (positive/negative) of the voltage measured at each recording electrode. We will demonstrate this below.</p>
<p>The reason that this information is relevant to our preprocessing of the data, is that it is possible to <strong>re-reference</strong> the data after recording, to any other location where we had a a recording electrode. This is done simply be subtracting the electrical potential from the “new” reference electrode from the values at every other electrode, at each time point. This is useful because it means that we don’t need to be too concerned about our choice of reference electrode location during recording.</p>
<div class="section" id="what-reference-to-select-in-preprocessing">
<h3>What reference to select in preprocessing?<a class="headerlink" href="#what-reference-to-select-in-preprocessing" title="Permalink to this headline">¶</a></h3>
<p>While the choice of reference during recording is somewhat arbitrary, the choice of what to use as a reference in preprocessing is, however, an important one. Since this choice will influence the amplitude values at each electrode, it will influence where ERP effects are identified, their polarity, and possibly how large they are.</p>
<p>A starting point for deciding on the re-referencing location is prior literature. In most areas of EEG/ERP research, there is an existing literature on the process and/or components of interest, and in many cases different research groups working on a topic will have converged on a common choice for reference location. Often this is a location that is relatively distant from the scalp location where the component(s) of interest are largest. For example, in face studies the nose, or bridge of the nose, are often used because this is far from the area behind the ears where the N170 ERP component elicited by faces is largest. In contrast, in studies of language, the mastoid processes (the bony area right behind the ears) is used as the reference because this location is far from the top of the head, where the N400 and other components associated with language procesing are largest. In this case, the potentials are averaged from the left and right mastoid locations, and then subtracted from every other electrode. This highlights another important consideration: since the brain is organized into two hemispheres, and many functions (such as language) tend to be lateralized to one hemisphere, it is good practice to choose a reference location that is either along the midline of the scalp (like the nose), or to average electrodes located over the left and right sides of the head.</p>
</div>
<div class="section" id="average-reference">
<h3>Average reference<a class="headerlink" href="#average-reference" title="Permalink to this headline">¶</a></h3>
<p>An alternative to selecting a specific electrode(s) to re-reference to, is to use the average reference. In this case, the average potential across <em>all</em> electrodes is subtracted from each individual electrode. In principle, this is an ideal choice of reference because if all of the electrical activity recorded is from the brain, then the average electrical potential around the entire head should be zero. This is true because each source of electrical activity in the brain is an electrical <em>dipole</em>, with positive and negative values radiating out from the source in opposite directions. So, if we placed electrodes around the entire head with equal spacing between them, we would record the positive and negative potentials from each dipole source in the brain, and these would cancel out. However, in practice the situation is less ideal. Because of the fact that the head is attached to the neck (which we normally view as a Good Thing), we cannot place electrodes evenly around the entire head. Indeed, in practice EEG caps cover only the top half of the head, and typically a bit less than that.</p>
<p>However, even in such less-than-ideal situations the average reference can be a good choice, because then the electrical potential at each scalp location reflects what is unique to that position on the head relative to all other positions (from which we have recordings). There are a few limitations of average reference to keep in mind though.</p>
<p>For one, if the experiment is designed to elicit an ERP component that is known to be quite large and extensive over the head, the average reference may not be a good choice. For instance, some components such as the P3 and N400 tend to be largest over the top of the head, but extend outward across many more electrodes. So if the same component is present at all or most of the electrodes used, then an average reference will effectively subtract that component from the data.</p>
<p>A related consideration is the number of electrodes used during recording, and their locations. Average reference will work best when more electrodes used, and when more of the surface area of the head is covered by these electrodes. More extensive coverage will mean that there is less likelihood that a widely-distributed component is subtracted in the average (because there will be more electrodes that aren’t located over scalp regions where the component is present). More electrodes both allow for more extensive scalp coverage, and ensure that the average is not biased by a few electrodes that have large potentials — including electrodes that may contain noise. Noisy electrodes are an issue for average reference because the noise in one electrode will effectively be introduced into every other electrode, when it is used as a reference.</p>
</div>
<div class="section" id="what-reference-was-used-in-our-data-set">
<h3>What reference was used in our data set?<a class="headerlink" href="#what-reference-was-used-in-our-data-set" title="Permalink to this headline">¶</a></h3>
<p>Unfortunately, by default the reference location is not recorded in the raw data file, and so it is not something we can find in one of the attributes of the <code class="docutils literal notranslate"><span class="pre">Raw</span></code> data set. However, we know (since this data was collected in my lab, and we are always careful to document our procedures) that the reference electrode was located at the International 10-20 System position FCz, which is located along the midline of the scalp, halfway between electrodes Fz and Cz. The recording montage is shown below to allow you to visualize where this would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_postica</span><span class="o">.</span><span class="n">plot_sensors</span><span class="p">(</span><span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4231410711.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">plot_sensors</span><span class="p">(</span><span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The fact that the reference electrode was positioned between Fz and Cz explains why, in the raw data (re-plotted below), the traces for these electrodes are so much flatter than all the other electrodes - the difference in measured electrical activity between these recording electrodes and the reference are very small, because they are measuring almost the same brain activity:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4110433168.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">raw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;raw&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The FCz reference location also explains why, in the scalp topography maps (re-plotted below), the area between electrodes Fz and Cz is white, or very close to it, at most time points. As communicated by the colour bar below, white represents a value of zero. The values aren’t exactly zero/white in the plots below, because in generating these plots, MNE interpolates values in between the electrodes. In other words, we only have voltage measurements at each electrode (the dots in the plots), and the colours at every other location are determined by mathematical estimates of what the voltage values likely would have been, based on the values at the electrodes we do have. Since both Fz and Cz measure slightly different locations than the reference, they are not zero, and the estimated values between them may also not be zero due to noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify times to plot at, as [min],[max],[stepsize]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4186831804.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Average reference<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>As noted above, the average mastoids are a common choice for N400 studies and we will use these below. But first we will demonstrate how to re-reference, and what the average reference looks like for this data set, as a way of understanding the effects of different reference location choices. Scalp topography maps are the best way to visualize the effects of re-referencing, since this procedure primarily affects the distribution of electrical potentials over the scalp.</p>
<p>MNE provides a <code class="docutils literal notranslate"><span class="pre">.set_eeg_reference()</span></code> method for this purpose. Here we chain this with a few other methods:</p>
<ul class="simple">
<li><p>first we average all the epochs together</p></li>
<li><p>then we re-reference to the average of all electrodes</p></li>
<li><p>then we plot the results as topomaps</p></li>
</ul>
<p>Since we won’t be using this data later, we don’t assign the re-referenced data to a variable name, we just compute the average reference and plot it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">ref_channels</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">.050</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2573406818.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">ref_channels</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">.050</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Compared to the previous set of topomaps above, we can see that the average reference shows a large negative potential over the top of the head, especially around electrodes Fz and Cz. Notably, however, the overall distribution of electrical activity is similar between the original and average-referenced data. For example, the voltage at the back of the head is still positive relative to the top/centre of the scalp.</p>
</div>
</div>
<div class="section" id="re-reference-the-data-to-mastoids">
<h2>Re-Reference the data to mastoids<a class="headerlink" href="#re-reference-the-data-to-mastoids" title="Permalink to this headline">¶</a></h2>
<p>Now we will re-reference to the average of the mastoid electrodes (whose labels are Tp9 and TP10 in the 10-20 system). Since this is the reference that we will want to work with, we assign the result to a new <code class="docutils literal notranslate"><span class="pre">Epochs</span></code> object, called <code class="docutils literal notranslate"><span class="pre">epochs_mastoidref</span></code>, and then plot it in a separate step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_mastoidref</span> <span class="o">=</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">ref_channels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TP9&#39;</span><span class="p">,</span> <span class="s1">&#39;TP10&#39;</span><span class="p">]);</span>

<span class="n">epochs_mastoidref</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">.050</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">4125285115.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">epochs_mastoidref</span> <span class="o">=</span> <span class="n">epochs_postica</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">ref_channels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TP9&#39;</span><span class="p">,</span> <span class="s1">&#39;TP10&#39;</span><span class="p">]);</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">epochs_mastoidref</span><span class="o">.</span><span class="n">average</span><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">.050</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;epochs_postica&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Again, the relative distribution of electrical potentials across the scalp is similar to the original and average-referenced data. However, now the white, “zero voltage” area overlaps the locations behind the ears, and the top/centre electrodes (extending to more frontal electrodes) are more negative than when other references were used.</p>
</div>
<div class="section" id="create-erps-for-each-condition">
<h2>Create ERPs for each condition<a class="headerlink" href="#create-erps-for-each-condition" title="Permalink to this headline">¶</a></h2>
<p>Since averaging across trials is typically the end goal of an ERP experiment, MNE has a distinct class, <code class="docutils literal notranslate"><span class="pre">Evoked</span></code>, for ERP data where multiple trials have been averaged for each experimental condition or trial type. Unlike <code class="docutils literal notranslate"><span class="pre">Epochs</span></code>, which by definition contain multiple trials and in which each trial has an associated condition label (event code), <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> data sets are averages across trials for a <em>single</em> condition. Thus we have to create a separate <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> object for each condition in our experiment. For convenience, we can store these in a dictionary, where the keys are the condition labels and the values are <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">,</span> <span class="s1">&#39;Mismatch&#39;</span><span class="p">]</span>
<span class="c1"># Create empty dict to append to</span>
<span class="n">evokeds</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
    <span class="n">evokeds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">epochs_mastoidref</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
    
<span class="c1"># Print out contents of evokeds dict    </span>
<span class="n">evokeds</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">529893002.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">evokeds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">epochs_mastoidref</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="c1"># Print out contents of evokeds dict</span>

<span class="ne">NameError</span>: name &#39;epochs_mastoidref&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-average-erp-for-each-condition">
<h2>Plot average ERP for each condition<a class="headerlink" href="#plot-average-erp-for-each-condition" title="Permalink to this headline">¶</a></h2>
<p>We can use a method called <code class="docutils literal notranslate"><span class="pre">plot_joint()</span></code> to generate a combination of “butterfly” plots (waveforms of all electrode overlaid) and topographic maps at specific time points that we specify. This is a nice way of relating scalp topographies and waveforms. The time points specified for the topo plots were selected based on early peaks apparent in the waveforms above, and then on 200 ms intervals over the time period when teh N400 is expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.150</span><span class="p">,</span> <span class="mf">.250</span><span class="p">,</span> <span class="mf">.400</span><span class="p">,</span> <span class="mf">.600</span><span class="p">,</span> <span class="mf">.800</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">evokeds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">evokeds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examine-contrasts-between-conditions">
<h2>Examine contrasts between conditions<a class="headerlink" href="#examine-contrasts-between-conditions" title="Permalink to this headline">¶</a></h2>
<p>Viewing the ERPs for each experimental condition is a good first step, but ultimately any ERP experiment should be designed around <em>contrasts</em> between different conditions. In the present study, we are interested in the difference between match and mismatch items. We predicted an N400 component, which would be larger (more negative) for mismatch than match items. The N400 tends to be largest over the midline centre/posterior region of the scalp (when using averaged-mastoid reference). So here we will plot the data at electrode Cz, which typically shows the N400 effect. We use the function <code class="docutils literal notranslate"><span class="pre">mne.viz.plot_compare_evokeds()</span></code>, which plots waveforms for each of a list of evoked items that you pass to it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">(</span><span class="n">evokeds</span><span class="p">,</span> 
                             <span class="n">picks</span><span class="o">=</span><span class="s1">&#39;Cz&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">1993592356.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">(</span><span class="n">evokeds</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">2</span>                              <span class="n">picks</span><span class="o">=</span><span class="s1">&#39;Cz&#39;</span><span class="p">);</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/viz/evoked.py</span> in <span class="ni">plot_compare_evokeds</span><span class="nt">(evokeds, picks, colors, linestyles, styles, cmap, vlines, ci, truncate_yaxis, truncate_xaxis, ylim, invert_y, show_sensors, legend, split_legend, axes, title, show, combine, sphere)</span>
<span class="g g-Whitespace">   </span><span class="mi">2224</span>     <span class="c1"># ensure same channels and times across all evokeds</span>
<span class="g g-Whitespace">   </span><span class="mi">2225</span>     <span class="n">all_evoked</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">evokeds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
<span class="ne">-&gt; </span><span class="mi">2226</span>     <span class="n">_check_evokeds_ch_names_times</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2227</span>     <span class="k">del</span> <span class="n">all_evoked</span>
<span class="g g-Whitespace">   </span><span class="mi">2228</span> 

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/evoked.py</span> in <span class="ni">_check_evokeds_ch_names_times</span><span class="nt">(all_evoked)</span>
<span class="g g-Whitespace">    </span><span class="mi">979</span> 
<span class="g g-Whitespace">    </span><span class="mi">980</span> <span class="k">def</span> <span class="nf">_check_evokeds_ch_names_times</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">981</span>     <span class="n">evoked</span> <span class="o">=</span> <span class="n">all_evoked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">982</span>     <span class="n">ch_names</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">ch_names</span>
<span class="g g-Whitespace">    </span><span class="mi">983</span>     <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<p>We can make this plot a bit nicer by adding a few things to it:</p>
<ul class="simple">
<li><p>firstly we define a <em>region of interest</em> (ROI) that includes a set of electrodes where the N400 is expected, so that we can plot the ERP waveform averaged over these electrodes</p></li>
<li><p>we add the <code class="docutils literal notranslate"><span class="pre">combine</span></code> kwarg to tell MNE how to combine the data from these electrodes</p></li>
<li><p>we define dictionaries mapping condition names to colours and linestyles for out plot, to make the two conditions’ lines more distinctive</p></li>
<li><p>we tell MNE where to put the legend and plot of the sensor locations, to ensure these don’t overlap with the waveforms</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cz&#39;</span><span class="p">,</span> <span class="s1">&#39;C4&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;P3&#39;</span><span class="p">,</span> <span class="s1">&#39;Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;P4&#39;</span><span class="p">]</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Match&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;Mismatch&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}</span>
<span class="n">linestyle_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Match&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;Mismatch&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">}</span>

<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">(</span><span class="n">evokeds</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                             <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                             <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                             <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span>
                             <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyle_dict</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">1779779611.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">linestyle_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Match&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;Mismatch&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">}</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> 
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">(</span><span class="n">evokeds</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">8</span>                              <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>                              <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/viz/evoked.py</span> in <span class="ni">plot_compare_evokeds</span><span class="nt">(evokeds, picks, colors, linestyles, styles, cmap, vlines, ci, truncate_yaxis, truncate_xaxis, ylim, invert_y, show_sensors, legend, split_legend, axes, title, show, combine, sphere)</span>
<span class="g g-Whitespace">   </span><span class="mi">2224</span>     <span class="c1"># ensure same channels and times across all evokeds</span>
<span class="g g-Whitespace">   </span><span class="mi">2225</span>     <span class="n">all_evoked</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">evokeds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
<span class="ne">-&gt; </span><span class="mi">2226</span>     <span class="n">_check_evokeds_ch_names_times</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2227</span>     <span class="k">del</span> <span class="n">all_evoked</span>
<span class="g g-Whitespace">   </span><span class="mi">2228</span> 

<span class="nn">~/miniforge3/envs/eeg/lib/python3.9/site-packages/mne/evoked.py</span> in <span class="ni">_check_evokeds_ch_names_times</span><span class="nt">(all_evoked)</span>
<span class="g g-Whitespace">    </span><span class="mi">979</span> 
<span class="g g-Whitespace">    </span><span class="mi">980</span> <span class="k">def</span> <span class="nf">_check_evokeds_ch_names_times</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">981</span>     <span class="n">evoked</span> <span class="o">=</span> <span class="n">all_evoked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">982</span>     <span class="n">ch_names</span> <span class="o">=</span> <span class="n">evoked</span><span class="o">.</span><span class="n">ch_names</span>
<span class="g g-Whitespace">    </span><span class="mi">983</span>     <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_evoked</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<p>The N400 can be observed as the difference between the two conditions’ waveforms starting just after 400 ms, and continuing to the end of the epoch. As predicted, the Mismatch waveform is more negative than the Match waveform during this period.</p>
</div>
<div class="section" id="create-difference-waves">
<h2>Create difference waves<a class="headerlink" href="#create-difference-waves" title="Permalink to this headline">¶</a></h2>
<p>Finally, we can create <strong>difference waves</strong> by subtracting the waveforms of our two experimental conditions. Since the N400 manifests as a larger negativity for mismatch, it is conventional to compute this difference as Mismatch - Match (otherwise the difference between the two would appear as positive, rather than negative, voltage).</p>
<p>Computing difference waves allows us to view the experimental effect in a quite intuitive way: zero voltage means no difference between conditions, and and deviation from teh zero line in the waveform plot (or from white in the topopmaps) indicates an experimental effect.</p>
<p>MNE’s <code class="docutils literal notranslate"><span class="pre">combine_evoked()</span></code> function allows us to combine Evoked data sets in different ways. To compute a difference, we pass the weights of <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">-1]</span></code> to indicate we want to subtract the second Evoked data set listed (Match) from the first (Mismatch):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evokeds_diff</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">combine_evoked</span><span class="p">([</span><span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Mismatch&#39;</span><span class="p">],</span> <span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]],</span> 
                                             <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">evokeds_diff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">871837380.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">evokeds_diff</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">combine_evoked</span><span class="p">([</span><span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Mismatch&#39;</span><span class="p">],</span> <span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]],</span> 
<span class="g g-Whitespace">      </span><span class="mi">2</span>                                              <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">evokeds_diff</span>

<span class="ne">KeyError</span>: &#39;Mismatch&#39;
</pre></div>
</div>
</div>
</div>
<p>Having saved this as a new Evoked object, we can plot it as a waveform.</p>
<p>We do a few extra things to make the plot more readable:</p>
<ul class="simple">
<li><p>Whereas before we simply passed the Epochs or Evoked data to the <code class="docutils literal notranslate"><span class="pre">plot_compare_evokeds()</span></code> function, here we pass a dictionary, where the key is the label we want to appear in the legend and the value is the Evoked data</p></li>
<li><p>we add a <code class="docutils literal notranslate"><span class="pre">title</span></code> kwarg to give the plot an informative title</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">({</span><span class="s1">&#39;Mismatch-Match&#39;</span><span class="p">:</span><span class="n">evokeds_diff</span><span class="p">},</span> 
                             <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                             <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Difference Wave&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">132561754.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">({</span><span class="s1">&#39;Mismatch-Match&#39;</span><span class="p">:</span><span class="n">evokeds_diff</span><span class="p">},</span> 
<span class="g g-Whitespace">      </span><span class="mi">2</span>                              <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                              <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Difference Wave&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;evokeds_diff&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>One advantage of difference waves is that they make it very cclear when differences are occurring between conditions, and how large they are. When we compare waveforms for two conditions, the shape of the waveforms can sometimes make it hard to mentally compute the size of the difference - especially at time points when the waveforms’ amplitudes are changing. In a difference waveform plot, the zero line clearly indicates no difference between conditions, and so the magnitude of the difference — as well as its timing — is easy to see.</p>
<p>And we can plot the scalp distribution of the differences as well, which nicely shows the scalp distribution of the N400:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify times to plot at, as [min],[max],[stepsize]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">evokeds_diff</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mismatch-Match&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">9</span><span class="n">s</span><span class="o">/</span><span class="mi">6</span><span class="n">fvdmxlx00z9sz6ftkrnh8dw0000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_54950</span><span class="o">/</span><span class="mf">2001213385.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">evokeds_diff</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.050</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mismatch-Match&#39;</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;evokeds_diff&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Preprocessing EEG data and deriving ERPs is a multi-step process. It’s important to understand what each step does, why it’s applied, and how to choose the correct parameters.</p>
<p>There are a few additional steps that could be included in a preprocessing pipeline, that we have omitted here. For example, sometimes there there are <em>bad channels</em> — electrodes that had a poor connection throughout the recording, or were broken. There are ways to manually or automatically identify these and have them ignored throughout the preprocessing stream, and then <em>interpolate</em> data for these electrodes after artifact correction.</p>
<p>After each individual participant’s data has been preprocessed through a pipeline line this, the next step in analyzing an ERP experiment would be a group-level analysis. In a group-level analysis, the data from all participants would typically be averaged, and visualized using waveform plots and scalp topographic maps similar to the ones we’ve created here for one participant.</p>
<p>As well, statistics can be applied. While there are many ways to do this, one of the most common ways for ERP studies is to average the data at each channel over a time period appropriate for the component of interest. For example, in this study a mean amplitude could be computed over the 600–800 ms time window, and then a</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./eeg/_extra"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Aaron J Newman<br/>
        
            &copy; Copyright 2020-21. This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>