
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Group Analysis of ERP Data &#8212; Data Science for Psychology and Neuroscience — in Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="http://neuraldatascience.io/eeg/erp_group.html" />
    <link rel="shortcut icon" href="../_static/NESC3505_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction to MRI Data" href="../mri/introduction.html" />
    <link rel="prev" title="Averaging ERPs: Creating MNE Evoked objects" href="erp_averaging.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-171426664-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/NESC3505_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Psychology and Neuroscience — in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/why.html">
   Start with why
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_objectives.html">
   Learning Objectives for this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Pedagogy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teaching_approach.html">
   Teaching Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/online_learning.html">
   Hybrid Online Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/assessment_evaluation.html">
   Assessment and Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/constructivism.html">
   Constructivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/connectivism.html">
   Connectivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/authenticity.html">
   Authenticity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/21st_cen_skills.html">
   21st Century Skills
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Open Software, Science, &amp; Education
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open.html">
   Open Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/software.html">
   Free Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/free_licenses.html">
   Free and Open-Source Software Licenses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/peer_review.html">
   Peer Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/for_profit.html">
   For-Profit Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/impact_factors.html">
   Impact Factors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/novelty.html">
   Novelty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_publishing.html">
   Open Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/preregistration.html">
   Preregistration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_methods.html">
   Open Methods and Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer.html">
   Open Educational Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer_this_course.html">
   OERs in the Context of this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/licenses.html">
   Licenses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  How to Rock This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_approach.html">
   Learning Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/mindset.html">
   Mindset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/errors_debugging.html">
   Errors and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teamwork.html">
   Collaboration and Teamwork
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../2/introduction.html">
   Getting Started with the Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/what_is_nds.html">
   What is Data Science?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/data.html">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/tools_for_nds.html">
   Tools for Neural Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets.html">
     Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets_limits.html">
     Limitations of Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/reproducibility.html">
     Reproducibility
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/sci_prog_lang.html">
     Scientific Programming Languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/which_lang.html">
     Which language to use?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/libs.html">
     Libraries and packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/why_python.html">
     Why Python for this Course?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/class_tech.html">
   Technologies Used in this Class
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/lms.html">
     Learning Management System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/teams.html">
     MS Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/communication.html">
     Communication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/videos.html">
     Course Videos
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/coding.html">
   Coding Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/datacamp.html">
     DataCamp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/py4e.html">
     Python for Everybody (PY4E)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/terminal.html">
     The Terminal and Command Line
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/jupyter.html">
     Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/markdown.html">
     Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/cocalc.html">
     CoCalc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/github.html">
     GitHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/alltogether.html">
   Putting It All Together
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/get_going.html">
   Get Going!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introducing Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3/introduction.html">
   Introducing Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/getting_help.html">
   Getting Help with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/variables-and-assignment.html">
   Variables and Assignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/types-conversion.html">
   Data Types and Conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/built-in.html">
   Python Built-Ins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/lists.html">
   Lists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/dictionaries.html">
   Dictionaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/for-loops.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/conditionals.html">
   Conditionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/pandas-dataframes.html">
   pandas DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/looping-data-files.html">
   Looping Over Data Files
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualizing Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/introduction.html">
   Introduction to Data Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/plotting.html">
   Introduction to Plotting with Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/proc_vs_oo.html">
   Procedural versus Object-Oriented Plotting in Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/subplots.html">
   Subplots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/plotting_types.html">
   Thinking About Data for Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/seaborn.html">
   Introduction to Plotting with Seaborn
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/human_factors.html">
   Accessibility and Human Factors in Plotting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exploratory Data Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/introduction.html">
   Introduction to EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/repeated_measures.html">
   Working with Repeated Measures Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/data_cleaning.html">
   Data Cleaning - Dealing with Outliers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eda/ttests.html">
   Basic Statistics in Python:
   <em>
    t
   </em>
   tests with SciPy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Single Unit Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/introduction.html">
   Introduction to Single Unit Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/single_unit_intro.html">
   Single Unit Data and Spike Trains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/intro_spike_trains.html">
   Introduction to Spike Train Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/ten_intensities.html">
   Effects of Light Intensity on Spike Rate
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/heat_maps.html">
   Heat Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/intro_multielec_data.html">
   Introducing Multielectrode Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/pandas_multielec.html">
   Working with Multielectrode Data in pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../single_unit/corr_spike_trains.html">
   Correlating spike trains
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  EEG Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction to EEG/ERP Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time_freq.html">
   Time and Frequency Domains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="erps.html">
   Event-Related Potentials (ERPs)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="components.html">
   ERP Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mne_python.html">
   MNE-Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mne_data.html">
   Exploring MNE’s data structure
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="erp_preprocessing.html">
   EEG-ERP Preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="erp_filtering.html">
     Filtering EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="erp_artifacts.html">
     Artifacts in EEG Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="erp_segmentation.html">
     Segmentation into ERP epochs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="erp_rereferencing.html">
     Re-referencing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="erp_averaging.html">
     Averaging ERPs: Creating MNE Evoked objects
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Group Analysis of ERP Data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MRI Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/introduction.html">
   Introduction to MRI Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/read_viz.html">
   Reading and Visualizing Structural MRI Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/nifti.html">
   Working with NIfTI images
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../zrefs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/eeg/erp_group.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook/issues/new?title=Issue%20on%20page%20%2Feeg/erp_group.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DalPsychNeuro/NESC_3505_textbook/master?urlpath=tree/eeg/erp_group.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-packages">
   Load packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-parameters">
   Define parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-data-files">
   Find data files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data-files">
   Load data files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-evoked-waveforms">
   Compare Evoked waveforms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differences">
   Differences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-difference-waveform">
   Plot difference waveform
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scalp-topographic-map">
   Scalp topographic map
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-analyses">
   Statistical analyses
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-priori-t-test">
     A priori
     <em>
      t
     </em>
     test
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#permutation-t-test-and-multiple-comparison-correction">
   Permutation
   <em>
    t
   </em>
   test and multiple comparison correction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#performing-a-permutation-t-test">
     Performing a permutation
     <em>
      t
     </em>
     test
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="group-analysis-of-erp-data">
<h1>Group Analysis of ERP Data<a class="headerlink" href="#group-analysis-of-erp-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="load-packages">
<h2>Load packages<a class="headerlink" href="#load-packages" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mne</span>
<span class="n">mne</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>  <span class="c1"># reduce extraneous MNE output</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-parameters">
<h2>Define parameters<a class="headerlink" href="#define-parameters" title="Permalink to this headline">¶</a></h2>
<p>We define a list of experimental conditions; that’s about the only parameter we need to define here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Control&#39;</span><span class="p">,</span> <span class="s1">&#39;Violation&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="find-data-files">
<h2>Find data files<a class="headerlink" href="#find-data-files" title="Permalink to this headline">¶</a></h2>
<p>We list all the <code class="docutils literal notranslate"><span class="pre">-ave.fif</span></code> files (<code class="docutils literal notranslate"><span class="pre">Evoked</span></code> data sets) associated with this experiment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
<span class="n">data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;/sentence_n400_p*-ave.fif&#39;</span> <span class="p">)</span>
<span class="n">data_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;data/sentence_n400_p22-ave.fif&#39;,
 &#39;data/sentence_n400_p14-ave.fif&#39;,
 &#39;data/sentence_n400_p04-ave.fif&#39;,
 &#39;data/sentence_n400_p05-ave.fif&#39;,
 &#39;data/sentence_n400_p15-ave.fif&#39;,
 &#39;data/sentence_n400_p23-ave.fif&#39;,
 &#39;data/sentence_n400_p17-ave.fif&#39;,
 &#39;data/sentence_n400_p07-ave.fif&#39;,
 &#39;data/sentence_n400_p21-ave.fif&#39;,
 &#39;data/sentence_n400_p20-ave.fif&#39;,
 &#39;data/sentence_n400_p06-ave.fif&#39;,
 &#39;data/sentence_n400_p16-ave.fif&#39;,
 &#39;data/sentence_n400_p13-ave.fif&#39;,
 &#39;data/sentence_n400_p03-ave.fif&#39;,
 &#39;data/sentence_n400_p25-ave.fif&#39;,
 &#39;data/sentence_n400_p24-ave.fif&#39;,
 &#39;data/sentence_n400_p02-ave.fif&#39;,
 &#39;data/sentence_n400_p12-ave.fif&#39;,
 &#39;data/sentence_n400_p26-ave.fif&#39;,
 &#39;data/sentence_n400_p09-ave.fif&#39;,
 &#39;data/sentence_n400_p19-ave.fif&#39;,
 &#39;data/sentence_n400_p10-ave.fif&#39;,
 &#39;data/sentence_n400_p01-ave.fif&#39;,
 &#39;data/sentence_n400_p11-ave.fif&#39;,
 &#39;data/sentence_n400_p18-ave.fif&#39;,
 &#39;data/sentence_n400_p08-ave.fif&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-data-files">
<h2>Load data files<a class="headerlink" href="#load-data-files" title="Permalink to this headline">¶</a></h2>
<p>In the previous lesson on averaging trials for an individual participant, we ended by saving the list of MNE <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects (representing the averages across trials for each condition) in a single file for that participant.</p>
<p>Here, we will load in the files from a group of participants. To work with them easily and efficiently in MNE, we will store them as a dictionary, where each key is a condition label, and each value is a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects (the data from that condition, with each participant’s <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> as a list item).</p>
<p>Here when we <code class="docutils literal notranslate"><span class="pre">read_evokeds()</span></code> you will likewise get a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects. Lists are a bit tricky since they don’t contain labels. In the previous lesson we addressed this by manually changing the <code class="docutils literal notranslate"><span class="pre">.comment</span></code> field of each <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> object to clearly label it. As well, in the case of the present data (as is good practice in any data science pipeline), we used the same code to generate all of the Evoked files, so the two experimental conditions occur in the same order in each <code class="docutils literal notranslate"><span class="pre">-ave.fif</span></code> file. Since each participant’s data was saved in the same order, index 0 in the list will always be the same condition for all participants. For this reason, we can use <code class="docutils literal notranslate"><span class="pre">enumerate()</span></code> to loop over conditions and build our dictionary of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects here.</p>
<p>Note that we use list comprehension to build the list of Evoked objects for each condition, and we use the index from <code class="docutils literal notranslate"><span class="pre">enumerate()</span></code> (<code class="docutils literal notranslate"><span class="pre">idx</span></code>) to specify which condition (list item) we read from each participant’s data file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evokeds</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
    <span class="n">evokeds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mne</span><span class="o">.</span><span class="n">read_evokeds</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_files</span><span class="p">]</span>

<span class="n">evokeds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Control&#39;: [&lt;Evoked | &#39;Control&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=35), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=38), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=41), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=33), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=34), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=32), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=31), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=10), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=37), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=35), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=27), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=34), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=41), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=37), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=37), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=41), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Control&#39; (average, N=29), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;],
 &#39;Violation&#39;: [&lt;Evoked | &#39;Violation&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=36), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=37), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=38), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=33), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=34), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=38), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=32), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=35), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=36), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=10), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=33), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=26), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=25), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=37), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=38), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=39), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=36), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=40), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=38), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
  &lt;Evoked | &#39;Violation&#39; (average, N=29), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;]}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compare-evoked-waveforms">
<h2>Compare Evoked waveforms<a class="headerlink" href="#compare-evoked-waveforms" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">mne.viz.plot_compare_evokeds()</span></code> will recognize a dictionary of Evoked objects and use the keys as condition labels. Furthermore, when it sees that each value in the dictionary is a list of Evoked objects, it will combine them and plot not only the mean across the list (i.e., across participants, for each condition), but also the 95% confidence intervals (CIs), representing the variability across participants. As we learned in the [EDA] chapter, CIs are a useful way of visually assessing whether different conditions are likely to be statistically significantly different. In this case, the plot shows evidence of an N400 effect. The difference between conditions is largest between ~350–650 ms, and the CIs are most distinct (overlapping little or not at all) between 500–650 ms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define plot parameters</span>
<span class="n">roi</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cz&#39;</span><span class="p">,</span> <span class="s1">&#39;C4&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;P3&#39;</span><span class="p">,</span> <span class="s1">&#39;Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;P4&#39;</span><span class="p">]</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Control&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;Violation&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}</span>
<span class="n">linestyle_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Control&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;Violation&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">}</span>


<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">(</span><span class="n">evokeds</span><span class="p">,</span>
                             <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                             <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                             <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                             <span class="n">colors</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span>
                             <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyle_dict</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Violation vs. Control Waveforms&#39;</span>
                            <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_11_0.png" src="../_images/erp_group_11_0.png" />
</div>
</div>
</div>
<div class="section" id="differences">
<h2>Differences<a class="headerlink" href="#differences" title="Permalink to this headline">¶</a></h2>
<p>As we did in the single-participant analysis, we can also create difference waves to more easily visualize the difference between conditions, and compare it to zero (i.e., no difference between conditions).</p>
<p>In order to get CIs that reflect the variance across participants, we need to compute the <em>Violation-Control</em> difference separately for each participant. As we did for a single participant’s data, we use <code class="docutils literal notranslate"><span class="pre">mne.combine_evoked()</span></code> for this, with a weight of <code class="docutils literal notranslate"><span class="pre">1</span></code> for <em>Violation</em> and <code class="docutils literal notranslate"><span class="pre">-1</span></code> for <em>Control</em>. The only difference here is we put this function in a loop over participants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_waves</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_files</span><span class="p">)):</span>
    <span class="n">diff_waves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mne</span><span class="o">.</span><span class="n">combine_evoked</span><span class="p">([</span><span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Violation&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">evokeds</span><span class="p">[</span><span class="s1">&#39;Control&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
                                          <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                         <span class="p">)</span>
                     <span class="p">)</span>

<span class="n">diff_waves</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;Evoked | &#39;Violation - Control&#39; (average, N=20.0), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=17.74647887323944), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=18.986842105263158), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.0), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.9875), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=16.5), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=18.37837837837838), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.487179487179485), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=16.484848484848484), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.746835443037973), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=16.716417910447763), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=16.65671641791045), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=5.0), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=20.0), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=17.442857142857143), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=14.918032786885247), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=12.98076923076923), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=17.718309859154928), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.246753246753247), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=20.24691358024691), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.746835443037973), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.5), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=18.246575342465754), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.22077922077922), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=19.72151898734177), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;,
 &lt;Evoked | &#39;Violation - Control&#39; (average, N=14.5), -0.19922 – 1 sec, baseline off, 64 ch, ~401 kB&gt;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-difference-waveform">
<h2>Plot difference waveform<a class="headerlink" href="#plot-difference-waveform" title="Permalink to this headline">¶</a></h2>
<p>In making the difference waveform above, we simply created a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects. We didn’t create a dictionary since there is only one contrast (<em>Violation-Control</em>), so no need to have informative dictionary keys for a set of different items (contrasts). This is fine, however MNE’s  <code class="docutils literal notranslate"><span class="pre">plot_compare_evokeds()</span></code> is a bit picky when it comes to its inputs, and whether it draws CIs or not. Specifically, the <a class="reference external" href="https://mne.tools/stable/generated/mne.viz.plot_compare_evokeds.html">API</a> reads:</p>
<blockquote>
<div><p>If a list of Evokeds, the contents are plotted with their .comment attributes used as condition labels… If a dict whose values are Evoked objects, the contents are plotted as single time series each and the keys are used as labels. If a [dict/list] of lists, the unweighted mean is plotted as a time series and the parametric confidence interval is plotted as a shaded area.</p>
</div></blockquote>
<p>In other words, when the function gets a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects as input, it will draw each object as a separate waveform, but if it gets a dictionary in which each entry is a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects, if will average them together and draw CIs. Since we desire the latter behaviour here, in the command below we create a dictionary “on the fly” inside the plotting command, with a key corresponding to the label we want, and the value being the list of difference waves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;Violation-Control&#39;</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_compare_evokeds</span><span class="p">({</span><span class="n">contrast</span><span class="p">:</span><span class="n">diff_waves</span><span class="p">},</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                            <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">picks</span><span class="o">=</span><span class="n">roi</span><span class="p">,</span> <span class="n">show_sensors</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">contrast</span>
                            <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_15_0.png" src="../_images/erp_group_15_0.png" />
</div>
</div>
</div>
<div class="section" id="scalp-topographic-map">
<h2>Scalp topographic map<a class="headerlink" href="#scalp-topographic-map" title="Permalink to this headline">¶</a></h2>
<p>As with <code class="docutils literal notranslate"><span class="pre">plot_compare_evoked()</span></code>, it’s important to understand what type of data the <code class="docutils literal notranslate"><span class="pre">plot_evoked_topomap()</span></code> function needs in order to get it to work right. Whereas <code class="docutils literal notranslate"><span class="pre">plot_compare_evoked()</span></code> will average over a list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects, <code class="docutils literal notranslate"><span class="pre">plot_evoked_topomap()</span></code> will only accept a single Evoked object as input. Therefore, in the command below we apply the <code class="docutils literal notranslate"><span class="pre">mne.grand_average()</span></code> function to the list of <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> objects (<strong>Grand averaging</strong> is a term used in EEG research to refer to an average across participants; this terminology developed to distinguish such an average from an average across trials, for a single participant).</p>
<p>Here we plot the topographic map for the average amplitude over a 200 ms period, centered on 500 ms (i.e., 300–500 ms).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_evoked_topomap</span><span class="p">(</span><span class="n">mne</span><span class="o">.</span><span class="n">grand_average</span><span class="p">(</span><span class="n">diff_waves</span><span class="p">),</span> 
                            <span class="n">times</span><span class="o">=</span><span class="mf">.500</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.200</span><span class="p">,</span> 
                            <span class="n">title</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="mi">3</span>
                           <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_17_0.png" src="../_images/erp_group_17_0.png" />
</div>
</div>
<p>We can add a few enhancements to the plot to make it more interpretable:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">show_names</span></code> kwarg tells the function to plot the names of each channel rather than just dots at each location.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">contours=False</span></code> kwarg turns off the dashed contour lines you can see above. This is a matter of personal preference, however I feel that these are like non-continuous colour scales, in that they provide visual indicators of discontinuous “steps” in the scalp electrical potential values, when in fact these vary smoothly and continuously.</p></li>
<li><p>We increase the <code class="docutils literal notranslate"><span class="pre">size</span></code> to make the channel labels a bit easier to read (unfortunately the function doesn’t provide a kwarg to adjust the font size of these).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_evoked_topomap</span><span class="p">(</span><span class="n">mne</span><span class="o">.</span><span class="n">grand_average</span><span class="p">(</span><span class="n">diff_waves</span><span class="p">),</span> 
                            <span class="n">times</span><span class="o">=</span><span class="mf">.500</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mf">0.200</span><span class="p">,</span> 
                            <span class="n">title</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
                            <span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="mi">4</span>
                           <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_19_0.png" src="../_images/erp_group_19_0.png" />
</div>
</div>
</div>
<div class="section" id="statistical-analyses">
<h2>Statistical analyses<a class="headerlink" href="#statistical-analyses" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-priori-t-test">
<h3>A priori <em>t</em> test<a class="headerlink" href="#a-priori-t-test" title="Permalink to this headline">¶</a></h3>
<p>A common approach to testing whether an ERP effect is significant is to perform a <em>t</em> test between a pair of conditions, on the ERP data averaged over a time period of interest and at one or a few electrodes. Ideally, the experimenter should have an <em>a priori</em> (i.e., defined prior to running the experiment) hypothesis regarding the time window and electrodes at which the ERP component and experimental effect of interest would be largest. In the present case, we predicted an N400, which we knew from previous studies with similar stimuli would likely be largest between 400–600 ms, at electrode Pz.</p>
<p>In this case, we will use the <code class="docutils literal notranslate"><span class="pre">ttest_1samp()</span></code> function from SciPy’s <code class="docutils literal notranslate"><span class="pre">stats</span></code> module. This tests whether a set of values are different from zero. So we use as input the <em>Violation-Control</em> differences for each participant, since if they are significantly different from zero, that will be evidence for a difference in amplitude between these two conditions.</p>
<p>So here we first compute the average over the 400–600 ms time window, for each participant, at electrode Pz, and store these in a NumPy array on which we then perform the <em>t</em> test. We create the NumPY array in a single line of code, but it’s a fairly complex one:</p>
<ul class="simple">
<li><p>we use list comprehension to loop over each participant (<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">e</span> <span class="pre">in</span> <span class="pre">diff_waves</span></code>)</p></li>
<li><p>for each participant’s <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> object, we use the <code class="docutils literal notranslate"><span class="pre">.get_data()</span></code> method to extract the ERP data</p>
<ul>
<li><p>we use the <code class="docutils literal notranslate"><span class="pre">picks</span></code> kwarg to specify which electrode(s) we want. In this cases, we specify a single electrode, however we could pass a list of several electrodes if we wanted.</p></li>
<li><p>we use the <code class="docutils literal notranslate"><span class="pre">tmin</span></code> and <code class="docutils literal notranslate"><span class="pre">tmax</span></code> kwargs to specify the time range over which we want to extract the ERP data</p></li>
</ul>
</li>
<li><p>The result of <code class="docutils literal notranslate"><span class="pre">get_data</span></code> will be a NumPy array of values at each time point in the time range we specified. We apply <code class="docutils literal notranslate"><span class="pre">np.mean()</span></code> to the result of <code class="docutils literal notranslate"><span class="pre">get_data</span></code>, to average across the 400-600 ms time window. We pass the <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> kwarg because the NumPy array will be 2D, with a row for each electrode (in this case, only 1 row), and columns for time. So <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> tells <code class="docutils literal notranslate"><span class="pre">np.mean()</span></code> to average over columns (axis 1; time) and not rows (axis 0; electrodes).</p></li>
<li><p>Since we used list comprehension to loop across participants, we end up with a list of NumPy arrays (one for each participant). Thus the outermost (last applied) function below is <code class="docutils literal notranslate"><span class="pre">np.array()</span></code> to convert the list of values from each participant to a NumPy array, because <code class="docutils literal notranslate"><span class="pre">ttest_1samp()</span></code> requires a NumPy array as input.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evoked_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s1">&#39;Pz&#39;</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mf">.400</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">.600</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">diff_waves</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now we perform the <em>t</em>-test. Note that <code class="docutils literal notranslate"><span class="pre">ttest_1samp()</span></code> produces NumPy arrays for its outputs (which here we assign to <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">pval</span></code>), even when we only performed one <em>t</em>-test. So when we print the results on the last line, we need to use <code class="docutils literal notranslate"><span class="pre">t[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">p[0]</span></code> rather than simply <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span> 

<span class="n">t</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">evoked_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Difference t = &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)),</span> <span class="s1">&#39;p = &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Difference t =  -2.93 p =  0.0071
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="permutation-t-test-and-multiple-comparison-correction">
<h2>Permutation <em>t</em> test and multiple comparison correction<a class="headerlink" href="#permutation-t-test-and-multiple-comparison-correction" title="Permalink to this headline">¶</a></h2>
<p>Another approach is to perform a <em>t</em> test at <em>every</em> electrode, so that we can visualize a statistical map of values across the scalp. This has the advantage of potentially revealing the true scalp distribution of an experimental effect, rather than being limited to the channel(s) predicted a priori to show the effect.</p>
<p>However, this increases our risk of false positives (Type I error). This is because when we perform a <em>t</em> test and use the resulting <em>p</em> value to determine statistical significance, we typically pick a threshold for significance (alpha, or <span class="math notranslate nohighlight">\(\alpha\)</span>) based on the probability of finding a result by chance, if no experimental effect were actually present. In other words, if we use an <span class="math notranslate nohighlight">\(\alpha\)</span> of .05, this means there is on average a 5% probability of finding that result by chance.  However, that is based on the assumption that we ran only one statistical test. If we run multiple statistical tests, and use <em>p</em> ≤ .05 as our threshold, then we increase the odds of finding at least one “significant” result by chance. Most intuitively, if we perform 100 statistical tests and use <em>p</em> ≤ .05 on each, then we are likely to end up with 5 of those results being incorrect (5/100 = 5%).</p>
<p>In the present data we have data from 64 electrodes for each participant. One way to correct for multiple comparisons is the <strong>Bonferroni</strong> method, which involves simply dividing the desired <span class="math notranslate nohighlight">\(\alpha\)</span> value for the experiment (i.e., across all tests) by the number of tests. For this data set that would mean <span class="math notranslate nohighlight">\(.05 / 64 = 0.00078\)</span>. However, the Bonferroni correction assumes that each statistical test is independent of the others, which is not true for multiple channels of EEG data — nearby channels can be predicted to have similar values, since they are measuring activity from nearby scalp locations.</p>
<p>There are several alternative ways of controlling for multiple comparisons. One is to perform a <strong>permutation</strong> <em>t</em> test. Widely introduced to the field of neuroimaging by <a class="reference external" href="https://doi.org/10.1002/hbm.1058">Nichols and Holmes (2001)</a>permutation is a well-established approach in the field of statistics. The basic concepts in permutation testing are <em>exchangability</em> and <em>randomization</em>. If we have multiple data points from two sets of experimental conditions (e.g., <em>Violation</em> and <em>Control</em>), and there is no true difference between the conditions, then it should not matter if we perform a <em>t</em> test between the data points using the correct condition labels, or if we randomly re-label the condition of each data point (i.e., <em>exchange</em> the labels among data points). In other words, if ERP amplitude in the <em>Violation</em> and <em>Control</em> conditions are not truly different, then if we scramble which data points we call <em>Violation</em> and which ones we call <em>Control</em>, and perform the <em>t</em> test again, the results of that <em>t</em> test should not be too different from the “correct” <em>t</em> test. On the other hand, if there is a true experimental effect, then randomizing the labels of each data point should result in consistently lower <em>t</em> values than the true labeling. The reason this approach is called <em>permutation</em> testing is that we perform the random exchange of labels and data points many times, each with a different reassignment (i.e., a different permutation of labels and data points). Typically this is done thousands of times, in order to get a reliable estimate of the <em>null distribution</em> — that is, the distribution of <em>t</em> scores across different permutations that we know don’t match the true label-to-data-point mapping.</p>
<p>This approach doesn’t in and of itself correct for multiple comparisons. However, when permutation tests are performed over a number of different sets of data (such as a separate <em>t</em> test on the data from each individual electrode), can can use this to correct for multiple comparisons. This is called the <strong>maximal statistic</strong> method. It is based on the recognition that the distribution of <em>t</em> (and associated <em>p</em>) values across thousands of random permutations of labels actually reflects the “chance” that our use <em>p</em> values are based on. In other words, in conventional <em>t</em> tests if we use an <span class="math notranslate nohighlight">\(\alpha\)</span> of .05, then we are saying that we accept a 5% chance that over many replications of the experiment we would get a “significant” result by chance. Since our permutation distribution actually <em>is</em> thousands of replications of an “experiment” in which there is no true effect, we can say that the top 5% of the <em>t</em> values we obtain from the permutations are what we consider “significant”. We can provide even better control for multiple comparisons by looking at the maximum <em>t</em> values not just at each electrode separately, but across all the electrodes. We can set the critical <em>t</em> value (i.e., the <em>t</em> threshold for significance) to be <span class="math notranslate nohighlight">\((\alpha * N) + 1\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the number of electrodes. That is, our <em>t</em> threshold is set so that just under 5% of the randomly-obtained <em>t</em> values are greater than this threshold.</p>
<div class="section" id="performing-a-permutation-t-test">
<h3>Performing a permutation <em>t</em> test<a class="headerlink" href="#performing-a-permutation-t-test" title="Permalink to this headline">¶</a></h3>
<p>MNE provides a <code class="docutils literal notranslate"><span class="pre">permutation_t_test()</span></code> function which we import here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mne.stats</span> <span class="kn">import</span> <span class="n">permutation_t_test</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">permutation_t_test()</span></code> function only allows for a 1-sample test, so — similar to the single-electrode <em>t</em> test above — we will run this on the <em>Violation-Control</em> differences for each participant. So we then create a NumPy array of data from the difference waves of each of our participants. The only difference from the previous example is that we don’t use <code class="docutils literal notranslate"><span class="pre">picks</span></code> to select a channel; we extract data from all channels. We do average over our <em>a priori</em> time window of interest however.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evoked_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="mf">.400</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">.600</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">diff_waves</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>To run the test, we have to specify the number of permutations, here we use MNE’s suggested value of 50,000. We also use the <code class="docutils literal notranslate"><span class="pre">tail=-1</span></code> kwarg to specify a 1-tailed test that predicts a negative <em>t</em> score. This is because the N400 manifests as a greater negativity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_permutations</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">T0</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> <span class="n">permutation_t_test</span><span class="p">(</span><span class="n">evoked_data</span><span class="p">,</span> <span class="n">n_permutations</span><span class="p">,</span> <span class="n">tail</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result of <code class="docutils literal notranslate"><span class="pre">permutation_t_test()</span></code> is three NumPY arrays:</p>
<ul class="simple">
<li><p>the <em>t</em> values for each channel</p></li>
<li><p>the <em>p</em> values for each channel (corrected for multiple comparisons)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H0</span></code>, which is the null distribution — the maximum <em>t</em> value obtained during each permutation. This is the distribution that was used to determine the significance threshold. We don’t actually need to use it, because the corrections are all done by the <code class="docutils literal notranslate"><span class="pre">permutation_t_test()</span></code>, but it’s nice to know it’s there if we want to check.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.57080358, -0.78438487,  0.34835262, -2.11381352, -2.05960118,
       -1.80485844,  0.70287527, -1.09101426, -2.71791099, -2.83404371,
       -0.32752973, -0.99348145, -2.85223302, -3.22648929, -2.52654325,
        0.38805246, -1.5039293 , -2.60796913, -3.44881633, -3.30694221,
       -2.57367496,  1.5039293 , -3.0754765 , -3.36663645, -2.93349562,
       -2.26302196, -1.08830748, -0.52104647, -1.34525076, -0.9639556 ,
       -0.85953252, -0.6152627 , -0.07731113, -1.54813276, -1.1683513 ,
       -0.29418639, -0.45670357, -2.32021222, -2.55827164, -0.7602541 ,
        1.10853944,  0.25464935, -2.31532559, -2.51929001,  0.91885973,
        2.34076753, -2.00110272, -2.59168734, -3.20453629, -1.55360864,
       -1.22215648, -3.67798169, -3.55926501, -3.46564789, -0.88086133,
       -3.45152841, -3.49481003, -3.15971938, -2.40859398, -2.19467569,
       -2.55486174, -1.96350269, -2.22094286, -0.70239699])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.     , 0.99964, 1.     , 0.46338, 0.4969 , 0.66972, 1.     ,
       0.98558, 0.16978, 0.13588, 1.     , 0.99418, 0.13146, 0.06112,
       0.2431 , 1.     , 0.8526 , 0.20966, 0.03728, 0.05156, 0.22316,
       1.     , 0.08446, 0.04474, 0.11148, 0.37106, 0.98614, 1.     ,
       0.92416, 0.99578, 0.9989 , 0.99998, 1.     , 0.82784, 0.97354,
       1.     , 1.     , 0.33972, 0.22938, 0.99982, 1.     , 1.     ,
       0.34228, 0.24622, 1.     , 1.     , 0.53696, 0.2163 , 0.06432,
       0.82456, 0.96172, 0.0217 , 0.02834, 0.0358 , 0.99852, 0.03712,
       0.03344, 0.07098, 0.29622, 0.41184, 0.23064, 0.56186, 0.39684,
       0.99996])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H0</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(50000,)
</pre></div>
</div>
</div>
</div>
<p>If we plot a histogram of the maximum <em>t</em> values from <code class="docutils literal notranslate"><span class="pre">H0</span></code>, we see that the bulk values are between 1–5, with a long tail extending out on the positive end to just above 8. Note that because of how the <code class="docutils literal notranslate"><span class="pre">permutation_t_test</span></code> function is written, these values are all positive, even though our actual predicted significant <em>t</em> values will be negative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">H0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_36_0.png" src="../_images/erp_group_36_0.png" />
</div>
</div>
<p>We can use a function <code class="docutils literal notranslate"><span class="pre">np.argpartition()</span></code> to sort the <code class="docutils literal notranslate"><span class="pre">H0</span></code> values and split them at a particular cutoff. This is specified in terms of indexes in the NumPy array, so if we want the top 5% of <em>t</em> values, we have to compute the split as the number of permutations (the length of <code class="docutils literal notranslate"><span class="pre">H0</span></code>) multiplied by .05, which will tell as that 5% of 50,000 is 2500. (If you want to understand the details of this code, see <a class="reference external" href="https://stackoverflow.com/questions/6910641/how-do-i-get-indices-of-n-maximum-values-in-a-numpy-array">this StackExchange post</a> and the <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.argpartition.html">API for <code class="docutils literal notranslate"><span class="pre">np.argpartition()</span></code></a>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thresh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">n_permutations</span> <span class="o">*</span> <span class="mf">.05</span><span class="p">)</span>
<span class="n">split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="o">-</span><span class="n">thresh</span><span class="p">)[</span><span class="o">-</span><span class="n">thresh</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>Our permutation-corrected <em>t</em> threshold will be the lowest value in <code class="docutils literal notranslate"><span class="pre">split</span></code>, because <code class="docutils literal notranslate"><span class="pre">split</span></code> contains the largest 5% of <em>t</em> values in the distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_thresh</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">split</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t_thresh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.320041807432393
</pre></div>
</div>
</div>
</div>
<p>We can also plot the histogram just of this top 5% of <em>t</em> values. We set the <em>y</em> axis limit to be comparable to the full distribution of <em>t</em> values above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">H0</span><span class="p">[</span><span class="n">split</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_42_0.png" src="../_images/erp_group_42_0.png" />
</div>
</div>
<p>We can apply a mask to the <em>t</em> values from each electrode to see which ones are significant at our threshold. We need to put the <code class="docutils literal notranslate"><span class="pre">-</span></code> sign in front of <code class="docutils literal notranslate"><span class="pre">t_thresh</span></code> since we are predicting negative <em>t</em> values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T0</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">t_thresh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
        True, False, False, False, False,  True, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False,  True,  True,  True,
       False,  True,  True, False, False, False, False, False, False,
       False])
</pre></div>
</div>
</div>
</div>
<p>We can see that there are 7 significant channels across the scalp. We can visualize them by plotting a topographic statistical map of the head, in which the colours reflect the <em>p</em> values, and significant electrodes are shown as white dots.</p>
<p>To do this, we create a new <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> object in which the data values are the <em>p</em> values from our permutation <em>t</em> test. The data we use in this <code class="docutils literal notranslate"><span class="pre">Evoked</span></code> are the negative log of the <em>p</em> values, which transforms the values so that the most significant <em>p</em> values become the largest values after transformation. This means that when we plot the <em>p</em> values, “bigger” means “more significant”, which is the way we normally and intuitively interpret colour maps.</p>
<p>The code below references <code class="docutils literal notranslate"><span class="pre">evokeds[conditions[0]][0].info</span></code> simply to copy the header from one of our actual evoked data sets to the newly-created one. This is important because to make a topographic plot, we’ll need information like channel positions and possibly labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evoked_p</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">EvokedArray</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p_values</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                         <span class="n">evokeds</span><span class="p">[</span><span class="n">conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To highlight the significant electrodes, we will need a mask like the one above that is True where the <em>t</em> test was significant, and False elsewhere. We use <code class="docutils literal notranslate"><span class="pre">p_values[:,</span> <span class="pre">np.newaxis]</span></code> rather than just <code class="docutils literal notranslate"><span class="pre">p_values</span></code>, so that the mask is a 2D (1 x n_channels) array with the values in a single column, because this is how the <code class="docutils literal notranslate"><span class="pre">plot_topomap()</span></code> function requires the mask to be formatted. <code class="docutils literal notranslate"><span class="pre">np.newaxis</span></code> is a <a class="reference external" href="https://numpy.org/doc/stable/reference/constants.html#numpy.newaxis">tool in NumPy</a> for increasing the number of dimensions in an array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">p_values</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we generate the topographic plot. A few new or unusual kwargs are worth noting:</p>
<ul class="simple">
<li><p>Since this is a map of <em>p</em> values, “time” doesn’t make sense, however the function requires a <code class="docutils literal notranslate"><span class="pre">times</span></code> value otherwise it defaults to plotting 4 time points (so in this case, 4 copies of the same plot)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scalings=1</span></code> rounds the numerical values on the colour bar to 1 decimal place</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">Reds</span></code> cmap is used because the default Red-Blue map doesn’t make sense for -log(p) values, which cannot be negative.</p></li>
<li><p>we use <code class="docutils literal notranslate"><span class="pre">vmin</span></code> to specify the minimum value for the colour scale to be 0, since the minimum value in the data is not zero, but it makes sense for the colourmap to use white to mean zero</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">mask</span></code> is used to highlight significant electrodes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evoked_p</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">scalings</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> 
                    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;-log10(p)&#39;</span><span class="p">,</span> 
                    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/erp_group_50_0.png" src="../_images/erp_group_50_0.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./eeg"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="erp_averaging.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Averaging ERPs: Creating MNE Evoked objects</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../mri/introduction.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to MRI Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Aaron J Newman<br/>
        
            &copy; Copyright 2020-21. This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>