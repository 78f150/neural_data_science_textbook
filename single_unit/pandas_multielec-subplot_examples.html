
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Working with Multielectrode Data in pandas &#8212; Data Science for Psychology and Neuroscience — in Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://dalpsychneuro.github.io/NESC_3505_textbook/single_unit/pandas_multielec-subplot_examples.html" />
    <link rel="shortcut icon" href="../_static/NESC3505_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/NESC3505_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Psychology and Neuroscience — in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  About This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/why.html">
   Start with why
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_objectives.html">
   Learning Objectives for this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../syllabus.html">
   Syllabus
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Pedagogy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teaching_approach.html">
   Teaching Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/online_learning.html">
   Hybrid Online Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/assessment_evaluation.html">
   Assessment and Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/constructivism.html">
   Constructivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/connectivism.html">
   Connectivism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/authenticity.html">
   Authenticity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/21st_cen_skills.html">
   21st Century Skills
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Open Software, Science, &amp; Education
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open.html">
   Open Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/software.html">
   Free Software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/free_licenses.html">
   Free and Open-Source Software Licenses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_science.html">
   Open Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/peer_review.html">
   Peer Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/for_profit.html">
   For-Profit Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/impact_factors.html">
   Impact Factors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/novelty.html">
   Novelty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_publishing.html">
   Open Publishing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/preregistration.html">
   Preregistration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/open_methods.html">
   Open Methods and Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer.html">
   Open Educational Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/oer_this_course.html">
   OERs in the Context of this Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/licenses.html">
   Licenses
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  How to Rock This Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1/learning_approach.html">
   Learning Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/mindset.html">
   Mindset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/errors_debugging.html">
   Errors and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1/teamwork.html">
   Collaboration and Teamwork
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../2/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/what_is_nds.html">
   What is Data Science?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/data.html">
     Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/tools_for_nds.html">
   Tools for Neural Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets.html">
     Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/spreadsheets_limits.html">
     Limitations of Spreadsheets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/reproducibility.html">
     Reproducibility
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/sci_prog_lang.html">
     Scientific Programming Languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/which_lang.html">
     Which language to use?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/libs.html">
     Libraries and packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/why_python.html">
     Why Python for this Course?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/class_tech.html">
   Technologies Used in this Class
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/lms.html">
     Learning Management System
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/teams.html">
     MS Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/communication.html">
     Communication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/videos.html">
     YouTube
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2/coding.html">
   Coding Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/datacamp.html">
     DataCamp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/py4e.html">
     Python for Everybody (PY4E)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/terminal.html">
     The Terminal and Command Line
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/jupyter.html">
     Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/markdown.html">
     Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/cocalc.html">
     CoCalc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2/github.html">
     GitHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/alltogether.html">
   Putting It All Together
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2/get_going.html">
   Get Going!
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Introducing Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/getting_help.html">
   Getting Help with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/variables-and-assignment.html">
   Variables and Assignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/types-conversion.html">
   Data Types and Conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/built-in.html">
   Python Built-Ins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/lists.html">
   Lists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/dictionaries.html">
   Dictionaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/for-loops.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     for
    </span>
   </code>
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/conditionals.html">
   Conditionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/pandas-dataframes.html">
   pandas DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3/looping-data-files.html">
   Looping Over Data Files
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Visualizing Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/introduction.html">
   Introduction to Data Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/plotting.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../visualization/proc-vs-oo.html">
   Procedural versus Object-Oriented Plotting in Matplotlib
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Single Unit Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="single_unit_intro.html">
   Single Unit Data and Spike Trains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_spike_trains.html">
   Introduction to Spike Train Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ten_intensities.html">
   Ten intensities — A bigger data set
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heat_maps.html">
   Heat Maps, Interpolation, and Colour Map Choice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_multielec_data.html">
   Introducing Multielectrode Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="import_multielec_data.html">
   Importing Multielectrode Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_multielec.html">
   Working with Multielectrode Data in pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="corr_spike_trains.html">
   Correlating spike trains
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  EEG Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/time_freq.html">
   Time and Frequency Domains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/erps.html">
   Event-Related Potentials (ERPs)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eeg/components.html">
   ERP Components
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eeg/preprocessing.html">
   Preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/filtering.html">
     Filtering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/event_codes.html">
     Event Codes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/epoching.html">
     Epoching (Segmentation)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/artifacts.html">
     Artifacts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/averaging.html">
     Averaging
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eeg/mne-python.html">
   MNE-Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/mne_org.html">
     Organization of MNE-Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eeg/mne_classes.html">
     MNE classes
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  MRI Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mri/learning_objectives.html">
   Learning Objectives
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../machine_learning/introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../zrefs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/single_unit/pandas_multielec-subplot_examples.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/DalPsychNeuro/NESC_3505_textbook/issues/new?title=Issue%20on%20page%20%2Fsingle_unit/pandas_multielec-subplot_examples.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/DalPsychNeuro/NESC_3505_textbook/master?urlpath=tree/single_unit/pandas_multielec-subplot_examples.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-packages">
   Import packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-the-data">
   Import the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-derive-experiment-parameters">
   Set/derive experiment parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-data-to-pandas-dataframe">
   Convert Data to pandas DataFrame
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploring-the-data">
     Exploring the data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#peri-stimulus-time-histograms-psth">
   Peri-Stimulus Time Histograms (PSTH)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-computing-psths">
     Pre-Computing PSTHs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-the-histograms">
     Plotting the Histograms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#procedural-approach">
     Procedural approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#object-oriented-approach">
     Object-Oriented Approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overlaying-conditions">
     Overlaying Conditions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#psth-for-each-channel">
   PSTH for each channel
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-all-channels">
     Plot all channels
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interactive-plots">
   Interactive plots
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="working-with-multielectrode-data-in-pandas">
<h1>Working with Multielectrode Data in pandas<a class="headerlink" href="#working-with-multielectrode-data-in-pandas" title="Permalink to this headline">¶</a></h1>
<p>Whereas the data we imported from Matlab are in a somewhat Byzantine embedded format, pandas offers a more simple and intuitive format, often called <strong>long format</strong>, in which data are stored in a 2-dimensional matrix (rows and columns), with one data point per row. Each row comprises the data itself, and additional columns that label the data.</p>
<p>For this data set, using pandas long format, we’ll want columns for:</p>
<ul class="simple">
<li><p>channel (which electrode the data came from)</p></li>
<li><p>sort code</p></li>
<li><p>time (of spike)</p></li>
<li><p>orientation</p></li>
<li><p>trial number</p></li>
</ul>
<p>One downside of long format is that it is not memory-efficient, since we have so many redundant labels. In contrast, think back to the <code class="docutils literal notranslate"><span class="pre">ten_intensities</span></code> data in previous sections of the chapter. That data was stored as a dictionary, with each entry in the dictionary being the contrast label. Therefore, the contrast label only had to be stored once in memory, and all the data inside the dictionary entry would be categorized as having that label. In contrast, every data point in pandas carries a copy of the intensity label, meaning more information is stored in memory.</p>
<p>There are two significant downsides of less efficient memory storage. Firstly, that it takes more memory (RAM) on the system it’s running on. In large data sets, the amount of RAM available (either on a computer or a cloud server) may actually become a limitation in the amount of data you can work with. Secondly, operations on the data tend to take longer, due to the larger amount of information that needs to be processed. Pandas is written to handle large data pretty efficiently, but it’s not always the most efficient way of doing things.</p>
<p>On the other hand, long data is very intuitive to work with, and avoids having to resort to the complex embedded data structure described above in decoding the Matlab file. And pandas is a great package to work with, as it provides a lot of powerful features for manipulating data, and grouping it by different properties and combinations of properties. These are tasks we routinely want to do in neural data science, and it becomes easier to work with different data sets and even types of data, if we consistently use a common framework like pandas. And in spite of its somewhat inefficient way of storing data, pandas is still highly optimized and generally quite fast.</p>
<section id="import-packages">
<h2>Import packages<a class="headerlink" href="#import-packages" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-the-data">
<h2>Import the data<a class="headerlink" href="#import-the-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_in</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;arrayDATA.mat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-derive-experiment-parameters">
<h2>Set/derive experiment parameters<a class="headerlink" href="#set-derive-experiment-parameters" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span> <span class="c1"># explained later</span>

<span class="c1"># time_bins is used to define x axis in plots over time. We know that the trials went from </span>
<span class="c1">#   150 ms pre-stimulus to 2000 ms post-stimulus onset. Here we specify a wider range, </span>
<span class="c1">#   from -200 to 2500 ms (in 10 ms increments), to provide some padding.</span>
<span class="n">time_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">.01</span><span class="p">)</span> 

<span class="c1"># times the stimulus went on and off</span>
<span class="n">grating_on_time</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">grating_off_time</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">num_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">])</span>
<span class="n">all_ortn</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">)]</span> <span class="c1">#intermediate variable</span>
<span class="n">ortn_levs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ortn</span><span class="p">))</span>
<span class="n">num_ortn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ortn_levs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-data-to-pandas-dataframe">
<h2>Convert Data to pandas DataFrame<a class="headerlink" href="#convert-data-to-pandas-dataframe" title="Permalink to this headline">¶</a></h2>
<p>The code below uses list comprehension to loop through each trial’s data and turn it into a pandas DataFrame. This results in a list of DataFrames, each being the data from one trial. We then use <code class="docutils literal notranslate"><span class="pre">pd.concat()</span></code> to convert the list of DataFrames to a single pandas DataFrame.</p>
<p>This uses a couple of NumPy functions we haven’t seen before. <code class="docutils literal notranslate"><span class="pre">np.c_</span></code> concatenates a series of NumPy objects into columns. We do this because we want to combine the three-column data array with additional columns that encode the orientation and trial number information. We create those latter columns using <code class="docutils literal notranslate"><span class="pre">np.repeat</span></code>, which generates a NumPy array by broadcasting (repeating) the input (first argument) a specified number of times (second argument; in this case, the length of the input NumPy data array, which we get as <code class="docutils literal notranslate"><span class="pre">data_in['DATA'][trial][0][0].shape[0]</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;trial&#39;</span><span class="p">]</span>

<span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">][</span><span class="n">trial</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">][</span><span class="n">trial</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">][</span><span class="n">trial</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> 
                                        <span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">][</span><span class="n">trial</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                             <span class="p">],</span>
                        <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We know from the provider of the data that sort codes 0 and 255 represent bad data, so above we defined these as <code class="docutils literal notranslate"><span class="pre">noise_codes</span></code>. Here we remove all rows that have these sort codes. Note that the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator in front of a statement means “not”. So here we are saying to keep in <code class="docutils literal notranslate"><span class="pre">df</span></code> only those rows where <code class="docutils literal notranslate"><span class="pre">sort</span></code> is <em>not</em> equal to one of the <code class="docutils literal notranslate"><span class="pre">noise_codes</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">noise_codes</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s view the DataFrame. Note the size: over 2 million entries!!!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>channel</th>
      <th>sort</th>
      <th>time</th>
      <th>orientation</th>
      <th>trial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.624</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.630</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>0.652</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>0.659</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.689</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1321</th>
      <td>18.0</td>
      <td>1.0</td>
      <td>2.625</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1323</th>
      <td>74.0</td>
      <td>2.0</td>
      <td>2.629</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1324</th>
      <td>18.0</td>
      <td>1.0</td>
      <td>2.634</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1325</th>
      <td>60.0</td>
      <td>1.0</td>
      <td>2.636</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1326</th>
      <td>42.0</td>
      <td>1.0</td>
      <td>2.638</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
  </tbody>
</table>
<p>2340739 rows × 5 columns</p>
</div></div></div>
</div>
<section id="exploring-the-data">
<h3>Exploring the data<a class="headerlink" href="#exploring-the-data" title="Permalink to this headline">¶</a></h3>
<p>Let’s see how many electrodes we have data from, and what their labels are. We save each as a variable, which will come in handy later in looping through these.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_chan</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of electrodes (channels): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_chan</span><span class="p">))</span>

<span class="n">channels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># use the sorted() function so the channels are listed in sequential order</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Channel labels: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channels</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of electrodes (channels): 91
Channel labels: [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 32.0, 33.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0, 66.0, 67.0, 69.0, 70.0, 71.0, 72.0, 73.0, 74.0, 75.0, 76.0, 77.0, 78.0, 79.0, 80.0, 81.0, 82.0, 83.0, 84.0, 85.0, 86.0, 87.0, 88.0, 89.0, 90.0, 91.0, 92.0, 93.0, 94.0, 95.0, 96.0]
</pre></div>
</div>
</div>
</div>
<p>This is a bit weird — we’re told this is a 96 electrode array, but there are only 91 electrodes?!  Nylen and Wallisch note that there were some ‘dead’ channels in the microarray that yielded no data. This is not uncommon as some electrodes in the microarray may be damaged during insertion. This is not a big deal, but it is worth keeping in mind when we look at the data.</p>
<p>What about orientations?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orientations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">num_ortns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orientations</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_ortns</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; orientations, which are: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">orientations</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 2 orientations, which are: [0.0, 90.0]
</pre></div>
</div>
</div>
</div>
<p>And sort codes?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sort_codes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sort_codes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.0, 2.0, 3.0, 4.0]
</pre></div>
</div>
</div>
</div>
<p>We can also flex our pandas slicing and filtering skills to sample the data in different ways. For example, here’s the data only from electrode number 20:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">20.</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>channel</th>
      <th>sort</th>
      <th>time</th>
      <th>orientation</th>
      <th>trial</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.624</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.630</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>0.652</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>0.659</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>0.689</td>
      <td>90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1180</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>2.079</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1184</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>2.093</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1192</th>
      <td>20.0</td>
      <td>3.0</td>
      <td>2.105</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1217</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>2.236</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
    <tr>
      <th>1227</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>2.273</td>
      <td>0.0</td>
      <td>2299.0</td>
    </tr>
  </tbody>
</table>
<p>233537 rows × 5 columns</p>
</div></div></div>
</div>
<p>Taking that further, we can for example extract the spike times for a particular channel and orientation if we desire. Since the result is a single column, this returns a pandas Series rather than a DataFrame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chan</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ortn</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">chan</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ortn</span><span class="p">)][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7      -0.097
22     -0.079
755     0.949
1108    1.445
1371    1.965
        ...  
1009    1.683
1056    1.771
1172    2.032
1185    2.095
1220    2.246
Name: time, Length: 10283, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="peri-stimulus-time-histograms-psth">
<h2>Peri-Stimulus Time Histograms (PSTH)<a class="headerlink" href="#peri-stimulus-time-histograms-psth" title="Permalink to this headline">¶</a></h2>
<p>In the previous chapters, we used NumPy’s <code class="docutils literal notranslate"><span class="pre">hist</span></code> function to generate histograms, and then plotted them using Matplotlib functions. Now that we’re storing our data in a pandas DataFrame, we can make use of convenient pandas functions for plotting, instead.</p>
<p>We can use pandas’ <code class="docutils literal notranslate"><span class="pre">.hist()</span></code> method to obtain a PSTH, firstly just across all trials and electrodes/neurons, with the followig arguments:</p>
<ul class="simple">
<li><p>the values in the <code class="docutils literal notranslate"><span class="pre">time</span></code> column (spike times) are what are used to generate the histogram</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">by</span></code> argument generates separate plots for each value in the orientation column</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">time_bins</span></code> variable we set earlier defines the x axis of the histogram (<code class="docutils literal notranslate"><span class="pre">bins</span></code>); <code class="docutils literal notranslate"><span class="pre">time_bins</span></code> is in 10 ms increments so that becomes the size of our histogram bins</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sharey</span></code> forces the y axis range to be the same across plots</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">layout</span></code> specifies 2 rows (each orientation) and one column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">figsize</span></code> was determined by trial and error to provide a subjectively-nice aspect ratio and fit the figure in the notebook</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> 
        <span class="n">by</span><span class="o">=</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> 
        <span class="n">bins</span><span class="o">=</span><span class="n">time_bins</span><span class="p">,</span> 
        <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
       <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_26_0.png" src="../_images/pandas_multielec-subplot_examples_26_0.png" />
</div>
</div>
<p>Since we know there are 4 sort codes, we can also plot by both orientation and sort code. Here we turn off the <code class="docutils literal notranslate"><span class="pre">sharey</span></code> option, because the number of spikes varies by sort code.</p>
<p>We pass a list of two columns to <code class="docutils literal notranslate"><span class="pre">by</span></code> in order to break the data down by both <code class="docutils literal notranslate"><span class="pre">oriantation</span></code> and <code class="docutils literal notranslate"><span class="pre">sort</span></code>, and then we specify the <code class="docutils literal notranslate"><span class="pre">layout</span></code> as 2 rows (orientation) and 4 columns (sort).</p>
<p><strong>Note:</strong> This is actually not a valid thing to do from the point of view of the experiment, because the sort codes are unique to individual channels. That is, spike sorting is applied separately to each channel’s data, so for example <code class="docutils literal notranslate"><span class="pre">sort_code==1</span></code> does not refer to the same neuron in channels 1 and 2. However, right now our main goal is to demonstrate how to compute and plot the PSTHs separately along two dimensions. Below we’ll do that in a valid way, for all channels, but that’s a lot (91), so let’s start small.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> 
        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">],</span> 
        <span class="n">bins</span><span class="o">=</span><span class="n">time_bins</span><span class="p">,</span> 
        <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
        <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
       <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_28_0.png" src="../_images/pandas_multielec-subplot_examples_28_0.png" />
</div>
</div>
<section id="pre-computing-psths">
<h3>Pre-Computing PSTHs<a class="headerlink" href="#pre-computing-psths" title="Permalink to this headline">¶</a></h3>
<p>Although pandas provides the convenient <code class="docutils literal notranslate"><span class="pre">.histogram()</span></code> method, this is not the most flexible way to generate a plot. We can also compute histograms using <code class="docutils literal notranslate"><span class="pre">np.histogram()</span></code>, without immediately plotting them — just the way we did with the <code class="docutils literal notranslate"><span class="pre">ten_intensities</span></code> data. We save these histograms in memory, which allows more flexibility in how we later plot them. To do this, we have to loop over orientations and sort codes, compute the histogram for each, and save these to plot later.</p>
<p>We will store the PSTHs in a new pandas DataFrame, <code class="docutils literal notranslate"><span class="pre">psth_df</span></code>, with one row per PSTH. Each bin (time point) in the histogram will be a column, with additional columns to encode condition and sort code or channel.</p>
<p>First we create a DataFrame with columns that will serve as labels for the histograms:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ortn</span><span class="p">,</span> <span class="n">sort</span><span class="p">]</span> <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">sort_codes</span> <span class="k">for</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="n">orientations</span> <span class="p">],</span>
                               <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ortn&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">])</span>

<span class="n">condition_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ortn</th>
      <th>sort</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>90.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>90.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>90.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>90.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we create a list of DataFrames, where each DataFrame is a single row containing the histogram for a particular sort_code and orientation. It is important that the order of the nested loops here, is the same as the order of the <code class="docutils literal notranslate"><span class="pre">for</span></code> statements in the list comprehension that generated the column labels above. Otherwise the labels won’t correctly match the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psth_df_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">sort_codes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="n">orientations</span><span class="p">:</span>
        <span class="n">spike_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">sort</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ortn</span><span class="p">)][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span>
                          <span class="n">bins</span><span class="o">=</span><span class="n">time_bins</span><span class="p">,</span>
                         <span class="p">)</span>
        <span class="n">psth_df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
   
</pre></div>
</div>
</div>
</div>
<p>Concatenate the labels columns with the histograms. Note that inside the <code class="docutils literal notranslate"><span class="pre">pd.concat()</span></code> command, we’ve nested a command to combine the list of histogram DataFrames into a single DataFrame, which then gets combined with the column labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psth_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">condition_labels</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">psth_df_list</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psth_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ortn</th>
      <th>sort</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>...</th>
      <th>259</th>
      <th>260</th>
      <th>261</th>
      <th>262</th>
      <th>263</th>
      <th>264</th>
      <th>265</th>
      <th>266</th>
      <th>267</th>
      <th>268</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>2573</td>
      <td>3043</td>
      <td>2651</td>
      <td>2418</td>
      <td>3079</td>
      <td>3086</td>
      <td>3016</td>
      <td>3074</td>
      <td>...</td>
      <td>2185</td>
      <td>2111</td>
      <td>2128</td>
      <td>2047</td>
      <td>1996</td>
      <td>1896</td>
      <td>1975</td>
      <td>2070</td>
      <td>2016</td>
      <td>1956</td>
    </tr>
    <tr>
      <th>1</th>
      <td>90.0</td>
      <td>1.0</td>
      <td>2462</td>
      <td>3026</td>
      <td>2539</td>
      <td>2332</td>
      <td>3112</td>
      <td>3024</td>
      <td>2909</td>
      <td>2959</td>
      <td>...</td>
      <td>2218</td>
      <td>2200</td>
      <td>2132</td>
      <td>2201</td>
      <td>2111</td>
      <td>2115</td>
      <td>2107</td>
      <td>2143</td>
      <td>2099</td>
      <td>2027</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>208</td>
      <td>266</td>
      <td>222</td>
      <td>210</td>
      <td>240</td>
      <td>237</td>
      <td>255</td>
      <td>275</td>
      <td>...</td>
      <td>139</td>
      <td>108</td>
      <td>144</td>
      <td>144</td>
      <td>132</td>
      <td>119</td>
      <td>150</td>
      <td>116</td>
      <td>140</td>
      <td>122</td>
    </tr>
    <tr>
      <th>3</th>
      <td>90.0</td>
      <td>2.0</td>
      <td>194</td>
      <td>244</td>
      <td>188</td>
      <td>209</td>
      <td>249</td>
      <td>274</td>
      <td>207</td>
      <td>256</td>
      <td>...</td>
      <td>129</td>
      <td>115</td>
      <td>94</td>
      <td>129</td>
      <td>110</td>
      <td>106</td>
      <td>116</td>
      <td>143</td>
      <td>122</td>
      <td>112</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>3.0</td>
      <td>55</td>
      <td>60</td>
      <td>57</td>
      <td>50</td>
      <td>56</td>
      <td>47</td>
      <td>26</td>
      <td>32</td>
      <td>...</td>
      <td>15</td>
      <td>20</td>
      <td>21</td>
      <td>19</td>
      <td>13</td>
      <td>12</td>
      <td>13</td>
      <td>19</td>
      <td>16</td>
      <td>15</td>
    </tr>
    <tr>
      <th>5</th>
      <td>90.0</td>
      <td>3.0</td>
      <td>51</td>
      <td>64</td>
      <td>47</td>
      <td>51</td>
      <td>54</td>
      <td>51</td>
      <td>37</td>
      <td>39</td>
      <td>...</td>
      <td>17</td>
      <td>15</td>
      <td>27</td>
      <td>20</td>
      <td>9</td>
      <td>10</td>
      <td>25</td>
      <td>19</td>
      <td>21</td>
      <td>18</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.0</td>
      <td>4.0</td>
      <td>31</td>
      <td>30</td>
      <td>26</td>
      <td>27</td>
      <td>20</td>
      <td>25</td>
      <td>20</td>
      <td>13</td>
      <td>...</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>5</td>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>90.0</td>
      <td>4.0</td>
      <td>29</td>
      <td>28</td>
      <td>21</td>
      <td>23</td>
      <td>30</td>
      <td>21</td>
      <td>19</td>
      <td>13</td>
      <td>...</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>5</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 271 columns</p>
</div></div></div>
</div>
<p>The last bit of formatting we can add to the DataFrame is to convert the columns that serve as labels (<code class="docutils literal notranslate"><span class="pre">ortn</span></code>, <code class="docutils literal notranslate"><span class="pre">sort</span></code>) to indexes. This has two advantages:</p>
<ol class="simple">
<li><p>We can use the <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> method to select rows based on the labels, rather than the more-complex set of Boolean selectors on values in particular rows.</p></li>
<li><p>The “data” part of the DataFrame contains only PSTHs. This way, when we want to write code to access the data, we don’t have to worry about excluding columns that were for labels.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psth_df</span> <span class="o">=</span> <span class="n">psth_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ortn&#39;</span><span class="p">,</span><span class="s1">&#39;sort&#39;</span><span class="p">])</span>
<span class="n">psth_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>259</th>
      <th>260</th>
      <th>261</th>
      <th>262</th>
      <th>263</th>
      <th>264</th>
      <th>265</th>
      <th>266</th>
      <th>267</th>
      <th>268</th>
    </tr>
    <tr>
      <th>ortn</th>
      <th>sort</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <th>1.0</th>
      <td>2573</td>
      <td>3043</td>
      <td>2651</td>
      <td>2418</td>
      <td>3079</td>
      <td>3086</td>
      <td>3016</td>
      <td>3074</td>
      <td>2559</td>
      <td>2290</td>
      <td>...</td>
      <td>2185</td>
      <td>2111</td>
      <td>2128</td>
      <td>2047</td>
      <td>1996</td>
      <td>1896</td>
      <td>1975</td>
      <td>2070</td>
      <td>2016</td>
      <td>1956</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>1.0</th>
      <td>2462</td>
      <td>3026</td>
      <td>2539</td>
      <td>2332</td>
      <td>3112</td>
      <td>3024</td>
      <td>2909</td>
      <td>2959</td>
      <td>2502</td>
      <td>2151</td>
      <td>...</td>
      <td>2218</td>
      <td>2200</td>
      <td>2132</td>
      <td>2201</td>
      <td>2111</td>
      <td>2115</td>
      <td>2107</td>
      <td>2143</td>
      <td>2099</td>
      <td>2027</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>2.0</th>
      <td>208</td>
      <td>266</td>
      <td>222</td>
      <td>210</td>
      <td>240</td>
      <td>237</td>
      <td>255</td>
      <td>275</td>
      <td>290</td>
      <td>268</td>
      <td>...</td>
      <td>139</td>
      <td>108</td>
      <td>144</td>
      <td>144</td>
      <td>132</td>
      <td>119</td>
      <td>150</td>
      <td>116</td>
      <td>140</td>
      <td>122</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>2.0</th>
      <td>194</td>
      <td>244</td>
      <td>188</td>
      <td>209</td>
      <td>249</td>
      <td>274</td>
      <td>207</td>
      <td>256</td>
      <td>256</td>
      <td>259</td>
      <td>...</td>
      <td>129</td>
      <td>115</td>
      <td>94</td>
      <td>129</td>
      <td>110</td>
      <td>106</td>
      <td>116</td>
      <td>143</td>
      <td>122</td>
      <td>112</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>3.0</th>
      <td>55</td>
      <td>60</td>
      <td>57</td>
      <td>50</td>
      <td>56</td>
      <td>47</td>
      <td>26</td>
      <td>32</td>
      <td>22</td>
      <td>27</td>
      <td>...</td>
      <td>15</td>
      <td>20</td>
      <td>21</td>
      <td>19</td>
      <td>13</td>
      <td>12</td>
      <td>13</td>
      <td>19</td>
      <td>16</td>
      <td>15</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>3.0</th>
      <td>51</td>
      <td>64</td>
      <td>47</td>
      <td>51</td>
      <td>54</td>
      <td>51</td>
      <td>37</td>
      <td>39</td>
      <td>18</td>
      <td>26</td>
      <td>...</td>
      <td>17</td>
      <td>15</td>
      <td>27</td>
      <td>20</td>
      <td>9</td>
      <td>10</td>
      <td>25</td>
      <td>19</td>
      <td>21</td>
      <td>18</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>4.0</th>
      <td>31</td>
      <td>30</td>
      <td>26</td>
      <td>27</td>
      <td>20</td>
      <td>25</td>
      <td>20</td>
      <td>13</td>
      <td>8</td>
      <td>10</td>
      <td>...</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>5</td>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>4.0</th>
      <td>29</td>
      <td>28</td>
      <td>21</td>
      <td>23</td>
      <td>30</td>
      <td>21</td>
      <td>19</td>
      <td>13</td>
      <td>5</td>
      <td>8</td>
      <td>...</td>
      <td>1</td>
      <td>6</td>
      <td>6</td>
      <td>5</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 269 columns</p>
</div></div></div>
</div>
</section>
<section id="plotting-the-histograms">
<h3>Plotting the Histograms<a class="headerlink" href="#plotting-the-histograms" title="Permalink to this headline">¶</a></h3>
<p>Now we can plot the histograms that we just completed. These should look similar to the panel of 8 histograms we plotted above; the big difference is that above we use pandas <code class="docutils literal notranslate"><span class="pre">.histogram()</span></code> method, whereas here we pre-computed the histograms so that we can use Matplotlib’s more flexible and general-purpose <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> function. This allows us more control and power in drawing the plot. For example, below we shade in the time period when the stimulus was on, and we draw the PSTHs as lines rather than bars. ALthough this may seem like something of an aesthetic preference, as you’ll see below, lines give you the ability to overlay PSTHs for different conditions, allowing comparison.</p>
</section>
<section id="procedural-approach">
<h3>Procedural approach<a class="headerlink" href="#procedural-approach" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

<span class="c1"># loop through rows in DataFrame</span>
<span class="n">plot_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="n">ortn_levs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">sort_codes</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ortn_levs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sort_codes</span><span class="p">),</span> <span class="n">plot_counter</span><span class="p">)</span>
        <span class="n">plot_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># use .loc[] to select appropriate rows to plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                <span class="n">psth_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn</span><span class="p">,</span> <span class="n">sort</span><span class="p">]</span>
               <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">grating_on_time</span><span class="p">,</span> <span class="n">grating_off_time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sort code &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ortn &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ortn</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spike count per bin&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_40_0.png" src="../_images/pandas_multielec-subplot_examples_40_0.png" />
</div>
</div>
</section>
<section id="object-oriented-approach">
<h3>Object-Oriented Approach<a class="headerlink" href="#object-oriented-approach" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ortn_levs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sort_codes</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

<span class="c1"># loop through rows in DataFrame</span>
<span class="c1"># Since ax is a 2D array (rows, columns) we use enumerate() to get indexes for our subplots</span>
<span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ortn_levs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">sort</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sort_codes</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">psth_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn</span><span class="p">,</span> <span class="n">sort</span><span class="p">]</span>
                             <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">grating_on_time</span><span class="p">,</span> <span class="n">grating_off_time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sort code &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ortn &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ortn</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike count per bin&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
        
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_42_0.png" src="../_images/pandas_multielec-subplot_examples_42_0.png" />
</div>
</div>
<p>Note above the differences in total spike counts (<em>y</em> axis ranges) between sort codes. This is because the data are summed over channels; every channel as at least a sort code of 1 (i.e., contains data from one neuron/unit), but fewer channels were found to contain data from two or more units. So decreasing amounts of data contribute to the averages for sort codes 1-4.</p>
</section>
<section id="overlaying-conditions">
<h3>Overlaying Conditions<a class="headerlink" href="#overlaying-conditions" title="Permalink to this headline">¶</a></h3>
<p>It’s easier to make visual comparisons within a plot than between them. Since 0 and 90 degrees were the two experimental conditions that we’d want to compare, let’s overlay them, keeping the separate panels for sort code.</p>
<p>Note that this is a bit easier to do using the list method rather than the dictionary method, because in our list of labels, the orientation and sort code are two separate entries, so it’s easy to pull out the orientations. Using the dictionary method, we’d need to parse the dictionary keys to pull out the orientation information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>

<span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">sort_codes</span><span class="p">:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sort_codes</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sort</span><span class="p">))</span>

    <span class="c1"># One little trick here is for the second argument (histogram), we need to </span>
    <span class="c1"># &quot;squeeze&quot; the result of the Boolean selector on the DataFrame so that it&#39;s a Series</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sort</span><span class="p">]</span>
           <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sort</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
           <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">grating_on_time</span><span class="p">,</span> <span class="n">grating_off_time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sort code &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sort</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike count per bin&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_45_0.png" src="../_images/pandas_multielec-subplot_examples_45_0.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="psth-for-each-channel">
<h2>PSTH for each channel<a class="headerlink" href="#psth-for-each-channel" title="Permalink to this headline">¶</a></h2>
<p>The above examples collapsed across all 96 channels in the microelectrode array. This was for simplicity of plotting only 4 sort codes. Let’s now compute the PSTHs for each channel and orientation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">ortn</span><span class="p">,</span> <span class="n">chan</span><span class="p">]</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">channels</span> <span class="k">for</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="n">orientations</span> <span class="p">],</span>
                               <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">])</span>

<span class="n">psth_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ortn</span> <span class="ow">in</span> <span class="n">orientations</span><span class="p">:</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">chan</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ortn</span><span class="p">)][</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                          <span class="n">bins</span><span class="o">=</span><span class="n">time_bins</span><span class="p">,</span>
                         <span class="p">)</span>
        <span class="n">psth_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
        
<span class="n">psth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">condition_labels</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">psth_list</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    

<span class="c1"># Make orientation and channel indexes rather than data columns</span>
<span class="n">psth</span> <span class="o">=</span> <span class="n">psth</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span><span class="s1">&#39;channel&#39;</span><span class="p">])</span>

<span class="n">psth</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>259</th>
      <th>260</th>
      <th>261</th>
      <th>262</th>
      <th>263</th>
      <th>264</th>
      <th>265</th>
      <th>266</th>
      <th>267</th>
      <th>268</th>
    </tr>
    <tr>
      <th>orientation</th>
      <th>channel</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <th>1.0</th>
      <td>14</td>
      <td>32</td>
      <td>22</td>
      <td>14</td>
      <td>29</td>
      <td>28</td>
      <td>56</td>
      <td>74</td>
      <td>60</td>
      <td>59</td>
      <td>...</td>
      <td>19</td>
      <td>12</td>
      <td>12</td>
      <td>13</td>
      <td>16</td>
      <td>16</td>
      <td>15</td>
      <td>19</td>
      <td>21</td>
      <td>11</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>1.0</th>
      <td>15</td>
      <td>32</td>
      <td>19</td>
      <td>18</td>
      <td>26</td>
      <td>40</td>
      <td>42</td>
      <td>54</td>
      <td>38</td>
      <td>51</td>
      <td>...</td>
      <td>15</td>
      <td>17</td>
      <td>22</td>
      <td>14</td>
      <td>27</td>
      <td>21</td>
      <td>19</td>
      <td>21</td>
      <td>18</td>
      <td>17</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>2.0</th>
      <td>2</td>
      <td>3</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>2.0</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>5</td>
      <td>2</td>
      <td>5</td>
      <td>5</td>
      <td>...</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>3.0</th>
      <td>8</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>6</td>
      <td>4</td>
      <td>4</td>
      <td>8</td>
      <td>5</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>94.0</th>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>95.0</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>95.0</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>0.0</th>
      <th>96.0</th>
      <td>13</td>
      <td>7</td>
      <td>11</td>
      <td>6</td>
      <td>10</td>
      <td>5</td>
      <td>5</td>
      <td>17</td>
      <td>7</td>
      <td>8</td>
      <td>...</td>
      <td>13</td>
      <td>8</td>
      <td>17</td>
      <td>8</td>
      <td>16</td>
      <td>5</td>
      <td>21</td>
      <td>9</td>
      <td>10</td>
      <td>5</td>
    </tr>
    <tr>
      <th>90.0</th>
      <th>96.0</th>
      <td>7</td>
      <td>11</td>
      <td>12</td>
      <td>10</td>
      <td>7</td>
      <td>12</td>
      <td>9</td>
      <td>12</td>
      <td>6</td>
      <td>3</td>
      <td>...</td>
      <td>12</td>
      <td>11</td>
      <td>8</td>
      <td>11</td>
      <td>13</td>
      <td>8</td>
      <td>10</td>
      <td>14</td>
      <td>13</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
<p>182 rows × 269 columns</p>
</div></div></div>
</div>
<section id="plot-all-channels">
<h3>Plot all channels<a class="headerlink" href="#plot-all-channels" title="Permalink to this headline">¶</a></h3>
<p>To plot these, we use similar code to above. However, because there are 96 channels, we want to remove some axis labels from most plots (so it’s less messy and less redundant). There’s no way to make this not a huge image, since there are 96 panels to show, but by setting it to 4 columns we attain a good balance between readability and size.</p>
<p>In the loop below, we access specific data to plot form the pandas DataFrame <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#selection-by-label">using <code class="docutils literal notranslate"><span class="pre">.loc</span></code></a> to select based on the index columns. Since the index columns are in the order <code class="docutils literal notranslate"><span class="pre">['orientation',</span> <span class="pre">'channel']</span></code> we specify the arguments to <code class="docutils literal notranslate"><span class="pre">.loc</span></code> in the same order.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>

<span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">96</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">chan</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chan</span><span class="p">],</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">.75</span>
           <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chan</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">.75</span>
           <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">grating_on_time</span><span class="p">,</span> <span class="n">grating_off_time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
     
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Channel &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chan</span><span class="p">))</span>

    <span class="c1"># Below we apply axis labels only to first/outside plots to avoid redundancy</span>
    <span class="k">if</span> <span class="n">chan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spike count per bin&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">chan</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">channels</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/pandas_multielec-subplot_examples_49_0.png" src="../_images/pandas_multielec-subplot_examples_49_0.png" />
</div>
</div>
<p>One thing you’ll note above is that there are some missing panels, including channels 21, 31, 34, 56, and 68. As noted above, these are the dead channels. The way the code above is written, we use the channel number as the index for the subplot position. Since there is no channel in the <code class="docutils literal notranslate"><span class="pre">channels</span></code> list for the dead channels, those subplot panels are simply left blank.</p>
<p>Beyond that, it’s clear that different channels show very different response profiles. Some (e.g., 1, 2, 4, 5) show clear transient peaks in spiking activity soon after stimulus onset. Others do not. Some of the channels that show this initial peak return to baseline (low) levels of firing soon after, while others (e.g., 1, 20, 72) show a sustained plateau as long as the stimulus is on. Others (e.g., 3, 62) show no initial peak, but a steady rise in firing rate as the stimulus duration increases. As well, a few channels show orientation sensitivity, with clearly different responses between 0 (blue) and 90 (red) degree gratings (e.g., 29, 63, 75, 76, 91).</p>
</section>
</section>
<section id="interactive-plots">
<h2>Interactive plots<a class="headerlink" href="#interactive-plots" title="Permalink to this headline">¶</a></h2>
<p>Plotting all 91 channels is a bit visually overwhelming. It’s useful in appreciating the whole range of responses in different channels, but each plot is quite small. Here we use <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> to generate an interactive plot, with a drop-down menu to select the channel we want to view.</p>
<p><strong>Note:</strong> This will not display in the online book version, but it should work if you download and run this notebook file. To get this to work on your own system, you will need to at least run <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">labextension</span> <span class="pre">install</span> <span class="pre">&#64;jupyter-widgets/jupyterlab-manager</span></code>, and possibly install additional pacakges if you don’t have them already (although Anaconda seems to provide them, and they work on the <a class="reference external" href="https://cocalc.com/">CoCalc</a> cloud platform).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interact_manual</span>

<span class="nd">@interact</span>
<span class="k">def</span> <span class="nf">psth_i</span><span class="p">(</span><span class="n">chan</span><span class="o">=</span><span class="n">channels</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chan</span><span class="p">],</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">.75</span>
           <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
           <span class="n">psth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ortn_levs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chan</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">.75</span>
           <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">grating_on_time</span><span class="p">,</span> <span class="n">grating_off_time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Channel &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">chan</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spike count per bin&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "438b9c6b6b804fa9bba32fd6b31d1c2b", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./single_unit"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Aaron J Newman<br/>
        
            &copy; Copyright 2020-21. This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Unported License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-171426664-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>